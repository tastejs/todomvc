<!doctype html>
<html><head>
<meta charset="UTF-8">
<style type="text/css">
/* inlined stylesheet: /Volumes/Encrypted/code/marcuswestin/todomvc/assets/base.css */
html,
body {
	margin: 0;
	padding: 0;
}

button {
	margin: 0;
	padding: 0;
	border: 0;
	background: none;
	font-size: 100%;
	vertical-align: baseline;
	font-family: inherit;
	color: inherit;
	-webkit-appearance: none;
	/*-moz-appearance: none;*/
	-ms-appearance: none;
	-o-appearance: none;
	appearance: none;
}

body {
	font: 14px 'Helvetica Neue', Helvetica, Arial, sans-serif;
	line-height: 1.4em;
	background: #eeeeee url('bg.png');
	color: #4d4d4d;
	width: 550px;
	margin: 0 auto;
	-webkit-font-smoothing: antialiased;
	-moz-font-smoothing: antialiased;
	-ms-font-smoothing: antialiased;
	-o-font-smoothing: antialiased;
	font-smoothing: antialiased;
}

#todoapp {
	background: #fff;
	background: rgba(255, 255, 255, 0.9);
	margin: 130px 0 40px 0;
	border: 1px solid #ccc;
	position: relative;
	border-top-left-radius: 2px;
	border-top-right-radius: 2px;
	box-shadow: 0 2px 6px 0 rgba(0, 0, 0, 0.2),
				0 25px 50px 0 rgba(0, 0, 0, 0.15);
}

#todoapp:before {
	content: '';
	border-left: 1px solid #f5d6d6;
	border-right: 1px solid #f5d6d6;
	width: 2px;
	position: absolute;
	top: 0;
	left: 40px;
	height: 100%;
}

#todoapp h1 {
	position: absolute;
	top: -120px;
	width: 100%;
	font-size: 70px;
	font-weight: bold;
	text-align: center;
	color: #b3b3b3;
	color: rgba(255, 255, 255, 0.3);
	text-shadow: -1px -1px rgba(0, 0, 0, 0.2);
	-webkit-text-rendering: optimizeLegibility;
	-moz-text-rendering: optimizeLegibility;
	-ms-text-rendering: optimizeLegibility;
	-o-text-rendering: optimizeLegibility;
	text-rendering: optimizeLegibility;
}

#header {
	padding-top: 15px;
	border-radius: inherit;
}

#todoapp header:before {
	content: '';
	position: absolute;
	top: 0;
	right: 0;
	left: 0;
	height: 15px;
	z-index: 2;
	border-bottom: 1px solid #6c615c;
	background: #8d7d77;
	background: -webkit-gradient(linear, left top, left bottom, from(rgba(132, 110, 100, 0.8)),to(rgba(101, 84, 76, 0.8)));
	background: -webkit-linear-gradient(top, rgba(132, 110, 100, 0.8), rgba(101, 84, 76, 0.8));
	background: -moz-linear-gradient(top, rgba(132, 110, 100, 0.8), rgba(101, 84, 76, 0.8));
	background: -o-linear-gradient(top, rgba(132, 110, 100, 0.8), rgba(101, 84, 76, 0.8));
	background: -ms-linear-gradient(top, rgba(132, 110, 100, 0.8), rgba(101, 84, 76, 0.8));
	background: linear-gradient(top, rgba(132, 110, 100, 0.8), rgba(101, 84, 76, 0.8));
	filter: progid:DXImageTransform.Microsoft.gradient(GradientType=0,StartColorStr='#9d8b83', EndColorStr='#847670');
	border-radius: inherit;
}

#todoapp input::-webkit-input-placeholder {
	font-style: italic;
}

#todoapp input:-moz-placeholder {
	font-style: italic;
	color: #a9a9a9;
}

#new-todo,
.edit {
	margin: 0;
	width: 100%;
	font-size: 24px;
	font-family: inherit;
	line-height: 1.4em;
	border: 0;
	outline: none;
	color: inherit;
	padding: 6px;
	border: 1px solid #999;
	box-shadow: inset 0 -1px 5px 0 rgba(0, 0, 0, 0.2);
	-webkit-box-sizing: border-box;
	-moz-box-sizing: border-box;
	-ms-box-sizing: border-box;
	-o-box-sizing: border-box;
	box-sizing: border-box;
	-webkit-font-smoothing: antialiased;
	-moz-font-smoothing: antialiased;
	-ms-font-smoothing: antialiased;
	-o-font-smoothing: antialiased;
	font-smoothing: antialiased;
}

#new-todo {
	padding: 16px 16px 16px 60px;
	border: none;
	background: rgba(0, 0, 0, 0.02);
	position: relative;
	z-index: 2;
	box-shadow: none;
}

#main {
	position: relative;
	z-index: 2;
	border-top: 1px dotted #adadad;
}

label[for='toggle-all'] {
	display: none;
}

#toggle-all {
	position: absolute;
	top: -42px;
	left: 12px;
	text-align: center;
	-webkit-appearance: none;
	/*-moz-appearance: none;*/
	-ms-appearance: none;
	-o-appearance: none;
	appearance: none;
	-webkit-transform: rotate(90deg);
	/*-moz-transform: rotate(90deg);*/
	-ms-transform: rotate(90deg);
	/*-o-transform: rotate(90deg);*/
	transform: rotate(90deg);
}

#toggle-all:before {
	content: '»';
	font-size: 28px;
	color: #d9d9d9;
	padding: 0 25px 7px;
}

#toggle-all:checked:before {
	color: #737373;
}

/* Need this ugly hack, since only
WebKit supports styling of inputs */
@media screen and (-webkit-min-device-pixel-ratio:0) {
	#toggle-all {
		top: -52px;
		left: -11px;
	}
}

#todo-list {
	margin: 0;
	padding: 0;
	list-style: none;
}

#todo-list li {
	position: relative;
	font-size: 24px;
	border-bottom: 1px dotted #ccc;
}

#todo-list li:last-child {
	border-bottom: none;
}

#todo-list li.editing {
	border-bottom: none;
	padding: 0;
}

#todo-list li.editing .edit {
	display: block;
	width: 506px;
	padding: 13px 17px 12px 17px;
	margin: 0 0 0 43px;
}

#todo-list li.editing .view {
	display: none;
}

#todo-list li .toggle {
	text-align: center;
	width: 35px;
	-webkit-appearance: none;
	/*-moz-appearance: none;*/
	-ms-appearance: none;
	-o-appearance: none;
	appearance: none;
}

#todo-list li .toggle:after {
	font-size: 18px;
	content: '✔';
	line-height: 40px;
	font-size: 20px;
	color: #d9d9d9;
	text-shadow: 0 -1px 0 #bfbfbf;
}

#todo-list li .toggle:checked:after {
	color: #85ada7;
	text-shadow: 0 1px 0 #669991;
	bottom: 1px;
	position: relative;
}

#todo-list li label {
	word-break: break-word;
	margin: 20px 15px;
	display: inline-block;
	-webkit-transition: color 0.4s;
	-moz-transition: color 0.4s;
	-ms-transition: color 0.4s;
	-o-transition: color 0.4s;
	transition: color 0.4s;
}

#todo-list li.completed label {
	color: #a9a9a9;
	text-decoration: line-through;
}

#todo-list li .destroy {
	display: none;
	position: absolute;
	top: 10px;
	right: 10px;
	width: 40px;
	height: 40px;
	font-size: 22px;
	color: #a88a8a;
	-webkit-transition: all 0.2s;
	-moz-transition: all 0.2s;
	-ms-transition: all 0.2s;
	-o-transition: all 0.2s;
	transition: all 0.2s;
}

#todo-list li .destroy:hover {
	text-shadow: 0 0 1px #000,
				 0 0 10px rgba(199, 107, 107, 0.8);
	-webkit-transform: scale(1.3);
	-moz-transform: scale(1.3);
	-ms-transform: scale(1.3);
	-o-transform: scale(1.3);
	transform: scale(1.3);
}

#todo-list li .destroy:after {
	content: '✖';
}

#todo-list li:hover .destroy {
	display: block;
}

#todo-list li .edit {
	display: none;
}

#todo-list li.editing:last-child {
	margin-bottom: -1px;
}

#footer {
	color: #777;
	padding: 0 15px;
	position: absolute;
	right: 0;
	bottom: -31px;
	left: 0;
	z-index: 1;
	text-align: center;
}

#footer:before {
	content: '';
	position: absolute;
	right: 0;
	bottom: 31px;
	left: 0;
	height: 100px;
	z-index: -1;
	box-shadow: 0 1px 1px rgba(0, 0, 0, 0.3),
				0 6px 0 -3px rgba(255, 255, 255, 0.8),
				0 7px 1px -3px rgba(0, 0, 0, 0.3),
				0 42px 0 -6px rgba(255, 255, 255, 0.8),
				0 43px 2px -6px rgba(0, 0, 0, 0.2);
}

#todo-count {
	float: left;
	text-align: left;
}

#filters {
	margin: 0;
	padding: 0;
	list-style: none;
	position: absolute;
	right: 0;
	left: 0;
}

#filters li {
	display: inline;
}

#filters li a {
	color: #83756f;
	margin: 2px;
	text-decoration: none;
}

#filters li a.selected {
	font-weight: bold;
}

#clear-completed {
	float: right;
	line-height: 20px;
	text-decoration: none;
	background: rgba(0, 0, 0, 0.1);
	font-size: 11px;
	padding: 0 10px;
	position: relative;
	border-radius: 3px;
	box-shadow: 0 -1px 0 0 rgba(0, 0, 0, 0.2);
}

#clear-completed:hover {
	background: rgba(0, 0, 0, 0.15);
	box-shadow: 0 -1px 0 0 rgba(0, 0, 0, 0.3);
}

#info {
	margin: 65px auto 0;
	color: #a6a6a6;
	font-size: 12px;
	text-shadow: 0 1px 0 rgba(255, 255, 255, 0.7);
	text-align: center;
}

#info a {
	color: inherit;
}
</style>
<style type="text/css">
/* inlined stylesheet: /Volumes/Encrypted/code/marcuswestin/todomvc/labs/fun/css/app.css */
/*
	Fun injects "hook" dom nodes into the dom tree. The
	reason why is too involved to outline here. However,
	they break a few of the todo app styles, such as
	`#todo-list li:last-child { border-bottom:none; }`.
	This should be rectified in fun in the future, but
	these css modifications are fine in the meantime.
*/

body {
	background: 
	#EEE url('../../assets/bg.png');
}

#todo-list li:last-child {
	border-bottom: 1px dotted #CCC;
}

#todo-list li label {
	margin:20px 22px;
}
</style>
</head><body><script>
var __require__ = {}
;(function() {
	// /usr/local/lib/node_modules/fun/node_modules/std/isArray
	var module = __require__["_1"] = {exports:{}}, exports = module.exports;
module.exports = (function() {
	if (Array.isArray && Array.isArray.toString().match('\\[native code\\]')) {
		return function(obj) {
			return Array.isArray(obj)
		}
	} else {
		// thanks @kangax http://perfectionkills.com/instanceof-considered-harmful-or-how-to-write-a-robust-isarray/
		return function(obj) {
			return Object.prototype.toString.call(obj) == '[object Array]'
		}
	}
})();

})()

;(function() {
	// /usr/local/lib/node_modules/fun/node_modules/std/isArguments
	var module = __require__["_2"] = {exports:{}}, exports = module.exports;
module.exports = function isArguments(obj) {
  return Object.prototype.toString.call(obj) == '[object Arguments]'
}
})()

;(function() {
	// /usr/local/lib/node_modules/fun/node_modules/std/each
	var module = __require__["_3"] = {exports:{}}, exports = module.exports;
var isArray = __require__["_1"].exports,
	isArguments = __require__["_2"].exports

module.exports = function(items, ctx, fn) {
	if (!items) { return }
	if (!fn) {
		fn = ctx
		ctx = this
	}
	if (isArray(items) || isArguments(items)) {
		for (var i=0; i < items.length; i++) {
			fn.call(ctx, items[i], i)
		}
	} else {
		for (var key in items) {
			if (!items.hasOwnProperty(key)) { continue }
			fn.call(ctx, items[key], key)
		}
	}
}

})()

;(function() {
	// /usr/local/lib/node_modules/fun/node_modules/std/create
	var module = __require__["_4"] = {exports:{}}, exports = module.exports;
var each = __require__["_3"].exports
// Thanks Douglas Crockford! http://javascript.crockford.com/prototypal.html
module.exports = function create(obj, extendWithProperties) {
	function extendObject(result, props) {
		each(props, function(val, key) {
			result[key] = val
		})
		return result
	}
	if (typeof Object.create == 'function') {
		module.exports = function nativeCreate(obj, extendWithProperties) {
			return extendObject(Object.create(obj), extendWithProperties)
		}
	} else {
		module.exports = function shimCreate(obj, extendWithProperties) {
			function F() {}
			F.prototype = obj
			return extendObject(new F(), extendWithProperties)
		}
	}
	return module.exports(obj, extendWithProperties)
}

})()

;(function() {
	// /usr/local/lib/node_modules/fun/node_modules/std/proto
	var module = __require__["_5"] = {exports:{}}, exports = module.exports;
/* 
	// Usage: proto(prototypeObj, intantiatingFn, properties)
	
	var base = {
		say:function(arg) { alert(arg) }
	}

	var person = proto(base,
		function(name) {
			this.name = name
		}, {
			greet:function(other) {
				this.say("hello "+other.name+", I'm "+this.name)
			}
		}
	)
	
	var marcus = person("marcus"),
		john = person("john")

	marcus.greet(john)
*/

var create = __require__["_4"].exports,
	each = __require__["_3"].exports

var proto = module.exports = function proto(prototypeObject, instantiationFunction, propertiesToAdd) {
	// F is the function that is required in order to implement JS prototypical inheritence
	function F(args) {
		// When a new object is created, call the instantiation function
		return instantiationFunction.apply(this, args)
	}
	// The prototype object itself points to the passed-in prototypeObject,
	// but also has all the properties enumerated in propertiesToAdd
	F.prototype = prototypeObject ? create(prototypeObject, propertiesToAdd) : propertiesToAdd
	
	return function() {
		return new F(arguments)
	}
}

})()

;(function() {
	// /usr/local/lib/node_modules/fun/node_modules/std/map
	var module = __require__["_6"] = {exports:{}}, exports = module.exports;
var each = __require__["_3"].exports

module.exports = function(items, ctx, fn) {
	var result = []
	if (!fn) {
		fn = ctx
		ctx = this
	}
	each(items, ctx, function(item, key) {
		result.push(fn.call(ctx, item, key))
	})
	return result
}

})()

;(function() {
	// /usr/local/lib/node_modules/fun/node_modules/std/slice
	var module = __require__["_7"] = {exports:{}}, exports = module.exports;
/*
	Example usage:

	function log(category, arg1, arg2) { // arg3, arg4, ..., argN
		console.log('log category', category, std.slice(arguments, 1))
	}
*/
module.exports = function args(args, offset, length) {
	if (typeof length == 'undefined') { length = args.length }
	return Array.prototype.slice.call(args, offset || 0, length)
}


})()

;(function() {
	// /usr/local/lib/node_modules/fun/node_modules/std/bind
	var module = __require__["_8"] = {exports:{}}, exports = module.exports;
/*
	Example usage:

	function Client() {
		this._socket = new Connection()
		this._socket.open()
		this._socket.on('connected', bind(this, '_log', 'connected!'))
		this._socket.on('connected', bind(this, 'disconnect'))
	}

	Client.prototype._log = function(message) {
		console.log('client says:', message)
	}

	Client.prototype.disconnect = function() {
		this._socket.disconnect()
	}

	Example usage:

	var Toolbar = Class(function() {
		
		this.init = function() {
			this._buttonWasClicked = false
		}
		
		this.addButton = function(clickHandler) {
			this._button = new Button()
			this._button.on('Click', bind(this, '_onButtonClick', clickHandler))
		}

		this._onButtonClick = function(clickHandler) {
			this._buttonWasClicked = true
			clickHandler()
		}

	})

*/
var slice = __require__["_7"].exports

module.exports = function bind(context, method /* curry1, curry2, ... curryN */) {
	if (typeof method == 'string') { method = context[method] }
	var curryArgs = slice(arguments, 2)
	return function bound() {
		var invocationArgs = slice(arguments)
		return method.apply(context, curryArgs.concat(invocationArgs))
	}
}


})()

;(function() {
	// /usr/local/lib/node_modules/fun/node_modules/std/arrayToObject
	var module = __require__["_9"] = {exports:{}}, exports = module.exports;
module.exports = function arrayToObject(arr) {
	var obj = {}
	for (var i=0; i<arr.length; i++) { obj[arr[i]] = true }
	return obj
}
})()

;(function() {
	// /usr/local/lib/node_modules/fun/node_modules/std/copy
	var module = __require__["_10"] = {exports:{}}, exports = module.exports;
var each = __require__["_3"].exports,
	isArray = __require__["_1"].exports

module.exports = function copy(obj, deep) {
	var result = isArray(obj) ? [] : {}
	each(obj, function(val, key) {
		result[key] = (deep && typeof val == 'object') ? copy(val, deep) : val
	})
	return result
}

})()

;(function() {
	// /usr/local/lib/node_modules/fun/src/runtime/expressions
	var module = __require__["_11"] = {exports:{}}, exports = module.exports;
var proto = __require__["_5"].exports,
	create = __require__["_4"].exports,
	map = __require__["_6"].exports,
	isArray = __require__["_1"].exports,
	bind = __require__["_8"].exports,
	arrayToObject = __require__["_9"].exports,
	copy = __require__["_10"].exports

// All values inherit from base
///////////////////////////////
var base = module.exports.base = {
	observe:function(callback) {
		var id = this._onMutate(callback)
		callback()
		return id
	},
	_onMutate:function(callback) {},
	toJSON:function() { return JSON.parse(this.asLiteral()) },
	isTruthy:function() { return true },
	isNull:function() { return false },
	iterate:function() {},
	getters:{
		copy:function() {
			return module.exports.Function(bind(this, function(yieldValue) {
				yieldValue(this.getContent())
			}))
		},
		Type:function() {
			return Text(this.getType())
		}
	}
}

// Simple values
////////////////
var constantAtomicBase = create(base, {
	isAtomic:function() { return true },
	inspect:function() { return '<'+this._type+' ' + this.asLiteral() + '>' },
	getType:function() { return this._type },
	evaluate:function() { return this },
	toString:function() { return this._content.toString() },
	equals:function(that) { return (this._type == that.getType() && this._content == that.getContent()) ? Yes : No },
	getContent:function() { return this._content },
	mutate:function() { throw new Error("Called mutate on non-mutable value "+this.asLiteral() )},
	dismiss:function(id) {},
	render:function(hookName) {
		fun.hooks[hookName].innerHTML = ''
		fun.hooks[hookName].appendChild(document.createTextNode(this.toString()))
	}
})

var Number = module.exports.Number = proto(constantAtomicBase,
	function Number(content) {
		if (typeof content != 'number') { typeMismatch() }
		this._content = content
	}, {
		_type:'Number',
		asLiteral:function() { return this._content },
		isTruthy: function() { return this._content != 0 }
	}
)

var Text = module.exports.Text = proto(constantAtomicBase,
	function Text(content) {
		if (typeof content != 'string') { typeMismatch() }
		this._content = content
	}, {
		_type:'Text',
		asLiteral:function() { return '"'+this._content+'"' }
	}
)

var Logic = module.exports.Logic = function(content) {
	if (typeof content != 'boolean') { typeMismatch() }
	return content ? Yes : No
}
var LogicProto = proto(constantAtomicBase,
	function Logic(content) {
		this._content = content
	}, {
		_type:'Logic',
		toString:function() { return this._content ? 'yes' : 'no' },
		asLiteral:function() { return this._content ? 'true' : 'false' },
		isTruthy:function() { return this._content }
	}
)
var Yes = module.exports.Yes = LogicProto(true),
	No = module.exports.No = LogicProto(false)

module.exports.Null = function() { return Null }
var Null = (proto(constantAtomicBase,
	function Null() {
		if (arguments.length) { typeMismatch() }
	}, {
		_type:'Null',
		inspect:function() { return '<Null>' },
		toString:function() { return '' },
		equals:function(that) { return that.getType() == 'Null' ? Yes : No },
		asLiteral:function() { return 'null' },
		isTruthy:function() { return false },
		isNull:function() { return true }
	}
))();

// Invocable values
///////////////////
module.exports.Function = proto(constantAtomicBase,
	function Function(block) {
		if (typeof block != 'function') { typeMismatch() }
		this._content = block
	}, {
		_type:'Function',
		invoke:function(args) {
			var result = variable(Null)
			this._withArgs(args, this._content, function(value) {
				result.mutate('set', [fromJsValue(value)])
			})
			return result
		},
		render:function(hookName, args) {
			this._withArgs(args, this._content, function(value) {
				fromJsValue(value).render(hookName)
			})
		},
		_withArgs:function(args, content, yieldValue) {
			var executeBlock = bind(this, function() {
				if (args[1]) {
					 // hack: isFirstExecution
					var useArgs = copy(args)
					args[1] = false
					content.apply(this, useArgs)
				} else {
					content.apply(this, args)
				}
			})
			
			for (var i=0; i<args.length; i++) {
				if (args[i]) { args[i]._onMutate(executeBlock) }
			}
			
			var isFirstExecution = true
			args = _cleanArgs([yieldValue, isFirstExecution].concat(args), this._content)
			executeBlock()
		}
	}
)

module.exports.Handler = proto(constantAtomicBase,
	function Handler(block) {
		if (typeof block != 'function') { typeMismatch() }
		this._content = block
	}, {
		_type:'Handler',
		invoke:function(args) {
			this._content.apply(this, args)
		}
	}
)

module.exports.Template = proto(constantAtomicBase,
	function Template(block) {
		if (typeof block != 'function') { typeMismatch() }
		this._content = block
	}, {
		_type:'Template',
		render:function(hookName, args) {
			args = _cleanArgs([hookName].concat(args), this._content)
			this._content.apply(this, args)
		}
	}
)

// Variable expressions
///////////////////////
var variableValueBase = create(base, {
	isAtomic:function() { return this.evaluate().isAtomic() },
	getType:function() { return this.evaluate().getType() },
	toString:function() { return this.evaluate().toString() },
	asLiteral:function() { return this.evaluate().asLiteral() },
	equals:function(that) { return this.evaluate().equals(that) },
	getContent:function() { return this.evaluate().getContent() },
	isTruthy:function() { return this.evaluate().isTruthy() },
	invoke:function(args) { return this.evaluate().invoke(args) },
	render:function(hookName, args) {
		this.observe(bind(this, function() {
			this.evaluate().render(hookName, args)
		}))
	}
})

var variableCompositeBase = create(variableValueBase, {
	_initComposite:function(components) {
		this.ids = {}
		this.components = components
	},
	_onMutate:function(callback) {
		var id = unique(),
			ids = this.ids[id] = {}
		for (var key in this.components) {
			ids[key] = this.components[key]._onMutate(callback)
		}
		return id
	},
	dismiss:function(id) {
		var ids = this.ids[id]
		if (!ids) { throw new Error("Tried to dismiss a collection observer by incorrect ID") }
		delete this.ids[id]
		for (var key in ids) {
			this.components[key].dismiss(ids[key])
		}
	}
})

module.exports.unaryOp = proto(variableCompositeBase,
	function unaryOp(operator, value) {
		this.operator = operator
		this._initComposite({ value:value })
	}, {
		_type:'unaryOp',
		evaluate:function() {
			return unaryOperators[this.operator](this.components.value.evaluate())
		}
	}
)

module.exports.binaryOp = proto(variableCompositeBase,
	function binaryOp(left, operator, right) {
		this.operator = operator
		this._initComposite({ left:left, right:right })
	}, {
		_type:'binaryOp',
		evaluate:function() { return operators[this.operator](this.components.left, this.components.right) }
	}
)

module.exports.ternaryOp = proto(variableCompositeBase,
	function ternaryOp(condition, ifValue, elseValue) {
		this._initComposite.call(this, { condition:condition, ifValue:ifValue, elseValue:elseValue })
	}, {
		_type:'ternaryOp',
		evaluate:function() {
			return this.components.condition.isTruthy()
				? this.components.ifValue.evaluate()
				: this.components.elseValue.evaluate()
		}
	}
)

var dereference = module.exports.dereference = proto(variableCompositeBase,
	function dereference(value, key) {
		this._initComposite({ value:value, key:key })
	}, {
		_onMutate:function(callback) {
			return variableCompositeBase._onMutate.call(this, bind(this, function(mutation) {
				var affectedProperties = mutation.affectedProperties
				var propertyKey = this.components.key.asLiteral()
				if (affectedProperties && !affectedProperties[propertyKey]) { return }
				mutation = { affectedProperties:null }
				callback(mutation)
			}))
		},
		_type:'dereference',
		inspect:function() { return '<dereference '+this.components.value.inspect()+'['+this.components.key.inspect()+']>' },
		equals:function(that) { return this.evaluate().equals(that) },
		lookup:function(key) { return this._getCurrentValue().lookup(key) },
		evaluate:function() { return this._getCurrentValue().evaluate() },
		mutate:function(operator, args) { this._getCurrentValue().mutate(operator, args) },
		_getCurrentValue:function() {
			var key = this.components.key.evaluate(),
				value = this.components.value,
				getterValue = value.evaluate(),
				getter = (key.getType() == 'Text' && getterValue.getters[key.toString()])
			
			if (getter) {
				return getter.call(getterValue)
			} else if (value.isAtomic()) {
				return Null
			} else {
				return value.lookup(key) || Null
			}
		}
	}
)

// Mutable values - variables and collections
/////////////////////////////////////////////
var mutableBase = create(variableValueBase, {
	_initMutable:function() {
		this.observers = {}
		this.notify = bind(this, this._notifyObservers)
	},
	_notifyObservers:function(mutation) {
		for (var id in this.observers) {
			this.observers[id](mutation)
		}
	},
	_onMutate:function(callback) {
		var id = unique()
		this.observers[id] = callback
		return id
	},
	dismiss:function(id) {
		if (!this.observers[id]) { throw new Error("Tried to dismiss an observer by incorrect ID") }
		delete this.observers[id]
	}
})

var variable = module.exports.variable = proto(mutableBase,
	function variable(content) {
		this._initMutable()
		this.mutate('set', [content])
	}, {
		_type:'variable',
		evaluate:function() { return this._content.evaluate() },
		inspect:function() { return '<variable '+this._content.inspect()+'>' },
		toString:function() { return this._content.toString() },
		asLiteral:function() { return this._content.asLiteral() },
		equals:function(that) { return this._content.equals(that) },
		lookup:function(key) { return this._content.lookup(key) },
		mutate: function(operator, args) {
			if (operator != 'set' || args.length == 2) { // Hmm, hacky, should methods with multiple arguments have different method names like in ObjC?
				return this._content.mutate(operator, args)
			}
			_checkArgs(args, 1)
			var newContent = args[0]
			
			if (this._observationID) {
				this._content.dismiss(this._observationID)
			}
			this._content = newContent
			this._observationID = newContent._onMutate(this.notify)
			
			var mutation = { affectedProperties:null }
			this.notify(mutation)
		}
	}
)

var collectionBase = create(mutableBase, {
	_initCollection: function() {
		this._initMutable()
		this.propObservations = {}
	},
	isAtomic:function() { return false },
	getType:function() { return this._type },
	evaluate:function() { return this },
	getContent:function() { return this._content },
	isTruthy:function() { return true },
	
	_setProperty: function(propertyKey, newProperty, additionalAffectedProperties) {
		this._forgetProperty(propertyKey)
		
		this._content[propertyKey] = newProperty
		
		this.propObservations[propertyKey] = newProperty._onMutate(bind(this, function(mutation) {
			this.notify(this._createMutation(propertyKey, null))
		}))
		
		this.notify(this._createMutation(propertyKey, additionalAffectedProperties))
	},
	_forgetProperty: function(propertyKey) {
		var oldId = this.propObservations[propertyKey]
		if (oldId) {
			this._content[propertyKey].dismiss(oldId)
			delete this.propObservations[propertyKey]
		}
	}
})

var Dictionary = module.exports.Dictionary = proto(collectionBase,
	function Dictionary(content) {
		if (typeof content != 'object' || isArray(content) || content == null) { typeMismatch() }
		this._initCollection()
		this._content = {}
		for (var key in content) {
			this.mutate('set', [Text(key), content[key]])
		}
	}, {
		_type:'Dictionary',
		asLiteral:function() { return '{ '+map(this._content, function(val, key) { return fromLiteral(key).asLiteral()+':'+val.asLiteral() }).join(', ')+' }' },
		toString:function() { return this.asLiteral() },
		inspect:function() { return '<Dictionary { '+map(this._content, function(val, key) { return fromLiteral(key).inspect()+':'+val.inspect() }).join(', ')+' }>' },
		lookup:function(key) {
			var value = this._content[key.asLiteral()]
			return value
		},
		iterate:function(yieldFn) {
			var content = this._content
			for (var key in content) {
				yieldFn(content[key])
			}
		},
		equals:function(that) {
			that = that.evaluate()
			if (that._type != this._type) {
				return No
			}
			for (var key in this._content) {
				if (that._content[key] && that._content[key].equals(this._content[key])) { continue }
				return No
			}
			for (var key in that._content) {
				if (this._content[key] && this._content[key].equals(that._content[key])) { continue }
				return No
			}
			return Yes
		},
		mutate:function(operator, args) {
			if (operator != 'set') { throw new Error('Bad Dictionary operator "'+operator+'"') }
			_checkArgs(args, 2)
			var key = args[0],
				value = args[1]
			if (!key || key.isNull() || !value) { BAD_ARGS }
			this._setProperty(key.asLiteral(), value)
		},
		_createMutation: function(propertyKey, additionalAffectedProperties) {
			if (additionalAffectedProperties) { throw new Error("I think Dictionary should never be getting additionalAffectedProperties") }
			return { affectedProperties:arrayToObject([propertyKey]) }
		}
	}
)

var List = module.exports.List = proto(collectionBase,
	function List(content) {
		if (!isArray(content)) { typeMismatch() }
		this._initCollection()
		this._content = []
		for (var i=0; i<content.length; i++) {
			this.mutate('push', [content[i]])
		}
	}, {
		_type:'List',
		asLiteral:function() { return '[ '+map(this._content, function(val) { return val.asLiteral() }).join(', ')+' ]' },
		toString:function() { return this.asLiteral() },
		inspect:function() { return '<List [ '+map(this._content, function(val) { return val.inspect() }).join(', ')+' ]>' },
		lookup:function(index) {
			if (index.getType() == 'Number') { typeMismatch() }
			var value = this._content[index.getContent()]
			return value
		},
		iterate:function(yieldFn) {
			var content = this._content
			for (var i=0; i<content.length; i++) {
				yieldFn(content[i])
			}
		},
		equals:function(that) {
			that = that.evaluate()
			if (that._type != this._type) {
				return No
			}
			if (that._content.length != this._content.length) {
				return No
			}
			for (var i=0; i<this._content.length; i++) {
				if (that._content[i].equals(this._content[i])) { continue }
				return No
			}
			return Yes
		},
		getters:create(base.getters, {
			length:function() {
				var variableLength = variable(Null)
				this.observe(bind(this, function() {
					variableLength.mutate('set', [Number(this._content.length)])
				}))
				return variableLength
			},
			last:function() {
				var last = variable(Null)
				this.observe(bind(this, function() {
					last.mutate('set', [this._content[this._content.length - 1] || Null])
				}))
				return last
			},
			first:function() {
				var first = variable(Null)
				this.observe(bind(this, function() {
					first.mutate('set', [this._content[0] || Null])
				}))
				return first
			}
		}),
		mutate:function(operator, args) {
			switch(operator) {
				case 'push':
					_checkArgs(args, 1)
					this._setProperty(this._content.length, args[0], '"length"')
					break
				case 'set':
					_checkArgs(args, 2)
					if (args[0].getType() != 'Number') { typeMismatch() }
					var index = args[0].getContent(),
						length = this._content.length
					if (index >= length) { throw new Error("List set: index larger than current length") }
					
					var affected = [index]
					if (index == 0) { affected.push('"first"') }
					if (index == length - 1) { affected.push('"last"') }
					this._setProperty(index, args[1], affected)
					break
				case 'pop':
					_checkArgs(args, 1)
					var index = this._content.length - 1
					this._forgetProperty(index)
					this._content.pop()
					
					this.notify(this._createMutation(index, ['"length"', '"last"']))
					break
				default:
					throw new Error('Bad Dictionary operator "'+operator+'"')
			}
		},
		_createMutation: function(propertyKey, additionalAffectedProperties) {
			var affectedProperties = [propertyKey]
			if (propertyKey == 0) { affectedProperties.push('"first"') }
			if (propertyKey == this._content.length - 1) { affectedProperties.push('"last"') }
			if (additionalAffectedProperties) { affectedProperties = affectedProperties.concat(additionalAffectedProperties) }
			return { affectedProperties:arrayToObject(affectedProperties) }
		}
	}
)

// Operators
////////////
var unaryOperators = {
	'!': not,
	'-': negative
}

var operators = {
	'+': add,
	'-': subtract,
	'/': divide,
	'*': multiply,
	'=': equals,
	'==': equals, // I wonder if we should make this just = in the fun source, since we don't allow for assignment in mutating statements...
	'!': notEquals,
	'!=': notEquals, // We may want to just use ! since it's `foo is ! 'hi'` now
	'>=': greaterThanOrEquals,
	'<=': lessThanOrEquals,
	'<': lessThan,
	'>': greaterThan
}

function negative(value) {
	if (value.getType() != 'Number') { return Null }
	return Number(-value.getContent())
}

function not(value) {
	return Logic(!value.isTruthy())
}

function add(left, right) {
	if (left.getType() == 'Number' && right.getType() == 'Number') {
		return Number(left.getContent() + right.getContent())
	}
	return Text(left.toString() + right.toString())
}

function subtract(left, right) {
	if (left.getType() == 'Number' && right.getType() == 'Number') {
		return Number(left.getContent() - right.getContent())
	} else {
		return Null
	}
}

function divide(left, right) {
	if (left.getType() == 'Number' && right.getType() == 'Number') {
		return Number(left.getContent() / right.getContent())
	} else {
		return Null
	}
}

function multiply(left, right) {
	if (left.getType() == 'Number' && right.getType() == 'Number') {
		return Number(left.getContent() * right.getContent())
	} else {
		return Null
	}
}


function equals(left, right) {
	return left.equals(right)
}

function notEquals(left, right) {
	return Logic(!left.equals(right).getContent())
}

function greaterThanOrEquals(left, right) {
	// TODO Typecheck?
	return Logic(left.getContent() >= right.getContent())
}

function lessThanOrEquals(left, right) {
	// TODO Typecheck?
	return Logic(left.getContent() <= right.getContent())
}

function lessThan(left, right) {
	// TODO Typecheck?
	return Logic(left.getContent() < right.getContent())
}

function greaterThan(left, right) {
	// TODO Typecheck?
	return Logic(left.getContent() > right.getContent())
}

// Util
///////
var _unique = 1
function unique() { return 'u'+_unique++ }

var fromJsValue = module.exports.fromJsValue = module.exports.value = function(val) {
	switch (typeof val) {
		case 'string': return Text(val)
		case 'number': return Number(val)
		case 'boolean': return Logic(val)
		case 'undefined': return Null
		case 'object':
			if (base.isPrototypeOf(val)) { return val }
			if (val == null) {
				return Null
			}
			if (isArray(val)) {
				var content = map(val, fromJsValue)
				return List(content)
			}
			var content = {}
			for (var key in val) {
				content[key] = fromJsValue(val[key])
			}
			return Dictionary(content)
	}
}

var fromLiteral = module.exports.fromLiteral = module.exports.fromJSON = function(json) {
	try { var jsValue = JSON.parse(json) }
	catch(e) { return Null }
	return fromJsValue(jsValue)
}

var Event = module.exports.Event = function(jsEvent) {
	var funEvent = fromJsValue({
		keyCode:jsEvent.keyCode,
		type:jsEvent.type,
		cancel:fun.expressions.Function(function() {
			if (jsEvent.preventDefault) { jsEvent.preventDefault() }
			else { jsEvent.returnValue = false }
		})
	})
	funEvent.jsEvent = jsEvent // For JS API
	return funEvent
}

function _cleanArgs(args, fn) {
	var diffArgs = fn.length - args.length
	while (diffArgs-- > 0) { args.push(Null) }
	return args
}

var _checkArgs = function(args, num) {
	if (!isArray(args) || args.length != num) { BAD_ARGS }
}

function typeMismatch() { throw new Error('Type mismatch') }

})()

;(function() {
	// /usr/local/lib/node_modules/fun/node_modules/std/curry
	var module = __require__["_12"] = {exports:{}}, exports = module.exports;
var slice = __require__["_7"].exports

module.exports = function curry(fn /* arg1, arg2, ... argN */) {
	var curryArgs = slice(arguments, 1)
	return function curried() {
		var invocationArgs = slice(arguments)
		return fn.apply(this, curryArgs.concat(invocationArgs))
	}
}


})()

;(function() {
	// /usr/local/lib/node_modules/fun/node_modules/std/throttle
	var module = __require__["_13"] = {exports:{}}, exports = module.exports;
var unique = 0
module.exports = function throttle(fn, delay) {
	if (typeof delay != 'number') { delay = 50 }
	var timeoutName = '__throttleTimeout__' + (++unique)
	return function throttled() {
		if (this[timeoutName]) { return }
		var args = arguments, self = this
		this[timeoutName] = setTimeout(function fireDelayed() {
			delete self[timeoutName]
			fn.apply(self, args)
		}, delay)
		fn.apply(self, args)
	}
}

})()

;(function() {
	// /usr/local/lib/node_modules/fun/node_modules/dom/hasClass
	var module = __require__["_14"] = {exports:{}}, exports = module.exports;
module.exports = function(el, className) {
	return (' ' + el.className + ' ').match(' ' + className + ' ')
}
})()

;(function() {
	// /usr/local/lib/node_modules/fun/node_modules/dom/addClass
	var module = __require__["_15"] = {exports:{}}, exports = module.exports;
var hasClass = __require__["_14"].exports

module.exports = function(el, className) {
	if (hasClass(el, className)) { return }
	el.className += ' ' + className
}

})()

;(function() {
	// /usr/local/lib/node_modules/fun/node_modules/dom/removeClass
	var module = __require__["_16"] = {exports:{}}, exports = module.exports;
module.exports = function removeClass(el, className) {
	var current = ' ' + el.className + ' ',
		target = ' ' + className + ' ',
		index  = current.indexOf(target)

  	if (index == -1) { return }
	el.className = current.replace(target, ' ')
}
})()

;(function() {
	// /usr/local/lib/node_modules/fun/node_modules/std/unique
	var module = __require__["_17"] = {exports:{}}, exports = module.exports;
/*
 * Return a globally unique string.
 */
module.exports = function() {
	return module.exports.__namespace + (++module.exports.__id)
}
module.exports.__id = 0
module.exports.__namespace = '__u'
})()

;(function() {
	// /usr/local/lib/node_modules/fun/node_modules/std/Class
	var module = __require__["_18"] = {exports:{}}, exports = module.exports;
/* Example usage:

	var UIComponent = Class(function() {
		this.init = function() { ... }
		this.create = function() { ... this.createDOM() ... }
	})

	var PublisherMixin = {
		init: function(){ ... },
		publish_: function() { ... }
	}
  
	var Button = Class(UIComponent, PublisherMixin, function(supr) {
		this.init = function(opts) {
			// call UIComponents init method, with the passed in arguments
			supr(this, 'init', arguments) // or, UIComponent.constructor.prototype.init.apply(this, arguments)
			this.color_ = opts && opts.color
		}

		// createDOM overwrites abstract method from parent class UIComponent
		this.createDOM = function() {
			this.getElement().onclick = bind(this, function(e) {
				// this.publish_ is a method added to Button by the Publisher mixin
				this.publish_('Click', e)
			})
		}
	})

*/
module.exports = function Class(/* optParent, optMixin1, optMixin2, ..., proto */) {
	var args = arguments,
		numOptArgs = args.length - 1,
		mixins = []

	// the prototype function is always the last argument
	var proto = args[numOptArgs]

	// if there's more than one argument, then the first argument is the parent class
	if (numOptArgs) {
		var parent = args[0]
		if (parent) { proto.prototype = parent.prototype }
	}

	for (var i=1; i < numOptArgs; i++) { mixins.push(arguments[i]) }

	// cls is the actual class function. Classes may implement this.init = function(){ ... },
	// which gets called upon instantiation
	var cls = function() {
		if(this.init) { this.init.apply(this, arguments) }
		for (var i=0, mixin; mixin = mixins[i]; i++) {
			if (mixin.init) { mixin.init.apply(this) }
		}
	}

	// the proto function gets called with the supr function as an argument. supr climbs the
	// inheritence chain, looking for the named method
	cls.prototype = new proto(function supr(context, method, args) {
		var target = parent
		while(target = target.prototype) {
			if(target[method]) {
				return target[method].apply(context, args || [])
			}
		}
		throw new Error('supr: parent method ' + method + ' does not exist')
	})

	// add all mixins' properties to the class' prototype object
	for (var i=0, mixin; mixin = mixins[i]; i++) {
		for (var propertyName in mixin) {
			if (!mixin.hasOwnProperty(propertyName) || propertyName == 'init') { continue }
			if (cls.prototype.hasOwnProperty(propertyName)) {
				throw new Error('Mixin property "'+propertyName+'" already exists on class')
			}
			cls.prototype[propertyName] = mixin[propertyName]
		}
	}

	cls.prototype.constructor = cls
	return cls
}

})()

;(function() {
	// /usr/local/lib/node_modules/fun/node_modules/std/client
	var module = __require__["_19"] = {exports:{}}, exports = module.exports;
var Class = __require__["_18"].exports

var mobileRegex = /mobile/i;

var Client = Class(function() {
	
	this.init = function(userAgent) {
		this._userAgent = userAgent
		this._parseBrowser()
		this._parseDevice()
	}
	
	this._parseBrowser = function() {
		(this.isChrome = this._isBrowser('Chrome'))
			|| (this.isFirefox = this._isBrowser('Firefox'))
			|| (this.isIE = this._isBrowser('MSIE'))
			|| (this.isSkyfire = this._isBrowser('Skyfire', 'Skyfire')) // Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_5_7; en-us) AppleWebKit/530.17 (KHTML, like Gecko) Version/4.0 Safari/530.17 Skyfire/2.0
			|| (this.isSafari = this._isBrowser('Safari', 'Version'))
			|| (this.isOpera = this._isBrowser('Opera', 'Version'))
		
		if (this.isOpera) {
			if (this._userAgent.match('Opera Mini')) { this.isOperaMini = true } // Opera mini is a cloud browser - Opera/9.80 (Android 2.3.4; Linux; Opera Mobi/ADR-1110171336; U; en) Presto/2.9.201 Version/11.50
		}
		
		try {
			document.createEvent("TouchEvent")
			this.isTouch = ('ontouchstart' in window)
		} catch (e) {
			this.isTouch = false
		}
	}
	
	this._parseDevice = function() {
		((this.isIPhone = this._is('iPhone'))
			|| (this.isIPad = this._is('iPad'))
			|| (this.isIPod = this._is('iPod')))
		
		this.isAndroid = this._isBrowser('Android', 'Version')
		this.isIOS = (this.isIPhone || this.isIPad || this.isIPod)
		
		if (this.isIOS) {
			var osVersionMatch = this._userAgent.match(/ OS ([\d_]+) /),
				osVersion = osVersionMatch ? osVersionMatch[1] : '',
				parts = osVersion.split('_'),
				version = { major:parseInt(parts[0]), minor:parseInt(parts[1]), patch:parseInt(parts[2]) }
			
			this.os = { version:version }
		}
		
		if (this.isOpera && this._userAgent.match('Opera Mobi')) { this.isMobile = true } // Opera mobile is a proper mobile browser - Opera/9.80 (Android; Opera Mini/6.5.26571/ 26.1069; U; en) Presto/2.8.119 Version/10.54
		if (this.isSkyfire) { this.isMobile = true }
		if (this.isIPhone) { this.isMobile = true }
		if (this.isAndroid) {
			if (this._userAgent.match(mobileRegex)) { this.isMobile = true }
			if (this.isFirefox) { this.isMobile = true } // Firefox Android browsers do not seem to have an indication that it's a phone vs a tablet: Mozilla/5.0 (Android; Linux armv7l; rv:7.0.1) Gecko/20110928 Firefox/7.0.1 Fennec/7.0.1
		}
		
		this.isTablet = this.isIPad
	}
	
	this.isQuirksMode = function(doc) {
		// in IE, if compatMode is undefined (early ie) or explicitly set to BackCompat, we're in quirks
		return this.isIE && (!doc.compatMode || doc.compatMode == 'BackCompat')
	}
	
	this._isBrowser = function(name, versionString) {
		if (!this._is(name)) { return false }
		var agent = this._userAgent,
			index = agent.indexOf(versionString || name)
		this.version = parseFloat(agent.substr(index + (versionString || name).length + 1))
		this.name = name
		return true
	}

	this._is = function(name) {
		return (this._userAgent.indexOf(name) >= 0)
	}
})

if (typeof window != 'undefined') { module.exports = new Client(window.navigator.userAgent) }
else { module.exports = {} }

module.exports.parse = function(userAgent) { return new Client(userAgent) }

})()

;(function() {
	// /usr/local/lib/node_modules/fun/node_modules/dom/getWindowScroll
	var module = __require__["_20"] = {exports:{}}, exports = module.exports;
// Thanks http://stackoverflow.com/questions/1567327/using-jquery-to-get-elements-position-relative-to-viewport!
module.exports = function getWindowScroll(win) {
	var win = win || window,
		doc = win.document,
		docEl = doc.documentElement,
		body = doc.body
	
	return {
		top:  win.pageYOffset || (docEl && docEl.scrollTop) || body.scrollTop,
		left: win.pageXOffset || (docEl && docEl.scrollLeft) || body.scrollLeft
	}
}

})()

;(function() {
	// /usr/local/lib/node_modules/fun/node_modules/dom/getAttribute
	var module = __require__["_21"] = {exports:{}}, exports = module.exports;
module.exports = function(element, attribute) {
	if (element.getAttribute) {
		return element.getAttribute(attribute)
	} else {
		return element[attribute]
	}
}
})()

;(function() {
	// /usr/local/lib/node_modules/fun/node_modules/dom/setAttribute
	var module = __require__["_22"] = {exports:{}}, exports = module.exports;
module.exports = function setAttribute(element, attribute, value) {
	if (element.setAttribute) {
		element.setAttribute(attribute, value)
	} else {
		element[attribute] = value
	}
	return value
}
})()

;(function() {
	// /usr/local/lib/node_modules/fun/node_modules/dom/on
	var module = __require__["_23"] = {exports:{}}, exports = module.exports;
var unique = __require__["_17"].exports,
	curry = __require__["_12"].exports,
	client = __require__["_19"].exports,
	getWindowScroll = __require__["_20"].exports,
	proto = __require__["_5"].exports,
	getAttribute = __require__["_21"].exports,
	setAttribute = __require__["_22"].exports

module.exports = function on(element, eventName, handler) {
	var uniqueID = module.exports.stampElement(element),
		map = module.exports._elementMaps[uniqueID]
	if (!map) { map = module.exports._elementMaps[uniqueID] = {} }

	var eventListeners = map[eventName]
	if (!eventListeners) {
		eventListeners = map[eventName] = []
		eventListeners._realHandler = curry(module.exports._handleEvent, element, eventName)
		module.exports._addListener(element, eventName, eventListeners._realHandler)
	}
	eventListeners.push(handler)
}

module.exports._idNamespace = '__onID'
module.exports._elementMaps = {}

module.exports.stampElement = function(element) {
	var uniqueID = getAttribute(element, module.exports._idNamespace)
	if (!uniqueID) {
		uniqueID = unique()
		setAttribute(element, module.exports._idNamespace, uniqueID)
	}
	return uniqueID
}

module.exports.getElementMap = function(element) {
	var uniqueID = getAttribute(element, module.exports._idNamespace)
	return uniqueID && module.exports._elementMaps[uniqueID]
}

module.exports._addListener = function(element, eventName, handler) {
	if (window.addEventListener) {
		module.exports._addListener = function(element, eventName, handler) {
			if (eventName == 'mousewheel' && client.isFirefox) { eventName = 'MozMousePixelScroll' }
			element.addEventListener(eventName, handler, false)
		}
	} else if (window.attachEvent) {
		module.exports._addListener = function(element, eventName, handler) {
			element.attachEvent('on'+eventName, handler)
		}
	} else {
		module.exports._addListener = null
	}
	
	module.exports._addListener(element, eventName, handler)
}

module.exports._handleEvent = function(element, eventName, e) {
	var eventObj = module.exports.normalizeEvent(eventName, e),
		elementMap = module.exports.getElementMap(element),
		handlers = elementMap[eventName]
	for (var i=0; i<handlers.length; i++) {
		handlers[i].call(element, eventObj)
	}
}

var charCodes = {
	'c': 99,
	'r': 114
}

var keyCodes = {
	'tab': 9,
	'backspace': 8,
	'return': 13
}

var eventBase = {
	cancel: function() {
		var e = this.domEvent
		if (e.preventDefault) { e.preventDefault() }
		else { e.returnValue = false }
	},
	isCopy: function() {
		var e = this.domEvent
		return e.type == 'keypress' && e.metaKey && e.charCode == charCodes['c']
	},
	isRefresh: function() {
		var e = this.domEvent
		return e.type == 'keypress' && e.metaKey && e.charCode == charCodes['r']
	},
	isTab: function() {
		return this.keyCode == keyCodes['tab']
	},
	isBackspace:function() {
		return this.keyCode == keyCodes['backspace']
	},
	isReturn:function() {
		return this.keyCode == keyCodes['return']
	},
	_normalizeMouseWheel: function(eventName) {
		if (eventName != 'mousewheel') { return }
		// http://adomas.org/javascript-mouse-wheel/
		// https://developer.mozilla.org/en/Gecko-Specific_DOM_Events
		// TODO Normalize the values across browsers
		var e = this.domEvent
		if (typeof e.wheelDeltaX == 'number') {
			this.dx = -e.wheelDeltaX
			this.dy = -e.wheelDeltaY
		} else if (e.wheelDelta) {
			this.dy = -e.wheelDelta
		} else if (e.detail) {
			if (e.axis == e.HORIZONTAL_AXIS) { this.dx = e.detail }
			if (e.axis == e.VERTICAL_AXIS) { this.dy = e.detail }
		}
	},
	_normalizeXY: function(eventName, e) {
		var e = this.domEvent
		if (typeof e.pageX == 'number')   {
			this.x = e.pageX
			this.y = e.pageY
		} else if (typeof e.clientX == 'number') {
			var scroll = getWindowScroll(window)
			this.x = e.clientX + scroll.left
			this.y = e.clientY + scroll.top
		}
	},
	_normalizeKeyPress: function(eventName, e) {
		var e = this.domEvent
		if (e.type != 'keypress') { return }
		this.charCode = (this.charCode == 13 && this.keyCode == 13) 
			? 0 // in Webkit, return/enter key gives a charCode as well as a keyCode. Should only be a keyCode
			: e.charCode
	}
}
var Event = proto(eventBase,
	function(eventName, e) {
		this.domEvent = e
		this.keyCode = e.keyCode
		this.metaKey = e.metaKey
		this.target = e.target || e.srcElement
		this.source = e.source // postmessage
		this.origin = e.origin
		this.data = e.data
		this.touches = e.touches
		this.changedTouches = e.changedTouches
		this.type = e.type
		
		this._normalizeMouseWheel(eventName)
		this._normalizeXY()
		this._normalizeKeyPress()
	}
)

module.exports.normalizeEvent = function(eventName, e) {
	return new Event(eventName, e || event)
}

})()

;(function() {
	// /usr/local/lib/node_modules/fun/node_modules/dom/off
	var module = __require__["_24"] = {exports:{}}, exports = module.exports;
var on = __require__["_23"].exports

module.exports = function(element, eventName, handler) {
	var map = on.getElementMap(element),
		handlers = map[eventName]
	
	if (!handlers) { return }
	
	if (handler) {
		for (var i=0; i<handlers.length; i++) {
			if (handler != handlers[i]) { continue }
			handlers.splice(i, 1)
			break
		}
	}
		
	if (!handler || !handlers.length) {
		module.exports._removeHandler(element, eventName, handlers._realHandler)
		delete map[eventName]
	}
}

module.exports._removeHandler = function(element, eventName, handler) {
	if (window.removeEventListener) {
		module.exports._removeHandler = function(element, eventName, handler) {
			if (eventName == 'mousewheel' && client.isFirefox) { eventName = 'MozMousePixelScroll' }
			element.removeEventListener(eventName, handler, false)
		}
	} else if (window.detachEvent) {
		module.exports._removeHandler = function(element, eventName, handler) {
			element.detachEvent('on'+eventName, handler)
		}
	} else {
		module.exports._removeHandler = null
	}

	module.exports._removeHandler(element, eventName, handler)
}

})()

;(function() {
	// /usr/local/lib/node_modules/fun/src/runtime/library
	var module = __require__["_25"] = {exports:{}}, exports = module.exports;
var expressions = __require__["_11"].exports,
	each = __require__["_3"].exports,
	curry = __require__["_12"].exports,
	throttle = __require__["_13"].exports,
	addClass = __require__["_15"].exports,
	removeClass = __require__["_16"].exports,
	on = __require__["_23"].exports,
	off = __require__["_24"].exports,
	arrayToObject = __require__["_9"].exports

;(function() {
	if (typeof fun == 'undefined') { fun = {} }
	var _unique, _hooks, _hookCallbacks
	
	fun.reset = function() {
		_unique = 0
		fun.expressions = expressions
		_hooks = fun.hooks = {}
		_hookCallbacks = {}
	}
	
	fun.name = function(readable) { return '_' + (readable || '') + '_' + (_unique++) }

	fun.expressions = expressions
	
/* Values
 ********/
	fun.emit = function(parentHookName, value) {
		if (!value) { return }
		var hookName = fun.hook(fun.name(), parentHookName)
		value.observe(function() {
			_hooks[hookName].innerHTML = ''
			_hooks[hookName].appendChild(document.createTextNode(value))
		})
	}
	
	fun.set = function(value, chainStr, setValue) {
		if (arguments.length == 2) {
			setValue = chainStr
			chainStr = null
		}
		var chain = chainStr ? chainStr.split('.') : []
		while (chain.length) {
			value = expressions.dereference(value, expressions.Text(chain.shift()))
		}
		value.mutate('set', [expressions.fromJsValue(setValue)])
	}
	
	fun.dictSet = function(dict, prop, setValue) {
		dict.mutate('set', [expressions.fromJsValue(prop), expressions.fromJsValue(setValue)])
	}
	
/* Hooks
 *******/
	fun.setHook = function(name, dom) { _hooks[name] = dom }
	fun.hook = function(name, parentName, opts) {
		if (_hooks[name]) { return name }
		opts = opts || {}
		var parent = _hooks[parentName],
			hook = _hooks[name] = document.createElement(opts.tagName || 'hook')
		
		each(opts.attrs, function(attr) {
			if (attr.expand) { fun.attrExpand(name, attr.expand) }
			else { fun.attr(name, attr.name, attr.value) }
		})
		
		if (_hookCallbacks[name]) {
			for (var i=0, callback; callback = _hookCallbacks[name][i]; i++) {
				callback(hook)
			}
		}
		
		if (!parent.childNodes.length || !opts.prepend) { parent.appendChild(hook) }
		else { parent.insertBefore(hook, parent.childNodes[0]) }
		
		return name
	}
	fun.destroyHook = function(hookName) {
		if (!_hooks[hookName]) { return }
		_hooks[hookName].innerHTML = ''
	}
	fun.withHook = function(hookName, callback) {
		if (_hooks[hookName]) { return callback(_hooks[hookName]) }
		else if (_hookCallbacks[hookName]) { _hookCallbacks[hookName].push(callback) }
		else { _hookCallbacks[hookName] = [callback] }
	}

	fun.attr = function(hookName, key, value) {
		if (key == 'data') {
			fun.reflectInput(hookName, value)
			return
		}
		var hook = _hooks[hookName],
			lastValue
		value.observe(function() {
			if (match = key.match(/^on(\w+)$/)) {
				if (lastValue) { off(hook, eventName, lastValue) }
				
				var eventName = match[1].toLowerCase()
				if (value.getType() != 'Handler') {
					console.warn('Event attribute', eventName, 'value is not a Handler')
					return
				}
				on(hook, eventName, lastValue = function(e) {
					e.hook = hook
					value.evaluate().invoke([expressions.Event(e)])
				})
			} else if (key == 'style') {
				// TODO remove old styles
				each(value.getContent(), function(val, key) {
					fun.setStyle(hook, key, val)
				})
			} else if (key == 'class' || key == 'className') {
				if (lastValue) { removeClass(hook, lastValue) }
				addClass(hook, lastValue = value.getContent())
			} else {
				hook.setAttribute(key, value.getContent())
			}
		})
	}
	
	fun.attrExpand = function(hookName, expandValue) {
		// TODO Observe the expandValue, and detect keys getting added/removed properly
		each(expandValue.getContent(), function(value, name) {
			name = _getDictionaryKeyString(name)
			fun.attr(hookName, name, value)
		})
	}
	
	var _getDictionaryKeyString = function(key) {
		key = fun.expressions.fromLiteral(key)
		if (key.getType() != 'Text') { return }
		return key.getContent()
	}

	var skipPx = arrayToObject(['zIndex', 'z-index'])
	fun.setStyle = function(hook, key, value) {
		key = _getDictionaryKeyString(key)
		if (!key) { return }
		
		value = value.evaluate()
		var rawValue = value.toString()
		
		if ((value.getType() == 'Number' || rawValue.match(/^\d+$/)) && !skipPx[key]) {
			rawValue = rawValue + 'px'
		}
		if (key == 'float') { key = 'cssFloat' }
		hook.style[key] = rawValue
	}
	
	fun.reflectInput = function(hookName, property) {
		var input = _hooks[hookName]
		if (input.type == 'checkbox') {
			property.observe(function() {
				input.checked = property.getContent() ? true : false
			})
			on(input, 'change', function() {
				setTimeout(function() {
					_doSet(property, input.checked ? fun.expressions.Yes : fun.expressions.No)
				})
			})
		} else {
			property.observe(function() {
				input.value = property.evaluate().toString()
			})
			
			function update(e) {
				setTimeout(function() {
					var value = input.value
					if (property.getContent() === value) { return }
					_doSet(property, fun.expressions.Text(input.value))
					input.value = value
				}, 0)
			}
			
			on(input, 'keypress', update)
			on(input, 'keyup', update)
			on(input, 'keydown', function(e) {
				if (e.keyCode == 86) { update(e) } // catch paste events
			})
		}
		function _doSet(property, value) {
			if (property._type == 'dereference') {
				var components = property.components
				fun.dictSet(components.value, components.key, value)
			} else {
				fun.set(property, value)
			}
		}
	}

/* init & export
 ***************/
	fun.reset()
	if (typeof module != 'undefined') { module.exports = fun }
})()

})()

;(function() {
	// /usr/local/lib/node_modules/fun/node_modules/std/strip
	var module = __require__["_26"] = {exports:{}}, exports = module.exports;
var stripRegex = /^\s*(.*?)\s*$/
module.exports = function(str) {
	return str.match(stripRegex)[1]
}


})()

;(function() {
	// <code passed into compiler.compile()>
	var module = __require__["_0"] = {exports:{}}, exports = module.exports;
fun = __require__["_25"].exports; 

;(function funApp() {
	var _ROOT_HOOK_0 = fun.name("rootHook")
	fun.setHook(_ROOT_HOOK_0, document.body)
	/************************************************************************
 * Module: /usr/local/lib/node_modules/fun/src/modules/localstorage.fun *
 ************************************************************************/
	var __variableName__localstorage = fun.expressions.variable( fun.expressions.Dictionary({ "persist": fun.expressions.Function(function block(yieldValue, __hackFirstExecution, __variableName__variable, __variableName__name) { 
		;(function(){
		/* START INLINE JAVASCRIPT */
			var variable=__variableName__variable, name=__variableName__name;
 if (!__hackFirstExecution) { return }
 var key = name.getContent(),
 persistedLiteral = localStorage.getItem(key)
 if (persistedLiteral && persistedLiteral != "null") {
 variable.mutate("set", [fun.expressions.fromLiteral(persistedLiteral)])
 }
 variable.observe(function() {
 localStorage.setItem(key, variable.asLiteral())
 })
		/* END INLINE JAVASCRIPT */
		})() }) }))
/****************************************************************
 * Module: /usr/local/lib/node_modules/fun/src/modules/list.fun *
 ****************************************************************/
	var __variableName__list = fun.expressions.variable( fun.expressions.Dictionary({ "filter": fun.expressions.Function(function block(yieldValue, __hackFirstExecution, __variableName__list, __variableName__func) { 
		;(function(){
		/* START INLINE JAVASCRIPT */
			var list=__variableName__list, func=__variableName__func;
 var result = [],
 items = list.getContent()
 for (var i=0, item; item=items[i]; i++) {
 if (func.invoke([item]).isTruthy()) {
 result.push(item)
 }
 }
 yieldValue(result)
		/* END INLINE JAVASCRIPT */
		})() }) }))
/****************************************************************
 * Module: /usr/local/lib/node_modules/fun/src/modules/text.fun *
 ****************************************************************/
	var __variableName__text = fun.expressions.variable( fun.expressions.Dictionary({ "trim": fun.expressions.Function(function block(yieldValue, __hackFirstExecution, __variableName__text) { 
		;(function(){
		/* START INLINE JAVASCRIPT */
			var text=__variableName__text;
 var strip = __require__["_26"].exports
 yieldValue(fun.expressions.Text(strip(text.getContent())))
		/* END INLINE JAVASCRIPT */
		})() }) }))
/****************************************************************
 * Module: /usr/local/lib/node_modules/fun/src/modules/uuid.fun *
 ****************************************************************/
	var __variableName__uuid = fun.expressions.variable( fun.expressions.Dictionary({ "v4": fun.expressions.Function(function block(yieldValue, __hackFirstExecution) { 
		var __variableName__result = fun.expressions.variable( fun.expressions.Null(null))
		;(function(){
		/* START INLINE JAVASCRIPT */
			var result=__variableName__result;
 var uuid = "", i, random;
 for (i = 0; i < 32; i++) {
 random = Math.random() * 16 | 0;
 if (i == 8 || i == 12 || i == 16 || i == 20) {
 uuid += "-"
 }
 uuid += (i == 12 ? 4 : (i == 16 ? (random & 3 | 8) : random)).toString(16);
 }
 fun.set(result, uuid)
		/* END INLINE JAVASCRIPT */
		})()
		yieldValue(  fun.expressions.dereference(__variableName__result,  fun.expressions.Text("copy")).invoke([], "")); return }) }))
/***************************************************************
 * Module: /usr/local/lib/node_modules/fun/src/modules/app.fun *
 ***************************************************************/
	var __variableName__app = fun.expressions.variable( fun.expressions.Dictionary({ "whenLoaded": fun.expressions.Function(function block(yieldValue, __hackFirstExecution, __variableName__appLoadedHandler) { 
		;(function(){
		/* START INLINE JAVASCRIPT */
			var appLoadedHandler=__variableName__appLoadedHandler;
 setTimeout(function() {
 appLoadedHandler.invoke()
 })
		/* END INLINE JAVASCRIPT */
		})() }) }))
	var _XML_HOOK_1 = fun.name()
	fun.hook(_XML_HOOK_1, _ROOT_HOOK_0, { tagName:"head", attrs:null })
		var _XML_HOOK_2 = fun.name()
		fun.hook(_XML_HOOK_2, _XML_HOOK_1, { tagName:"meta", attrs:[{name:"charset",value: fun.expressions.Text("utf-8")}] })
		var _XML_HOOK_3 = fun.name()
		fun.hook(_XML_HOOK_3, _XML_HOOK_1, { tagName:"title", attrs:null })
			fun.emit(_XML_HOOK_3,  fun.expressions.Text("Fun • TodoMVC"))
	var __variableName__tasks = fun.expressions.variable( fun.expressions.List([  ]))
	var __variableName__displayFilter = fun.expressions.variable( fun.expressions.Text("all"))
	 fun.expressions.dereference(__variableName__app,  fun.expressions.Text("whenLoaded")).render(fun.hook(fun.name(), _ROOT_HOOK_0), [ fun.expressions.Handler(function block() { 	
		 fun.expressions.dereference(__variableName__localstorage,  fun.expressions.Text("persist")).invoke([__variableName__tasks, fun.expressions.Text("todos-fun.tasks")])
		 fun.expressions.dereference(__variableName__localstorage,  fun.expressions.Text("persist")).invoke([__variableName__displayFilter, fun.expressions.Text("todos-fun.displayFilter")]) })])
	var __variableName__getVisibleTasks = fun.expressions.variable( fun.expressions.Function(function block(yieldValue, __hackFirstExecution, __variableName__displayFilter) { 
		yieldValue(  fun.expressions.dereference(__variableName__list,  fun.expressions.Text("filter")).invoke([__variableName__tasks, fun.expressions.Function(function block(yieldValue, __hackFirstExecution, __variableName__task) { 
			;(function(ifBranch, elseBranch) {
				 fun.expressions.binaryOp(__variableName__displayFilter, "=",  fun.expressions.Text("all")).isTruthy() ? ifBranch() : elseBranch()
			})(
				function ifBranch(){
				yieldValue( fun.expressions.Logic(true)); return
				},
				function elseBranch(){
				;(function(ifBranch, elseBranch) {
					 fun.expressions.binaryOp(__variableName__displayFilter, "=",  fun.expressions.Text("active")).isTruthy() ? ifBranch() : elseBranch()
				})(
					function ifBranch(){
					yieldValue( fun.expressions.unaryOp("!",  fun.expressions.dereference(__variableName__task,  fun.expressions.Text("completed")))); return
					},
					function elseBranch(){
					;(function(ifBranch, elseBranch) {
						 fun.expressions.binaryOp(__variableName__displayFilter, "=",  fun.expressions.Text("completed")).isTruthy() ? ifBranch() : elseBranch()
					})(
						function ifBranch(){
						yieldValue( fun.expressions.dereference(__variableName__task,  fun.expressions.Text("completed"))); return
						},
						function elseBranch(){
							null
						}
					)
					}
				)
				}
			) })], "")); return }))
	var __variableName__createTask = fun.expressions.variable( fun.expressions.Handler(function block(__variableName__taskName) { 	
		var __variableName__trimmedName = fun.expressions.variable(  fun.expressions.dereference(__variableName__text,  fun.expressions.Text("trim")).invoke([__variableName__taskName], ""))
		;(function(ifBranch, elseBranch) {
			 fun.expressions.binaryOp(__variableName__trimmedName, "!",  fun.expressions.Text("")).isTruthy() ? ifBranch() : elseBranch()
		})(
			function ifBranch(){
			__variableName__tasks.mutate("push", [ fun.expressions.Dictionary({ "title":__variableName__trimmedName, "completed": fun.expressions.Logic(false), "id":  fun.expressions.dereference(__variableName__uuid,  fun.expressions.Text("v4")).invoke([], "") })])
			},
			function elseBranch(){
				null
			}
		) }))
	var __variableName__destroyTask = fun.expressions.variable( fun.expressions.Handler(function block(__variableName__task) { 	
		__variableName__tasks.mutate("set", [  fun.expressions.dereference(__variableName__list,  fun.expressions.Text("filter")).invoke([  fun.expressions.dereference(__variableName__tasks,  fun.expressions.Text("copy")).invoke([], ""), fun.expressions.Function(function block(yieldValue, __hackFirstExecution, __variableName__checkTask) { 
			yieldValue( fun.expressions.binaryOp( fun.expressions.dereference(__variableName__checkTask,  fun.expressions.Text("id")), "!",  fun.expressions.dereference(__variableName__task,  fun.expressions.Text("id")))); return })], "")]) }))
	var _XML_HOOK_4 = fun.name()
	fun.hook(_XML_HOOK_4, _ROOT_HOOK_0, { tagName:"section", attrs:[{name:"id",value: fun.expressions.Text("todoapp")}] })
		var _XML_HOOK_5 = fun.name()
		fun.hook(_XML_HOOK_5, _XML_HOOK_4, { tagName:"header", attrs:[{name:"id",value: fun.expressions.Text("header")}] })
			var _XML_HOOK_6 = fun.name()
			fun.hook(_XML_HOOK_6, _XML_HOOK_5, { tagName:"h1", attrs:null })
				fun.emit(_XML_HOOK_6,  fun.expressions.Text("todos"))
			var __variableName__newTaskName = fun.expressions.variable( fun.expressions.Text(""))
			var _XML_HOOK_7 = fun.name()
			fun.hook(_XML_HOOK_7, _XML_HOOK_5, { tagName:"input", attrs:[{name:"id",value: fun.expressions.Text("new-todo")}, {name:"placeholder",value: fun.expressions.Text("What needs to be done?")}, {name:"autofocus",value: fun.expressions.Logic(true)}, {name:"data",value:__variableName__newTaskName}, {name:"onkeypress",value: fun.expressions.Handler(function block(__variableName__event) { 	
				var __variableName__enterKey = fun.expressions.variable( fun.expressions.Number(13))
				;(function(ifBranch, elseBranch) {
					 fun.expressions.binaryOp( fun.expressions.dereference(__variableName__event,  fun.expressions.Text("keyCode")), "=", __variableName__enterKey).isTruthy() ? ifBranch() : elseBranch()
				})(
					function ifBranch(){
					__variableName__createTask.invoke([  fun.expressions.dereference(__variableName__newTaskName,  fun.expressions.Text("copy")).invoke([], "")])
					__variableName__newTaskName.mutate("set", [ fun.expressions.Text("")])
					},
					function elseBranch(){
						null
					}
				) })}] })
		var _IF_ELSE_HOOK_8 = fun.name()
		fun.hook(_IF_ELSE_HOOK_8, _XML_HOOK_4)
		var _LAST_VALUE_9
		 fun.expressions.dereference(__variableName__tasks,  fun.expressions.Text("length")).observe(function() {
			var _STATEMENT_VALUE_32 =  fun.expressions.dereference(__variableName__tasks,  fun.expressions.Text("length")).evaluate()
		;(function(ifBranch, elseBranch) {
			if (_LAST_VALUE_9 && _STATEMENT_VALUE_32.equals(_LAST_VALUE_9).isTruthy()) { return }
			_LAST_VALUE_9 = _STATEMENT_VALUE_32
			fun.destroyHook(_IF_ELSE_HOOK_8)
			_LAST_VALUE_9.isTruthy() ? ifBranch() : elseBranch()
		})(
			function ifBranch(){
			var _XML_HOOK_10 = fun.name()
			fun.hook(_XML_HOOK_10, _IF_ELSE_HOOK_8, { tagName:"section", attrs:[{name:"id",value: fun.expressions.Text("main")}] })
				var __variableName__toggleAll = fun.expressions.variable( fun.expressions.Logic(false))
				var _XML_HOOK_11 = fun.name()
				fun.hook(_XML_HOOK_11, _XML_HOOK_10, { tagName:"input", attrs:[{name:"id",value: fun.expressions.Text("toggle-all")}, {name:"type",value: fun.expressions.Text("checkbox")}, {name:"checked",value:__variableName__toggleAll}, {name:"onchange",value: fun.expressions.Handler(function block() { 	
					__variableName__toggleAll.mutate("set", [ fun.expressions.unaryOp("!",   fun.expressions.dereference(__variableName__toggleAll,  fun.expressions.Text("copy")).invoke([], ""))])
					__variableName__tasks.evaluate().iterate(function(__variableName__task) {
						__variableName__task.mutate("set", [ fun.expressions.Text("completed"),  fun.expressions.unaryOp("!",   fun.expressions.dereference(__variableName__toggleAll,  fun.expressions.Text("copy")).invoke([], ""))])
					}) })}] })
				var _XML_HOOK_12 = fun.name()
				fun.hook(_XML_HOOK_12, _XML_HOOK_10, { tagName:"ul", attrs:[{name:"id",value: fun.expressions.Text("todo-list")}] })
					var _FOR_LOOP_HOOK_14 = fun.name()
					fun.hook(_FOR_LOOP_HOOK_14, _XML_HOOK_12)
					 __variableName__getVisibleTasks.invoke([__variableName__displayFilter], _XML_HOOK_12).observe(function() {
						fun.destroyHook(_FOR_LOOP_HOOK_14)
						 __variableName__getVisibleTasks.invoke([__variableName__displayFilter], _XML_HOOK_12).evaluate().iterate(function(__variableName__task) {
							var _FOR_LOOP_EMIT_HOOK_13 = fun.name()
							fun.hook(_FOR_LOOP_EMIT_HOOK_13, _FOR_LOOP_HOOK_14)
						var __variableName__editing = fun.expressions.variable( fun.expressions.Logic(false))
						var _XML_HOOK_15 = fun.name()
						fun.hook(_XML_HOOK_15, _FOR_LOOP_EMIT_HOOK_13, { tagName:"li", attrs:[{name:"class",value: fun.expressions.binaryOp( fun.expressions.ternaryOp( fun.expressions.dereference(__variableName__task,  fun.expressions.Text("completed")),  fun.expressions.Text("completed"),  fun.expressions.Text("")), "+",  fun.expressions.ternaryOp(__variableName__editing,  fun.expressions.Text(" editing"),  fun.expressions.Text("")))}] })
							var _XML_HOOK_16 = fun.name()
							fun.hook(_XML_HOOK_16, _XML_HOOK_15, { tagName:"div", attrs:[{name:"class",value: fun.expressions.Text("view")}] })
								var _XML_HOOK_17 = fun.name()
								fun.hook(_XML_HOOK_17, _XML_HOOK_16, { tagName:"input", attrs:[{name:"class",value: fun.expressions.Text("toggle")}, {name:"type",value: fun.expressions.Text("checkbox")}, {name:"data",value: fun.expressions.dereference(__variableName__task,  fun.expressions.Text("completed"))}] })
								var _XML_HOOK_18 = fun.name()
								fun.hook(_XML_HOOK_18, _XML_HOOK_16, { tagName:"label", attrs:[{name:"ondblclick",value: fun.expressions.Handler(function block() { 	
									__variableName__editing.mutate("set", [ fun.expressions.Logic(true)]) })}] })
									fun.emit(_XML_HOOK_18,  fun.expressions.dereference(__variableName__task,  fun.expressions.Text("title")))
								var _XML_HOOK_19 = fun.name()
								fun.hook(_XML_HOOK_19, _XML_HOOK_16, { tagName:"button", attrs:[{name:"class",value: fun.expressions.Text("destroy")}, {name:"onclick",value: fun.expressions.Handler(function block() { 	
									__variableName__destroyTask.invoke([__variableName__task]) })}] })
							var __variableName__newTitle = fun.expressions.variable( fun.expressions.dereference(__variableName__task,  fun.expressions.Text("title")))
							var _XML_HOOK_20 = fun.name()
							fun.hook(_XML_HOOK_20, _XML_HOOK_15, { tagName:"input", attrs:[{name:"class",value: fun.expressions.Text("edit")}, {name:"data",value:__variableName__newTitle}, {name:"autofocus",value: fun.expressions.Logic(true)}, {name:"onblur",value: fun.expressions.Handler(function block() { 	
								__variableName__task.mutate("set", [ fun.expressions.Text("title"),   fun.expressions.dereference(__variableName__newTitle,  fun.expressions.Text("copy")).invoke([], "")]) })}] })
						})
					})
			var _XML_HOOK_21 = fun.name()
			fun.hook(_XML_HOOK_21, _IF_ELSE_HOOK_8, { tagName:"footer", attrs:[{name:"id",value: fun.expressions.Text("footer")}] })
				var __variableName__completedTasks = fun.expressions.variable(  fun.expressions.dereference(__variableName__list,  fun.expressions.Text("filter")).invoke([__variableName__tasks, fun.expressions.Function(function block(yieldValue, __hackFirstExecution, __variableName__task) { 
					yieldValue( fun.expressions.dereference(__variableName__task,  fun.expressions.Text("completed"))); return })], _XML_HOOK_21))
				var _XML_HOOK_22 = fun.name()
				fun.hook(_XML_HOOK_22, _XML_HOOK_21, { tagName:"span", attrs:[{name:"id",value: fun.expressions.Text("todo-count")}] })
					var __variableName__pluralize = fun.expressions.variable( fun.expressions.Function(function block(yieldValue, __hackFirstExecution, __variableName__num) { 
						yieldValue( fun.expressions.ternaryOp( fun.expressions.binaryOp(__variableName__num, ">",  fun.expressions.Number(1)),  fun.expressions.Text("items"),  fun.expressions.Text("item"))); return }))
					var __variableName__numTasksLeft = fun.expressions.variable( fun.expressions.binaryOp( fun.expressions.dereference(__variableName__tasks,  fun.expressions.Text("length")), "-",  fun.expressions.dereference(__variableName__completedTasks,  fun.expressions.Text("length"))))
					var _XML_HOOK_23 = fun.name()
					fun.hook(_XML_HOOK_23, _XML_HOOK_22, { tagName:"strong", attrs:null })
						fun.emit(_XML_HOOK_23, __variableName__numTasksLeft)
					fun.emit(_XML_HOOK_22,  fun.expressions.Text(" "))
					__variableName__pluralize.render(fun.hook(fun.name(), _XML_HOOK_22), [__variableName__numTasksLeft])
					fun.emit(_XML_HOOK_22,  fun.expressions.Text(" left"))
				var _XML_HOOK_24 = fun.name()
				fun.hook(_XML_HOOK_24, _XML_HOOK_21, { tagName:"ul", attrs:[{name:"id",value: fun.expressions.Text("filters")}] })
					var _XML_HOOK_25 = fun.name()
					fun.hook(_XML_HOOK_25, _XML_HOOK_24, { tagName:"li", attrs:[{name:"onclick",value: fun.expressions.Handler(function block() { 	
						__variableName__displayFilter.mutate("set", [ fun.expressions.Text("all")]) })}] })
						var _XML_HOOK_26 = fun.name()
						fun.hook(_XML_HOOK_26, _XML_HOOK_25, { tagName:"a", attrs:[{name:"href",value: fun.expressions.Text("#")}, {name:"class",value: fun.expressions.ternaryOp( fun.expressions.binaryOp(__variableName__displayFilter, "=",  fun.expressions.Text("all")),  fun.expressions.Text("selected"),  fun.expressions.Text(""))}] })
							fun.emit(_XML_HOOK_26,  fun.expressions.Text("All"))
					var _XML_HOOK_27 = fun.name()
					fun.hook(_XML_HOOK_27, _XML_HOOK_24, { tagName:"li", attrs:[{name:"onclick",value: fun.expressions.Handler(function block() { 	
						__variableName__displayFilter.mutate("set", [ fun.expressions.Text("active")]) })}] })
						var _XML_HOOK_28 = fun.name()
						fun.hook(_XML_HOOK_28, _XML_HOOK_27, { tagName:"a", attrs:[{name:"href",value: fun.expressions.Text("#")}, {name:"class",value: fun.expressions.ternaryOp( fun.expressions.binaryOp(__variableName__displayFilter, "=",  fun.expressions.Text("active")),  fun.expressions.Text("selected"),  fun.expressions.Text(""))}] })
							fun.emit(_XML_HOOK_28,  fun.expressions.Text("Active"))
					var _XML_HOOK_29 = fun.name()
					fun.hook(_XML_HOOK_29, _XML_HOOK_24, { tagName:"li", attrs:[{name:"onclick",value: fun.expressions.Handler(function block() { 	
						__variableName__displayFilter.mutate("set", [ fun.expressions.Text("completed")]) })}] })
						var _XML_HOOK_30 = fun.name()
						fun.hook(_XML_HOOK_30, _XML_HOOK_29, { tagName:"a", attrs:[{name:"href",value: fun.expressions.Text("#")}, {name:"class",value: fun.expressions.ternaryOp( fun.expressions.binaryOp(__variableName__displayFilter, "=",  fun.expressions.Text("completed")),  fun.expressions.Text("selected"),  fun.expressions.Text(""))}] })
							fun.emit(_XML_HOOK_30,  fun.expressions.Text("Completed"))
				var _XML_HOOK_31 = fun.name()
				fun.hook(_XML_HOOK_31, _XML_HOOK_21, { tagName:"button", attrs:[{name:"id",value: fun.expressions.Text("clear-completed")}, {name:"onclick",value: fun.expressions.Handler(function block() { 	
					var __variableName__remainingTasks = fun.expressions.variable(  fun.expressions.dereference(__variableName__list,  fun.expressions.Text("filter")).invoke([__variableName__tasks, fun.expressions.Function(function block(yieldValue, __hackFirstExecution, __variableName__task) { 
						yieldValue( fun.expressions.unaryOp("!",  fun.expressions.dereference(__variableName__task,  fun.expressions.Text("completed")))); return })], ""))
					__variableName__tasks.mutate("set", [  fun.expressions.dereference(__variableName__remainingTasks,  fun.expressions.Text("copy")).invoke([], "")])
					__variableName__displayFilter.mutate("set", [  fun.expressions.dereference(__variableName__displayFilter,  fun.expressions.Text("copy")).invoke([], "")]) })}] })
					fun.emit(_XML_HOOK_31,  fun.expressions.Text("Clear completed ("))
					fun.emit(_XML_HOOK_31,  fun.expressions.dereference(__variableName__completedTasks,  fun.expressions.Text("length")))
					fun.emit(_XML_HOOK_31,  fun.expressions.Text(")"))
			},
			function elseBranch(){
				null
			}
		)
		})
	var _XML_HOOK_33 = fun.name()
	fun.hook(_XML_HOOK_33, _ROOT_HOOK_0, { tagName:"footer", attrs:[{name:"id",value: fun.expressions.Text("info")}] })
		var _XML_HOOK_34 = fun.name()
		fun.hook(_XML_HOOK_34, _XML_HOOK_33, { tagName:"p", attrs:null })
			fun.emit(_XML_HOOK_34,  fun.expressions.Text("Double-click to edit a todo"))
		var _XML_HOOK_35 = fun.name()
		fun.hook(_XML_HOOK_35, _XML_HOOK_33, { tagName:"p", attrs:null })
			fun.emit(_XML_HOOK_35,  fun.expressions.Text("Created with "))
			var _XML_HOOK_36 = fun.name()
			fun.hook(_XML_HOOK_36, _XML_HOOK_35, { tagName:"a", attrs:[{name:"href",value: fun.expressions.Text("https://github.com/marcuswestin/fun")}] })
				fun.emit(_XML_HOOK_36,  fun.expressions.Text("Fun"))
			fun.emit(_XML_HOOK_35,  fun.expressions.Text(" by "))
			var _XML_HOOK_37 = fun.name()
			fun.hook(_XML_HOOK_37, _XML_HOOK_35, { tagName:"a", attrs:[{name:"href",value: fun.expressions.Text("http://marcuswest.in")}] })
				fun.emit(_XML_HOOK_37,  fun.expressions.Text("Marcus Westin"))
})();
})()
</script></body></html>
