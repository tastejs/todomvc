((function(){var a,b=[].slice;a=function(){var c;return c=1<=arguments.length?b.call(arguments,0):[],function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b),f=typeof e;return f=="object"||f=="function"?e||d:d}(a.Object,c,function(){})},a.version="0.14.1",a.config={pathPrefix:"/",viewPrefix:"views",fetchRemoteViews:!0,usePushState:!1,minificationErrors:!0},(a.container=function(){return this}()).Batman=a,typeof define=="function"&&define("batman",[],function(){return a}),a.exportHelpers=function(b){var c,d,e,f;f=["mixin","extend","unmixin","redirect","typeOf","redirect","setImmediate","clearImmediate"];for(d=0,e=f.length;d<e;d++)c=f[d],b["$"+c]=a[c];return b},a.exportGlobals=function(){return a.exportHelpers(a.container)}})).call(this),function(){var a;Batman._Batman=a=function(){function a(a){this.object=a}return a.prototype.check=function(a){return a!==this.object?(a._batman=new Batman._Batman(a),!1):!0},a.prototype.get=function(a){var b,c;c=this.getAll(a);switch(c.length){case 0:return void 0;case 1:return c[0];default:return b=c[0].concat!=null?function(a,b){return a.concat(b)}:c[0].merge!=null?function(a,b){return a.merge(b)}:c.every(function(a){return typeof a=="object"})?(c.unshift({}),function(a,b){return Batman.extend(a,b)}):void 0,b?c.reduceRight(b):c}},a.prototype.getFirst=function(a){var b;return b=this.getAll(a),b[0]},a.prototype.getAll=function(a){var b,c,d;return typeof a=="function"?b=a:b=function(b){var c;return(c=b._batman)!=null?c[a]:void 0},c=this.ancestors(b),(d=b(this.object))&&c.unshift(d),c},a.prototype.ancestors=function(a){var b,c,d,e,f,g;this._allAncestors||(this._allAncestors=this.allAncestors());if(a){c=[],g=this._allAncestors;for(e=0,f=g.length;e<f;e++)b=g[e],d=a(b),d!=null&&c.push(d);return c}return this._allAncestors},a.prototype.allAncestors=function(){var a,b,c,d,e,f;return d=[],a=!!this.object.prototype,b=a?(e=this.object.__super__)!=null?e.constructor:void 0:(c=Object.getPrototypeOf(this.object))===this.object?this.object.constructor.__super__:c,b!=null&&((f=b._batman)!=null&&f.check(b),d.push(b),b._batman!=null&&(d=d.concat(b._batman.allAncestors()))),d},a.prototype.set=function(a,b){return this[a]=b},a}()}.call(this),function(){var a,b,c,d,e,f,g,h,i=[].slice,j={}.hasOwnProperty,k=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};Batman.typeOf=function(a){return typeof a=="undefined"?"Undefined":f.call(a).slice(8,-1)},f=Object.prototype.toString,Batman.extend=function(){var a,b,c,d,e,f,g;d=arguments[0],c=2<=arguments.length?i.call(arguments,1):[];for(f=0,g=c.length;f<g;f++){b=c[f];for(a in b)e=b[a],d[a]=e}return d},Batman.mixin=function(){var a,b,c,d,e,f,g,h;e=arguments[0],d=2<=arguments.length?i.call(arguments,1):[],a=typeof e.set=="function";for(g=0,h=d.length;g<h;g++){c=d[g];if(Batman.typeOf(c)!=="Object")continue;for(b in c){if(!j.call(c,b))continue;f=c[b];if(b==="initialize"||b==="uninitialize"||b==="prototype")continue;a?e.set(b,f):e.nodeName!=null?Batman.data(e,b,f):e[b]=f}typeof c.initialize=="function"&&c.initialize.call(e)}return e},Batman.unmixin=function(){var a,b,c,d,e,f;a=arguments[0],d=2<=arguments.length?i.call(arguments,1):[];for(e=0,f=d.length;e<f;e++){c=d[e];for(b in c){if(b==="initialize"||b==="uninitialize")continue;delete a[b]}typeof c.uninitialize=="function"&&c.uninitialize.call(a)}return a},Batman._functionName=Batman.functionName=function(a){var b;return a.__name__?a.__name__:a.name?a.name:(b=a.toString().match(/\W*function\s+([\w\$]+)\(/))!=null?b[1]:void 0},Batman._isChildOf=Batman.isChildOf=function(a,b){var c;c=b.parentNode;while(c){if(c===a)return!0;c=c.parentNode}return!1},e=function(a){var b,c,d,e,f,g,h;return b=function(){var b,c;return a.postMessage?(b=!0,c=a.onmessage,a.onmessage=function(){return b=!1},a.postMessage("","*"),a.onmessage=c,b):!1},h=new Batman.SimpleHash,c=0,e=function(){return"go"+ ++c},a.setImmediate&&a.clearImmediate?(Batman.setImmediate=a.setImmediate,Batman.clearImmediate=a.clearImmediate):b()?(g="com.batman.",d=new Batman.SimpleHash,f=function(a){var b,c;if(!~a.data.search(g))return;return b=a.data.substring(g.length),typeof (c=h.unset(b))=="function"?c():void 0},a.addEventListener?a.addEventListener("message",f,!1):a.attachEvent("onmessage",f),Batman.setImmediate=function(b){var c;return h.set(c=e(),b),a.postMessage(g+c,"*"),c},Batman.clearImmediate=function(a){return h.unset(a)}):typeof document!="undefined"&&k.call(document.createElement("script"),"onreadystatechange")>=0?(Batman.setImmediate=function(a){var b,c;return b=e(),c=document.createElement("script"),c.onreadystatechange=function(){var a;return typeof (a=h.get(b))=="function"&&a(),c.onreadystatechange=null,c.parentNode.removeChild(c),c=null},document.documentElement.appendChild(c),b},Batman.clearImmediate=function(a){return h.unset(a)}):(typeof process!="undefined"&&process!==null?process.nextTick:void 0)?(d={},Batman.setImmediate=function(a){var b;return b=e(),d[b]=a,process.nextTick(function(){return typeof d[b]=="function"&&d[b](),delete d[b]}),b},Batman.clearImmediate=function(a){return delete d[a]}):(Batman.setImmediate=function(a){return setTimeout(a,0)},Batman.clearImmediate=function(a){return clearTimeout(a)})},Batman.setImmediate=function(){return e(Batman.container),Batman.setImmediate.apply(this,arguments)},Batman.clearImmediate=function(){return e(Batman.container),Batman.clearImmediate.apply(this,arguments)},Batman.forEach=function(a,b,c){var d,e,f,g,h,i,j,k;if(a.forEach)return a.forEach(b,c);if(a.indexOf){j=[];for(e=h=0,i=a.length;h<i;e=++h)d=a[e],j.push(b.call(c,d,e,a));return j}k=[];for(f in a)g=a[f],k.push(b.call(c,f,g,a));return k},Batman.objectHasKey=function(a,b){return typeof a.hasKey=="function"?a.hasKey(b):b in a},Batman.contains=function(a,b){return a.indexOf?k.call(a,b)>=0:typeof a.has=="function"?a.has(b):Batman.objectHasKey(a,b)},Batman.get=function(a,b){return typeof a.get=="function"?a.get(b):Batman.Property.forBaseAndKey(a,b).getValue()},Batman.getPath=function(a,b){var c,d,e;for(d=0,e=b.length;d<e;d++){c=b[d];if(a==null)return void 0;a=Batman.get(a,c);if(a==null)return a}return a},d={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"},g=[],b=[];for(a in d)g.push(a),b.push(d[a]);h=new RegExp("["+g.join("")+"]","g"),c=new RegExp("("+b.join("|")+")","g"),Batman.escapeHTML=function(){return function(a){return(""+a).replace(h,function(a){return d[a]})}}(),Batman.unescapeHTML=function(){return function(a){var b;if(a==null)return;return b=Batman._unescapeHTMLNode||(Batman._unescapeHTMLNode=document.createElement("DIV")),b.innerHTML=a,b.innerText!=null?b.innerText:b.textContent}}(),Batman.translate=function(a,b){return b==null&&(b={}),Batman.helpers.interpolate(Batman.get(Batman.translate.messages,a),b)},Batman.translate.messages={},Batman.t=function(){return Batman.translate.apply(Batman,arguments)},Batman.redirect=function(a){var b;return(b=Batman.navigator)!=null?b.redirect(a):void 0},Batman.initializeObject=function(a){return a._batman!=null?a._batman.check(a):a._batman=new Batman._Batman(a)}}.call(this),function(){var a=[].slice,b=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};Batman.Inflector=function(){function c(){this._plural=[],this._singular=[],this._uncountable=[],this._human=[]}return c.prototype.plural=function(a,b){return this._plural.unshift([a,b])},c.prototype.singular=function(a,b){return this._singular.unshift([a,b])},c.prototype.human=function(a,b){return this._human.unshift([a,b])},c.prototype.uncountable=function(){var b;return b=1<=arguments.length?a.call(arguments,0):[],this._uncountable=this._uncountable.concat(b.map(function(a){return new RegExp(""+a+"$","i")}))},c.prototype.irregular=function(a,b){return a.charAt(0)===b.charAt(0)?(this.plural(new RegExp("("+a.charAt(0)+")"+a.slice(1)+"$","i"),"$1"+b.slice(1)),this.plural(new RegExp("("+a.charAt(0)+")"+b.slice(1)+"$","i"),"$1"+b.slice(1)),this.singular(new RegExp("("+b.charAt(0)+")"+b.slice(1)+"$","i"),"$1"+a.slice(1))):(this.plural(new RegExp(""+a+"$","i"),b),this.plural(new RegExp(""+b+"$","i"),b),this.singular(new RegExp(""+b+"$","i"),a))},c.prototype.ordinalize=function(a){var c,d;c=Math.abs(parseInt(a));if(d=c%100,b.call([11,12,13],d)>=0)return a+"th";switch(c%10){case 1:return a+"st";case 2:return a+"nd";case 3:return a+"rd";default:return a+"th"}},c.prototype.pluralize=function(a){var b,c,d,e,f,g,h,i,j,k;i=this._uncountable;for(e=0,g=i.length;e<g;e++){d=i[e];if(d.test(a))return a}j=this._plural;for(f=0,h=j.length;f<h;f++){k=j[f],b=k[0],c=k[1];if(b.test(a))return a.replace(b,c)}return a},c.prototype.singularize=function(a){var b,c,d,e,f,g,h,i,j,k;i=this._uncountable;for(e=0,g=i.length;e<g;e++){d=i[e];if(d.test(a))return a}j=this._singular;for(f=0,h=j.length;f<h;f++){k=j[f],b=k[0],c=k[1];if(b.test(a))return a.replace(b,c)}return a},c.prototype.humanize=function(a){var b,c,d,e,f,g;f=this._human;for(d=0,e=f.length;d<e;d++){g=f[d],b=g[0],c=g[1];if(b.test(a))return a.replace(b,c)}return a},c}()}.call(this),function(){var a,b,c,d,e,f,g,h;b=/(?:^|_|\-)(.)/g,c=/(^|\s)([a-z])/g,g=/([A-Z]+)([A-Z][a-z])/g,h=/([a-z\d])([A-Z])/g,d=/_id$/,e=/_|-/g,f=/^\w/g,Batman.helpers={ordinalize:function(){return Batman.helpers.inflector.ordinalize.apply(Batman.helpers.inflector,arguments)},singularize:function(){return Batman.helpers.inflector.singularize.apply(Batman.helpers.inflector,arguments)},pluralize:function(a,b,c,d){var e;return d==null&&(d=!0),arguments.length<2?Batman.helpers.inflector.pluralize(a):(e=+a===1?b:c||Batman.helpers.inflector.pluralize(b),d&&(e=""+(a||0)+" "+e),e)},camelize:function(a,c){return a=a.replace(b,function(a,b){return b.toUpperCase()}),c?a.substr(0,1).toLowerCase()+a.substr(1):a},underscore:function(a){return a.replace(g,"$1_$2").replace(h,"$1_$2").replace("-","_").toLowerCase()},capitalize:function(a){return a.replace(c,function(a,b,c){return b+c.toUpperCase()})},trim:function(a){return a?a.trim():""},interpolate:function(a,b){var c,d,e;typeof a=="object"?(d=a[b.count],d||(d=a.other)):d=a;for(c in b)e=b[c],d=d.replace(new RegExp("%\\{"+c+"\\}","g"),e);return d},humanize:function(a){return a=Batman.helpers.underscore(a),a=Batman.helpers.inflector.humanize(a),a.replace(d,"").replace(e," ").replace(f,function(a){return a.toUpperCase()})}},a=new Batman.Inflector,Batman.helpers.inflector=a,a.plural(/$/,"s"),a.plural(/s$/i,"s"),a.plural(/(ax|test)is$/i,"$1es"),a.plural(/(octop|vir)us$/i,"$1i"),a.plural(/(octop|vir)i$/i,"$1i"),a.plural(/(alias|status)$/i,"$1es"),a.plural(/(bu)s$/i,"$1ses"),a.plural(/(buffal|tomat)o$/i,"$1oes"),a.plural(/([ti])um$/i,"$1a"),a.plural(/([ti])a$/i,"$1a"),a.plural(/sis$/i,"ses"),a.plural(/(?:([^f])fe|([lr])f)$/i,"$1$2ves"),a.plural(/(hive)$/i,"$1s"),a.plural(/([^aeiouy]|qu)y$/i,"$1ies"),a.plural(/(x|ch|ss|sh)$/i,"$1es"),a.plural(/(matr|vert|ind)(?:ix|ex)$/i,"$1ices"),a.plural(/([m|l])ouse$/i,"$1ice"),a.plural(/([m|l])ice$/i,"$1ice"),a.plural(/^(ox)$/i,"$1en"),a.plural(/^(oxen)$/i,"$1"),a.plural(/(quiz)$/i,"$1zes"),a.singular(/s$/i,""),a.singular(/(n)ews$/i,"$1ews"),a.singular(/([ti])a$/i,"$1um"),a.singular(/((a)naly|(b)a|(d)iagno|(p)arenthe|(p)rogno|(s)ynop|(t)he)ses$/i,"$1$2sis"),a.singular(/(^analy)ses$/i,"$1sis"),a.singular(/([^f])ves$/i,"$1fe"),a.singular(/(hive)s$/i,"$1"),a.singular(/(tive)s$/i,"$1"),a.singular(/([lr])ves$/i,"$1f"),a.singular(/([^aeiouy]|qu)ies$/i,"$1y"),a.singular(/(s)eries$/i,"$1eries"),a.singular(/(m)ovies$/i,"$1ovie"),a.singular(/(x|ch|ss|sh)es$/i,"$1"),a.singular(/([m|l])ice$/i,"$1ouse"),a.singular(/(bus)es$/i,"$1"),a.singular(/(o)es$/i,"$1"),a.singular(/(shoe)s$/i,"$1"),a.singular(/(cris|ax|test)es$/i,"$1is"),a.singular(/(octop|vir)i$/i,"$1us"),a.singular(/(alias|status)es$/i,"$1"),a.singular(/^(ox)en/i,"$1"),a.singular(/(vert|ind)ices$/i,"$1ex"),a.singular(/(matr)ices$/i,"$1ix"),a.singular(/(quiz)zes$/i,"$1"),a.singular(/(database)s$/i,"$1"),a.irregular("person","people"),a.irregular("man","men"),a.irregular("child","children"),a.irregular("sex","sexes"),a.irregular("move","moves"),a.irregular("cow","kine"),a.irregular("zombie","zombies"),a.uncountable("equipment","information","rice","money","species","series","fish","sheep","jeans")}.call(this),function(){}.call(this),function(){Batman.Event=function(){function a(a,b){this.base=a,this.key=b,this._preventCount=0}return a.forBaseAndKey=function(a,b){return a.isEventEmitter?a.event(b):new Batman.Event(a,b)},a.prototype.isEvent=!0,a.prototype.isEqual=function(a){return this.constructor===a.constructor&&this.base===a.base&&this.key===a.key},a.prototype.hashKey=function(){var a;return this.hashKey=function(){return a},a="<Batman.Event base: "+Batman.Hash.prototype.hashKeyFor(this.base)+', key: "'+Batman.Hash.prototype.hashKeyFor(this.key)+'">'},a.prototype.addHandler=function(a){return this.handlers||(this.handlers=[]),this.handlers.indexOf(a)===-1&&this.handlers.push(a),this.oneShot&&this.autofireHandler(a),this},a.prototype.removeHandler=function(a){var b;return this.handlers&&(b=this.handlers.indexOf(a))!==-1&&this.handlers.splice(b,1),this},a.prototype.eachHandler=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n;(f=this.handlers)!=null&&f.slice().forEach(a);if((g=this.base)!=null?g.isEventEmitter:void 0){c=this.key,i=(h=this.base._batman)!=null?h.ancestors():void 0,n=[];for(d=0,e=i.length;d<e;d++)b=i[d],b.isEventEmitter&&((j=b._batman)!=null?(k=j.events)!=null?k.hasOwnProperty(c):void 0:void 0)?n.push((l=b.event(c,false))!=null?(m=l.handlers)!=null?m.slice().forEach(a):void 0:void 0):n.push(void 0);return n}},a.prototype.clearHandlers=function(){return this.handlers=void 0},a.prototype.handlerContext=function(){return this.base},a.prototype.prevent=function(){return++this._preventCount},a.prototype.allow=function(){return this._preventCount&&--this._preventCount,this._preventCount},a.prototype.isPrevented=function(){return this._preventCount>0},a.prototype.autofireHandler=function(a){if(this._oneShotFired&&this._oneShotArgs!=null)return a.apply(this.handlerContext(),this._oneShotArgs)},a.prototype.resetOneShot=function(){return this._oneShotFired=!1,this._oneShotArgs=null},a.prototype.fire=function(){return this.fireWithContext(this.handlerContext(),arguments)},a.prototype.fireWithContext=function(a,b){return this.isPrevented()||this._oneShotFired?!1:(this.oneShot&&(this._oneShotFired=!0,this._oneShotArgs=b),this.eachHandler(function(c){return c.apply(a,b)}))},a.prototype.allowAndFire=function(){return this.allowAndFireWithContext(this.handlerContext,arguments)},a.prototype.allowAndFireWithContext=function(a,b){return this.allow(),this.fireWithContext(a,b)},a}()}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Batman.PropertyEvent=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.eachHandler=function(a){return this.base.eachObserver(a)},c.prototype.handlerContext=function(){return this.base.base},c}(Batman.Event)}.call(this),function(){var a=[].slice;Batman.EventEmitter={isEventEmitter:!0,hasEvent:function(a){var b,c;return(b=this._batman)!=null?typeof b.get=="function"?(c=b.get("events"))!=null?c.hasOwnProperty(a):void 0:void 0:void 0},event:function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n;b==null&&(b=!0),Batman.initializeObject(this),d=this.eventClass||Batman.Event;if((k=this._batman.events)!=null?k.hasOwnProperty(a):void 0)return f=this._batman.events[a];l=this._batman.ancestors();for(i=0,j=l.length;i<j;i++){c=l[i],f=(m=c._batman)!=null?(n=m.events)!=null?n[a]:void 0:void 0;if(f)break}return b||(f!=null?f.oneShot:void 0)?(e=(h=this._batman).events||(h.events={}),g=e[a]=new d(this,a),g.oneShot=f!=null?f.oneShot:void 0,g):f},on:function(){var b,c,d,e,f,g,h;d=2<=arguments.length?a.call(arguments,0,e=arguments.length-1):(e=0,[]),b=arguments[e++],h=[];for(f=0,g=d.length;f<g;f++)c=d[f],h.push(this.event(c).addHandler(b));return h},once:function(a,b){var c,d;return c=this.event(a),d=function(){return b.apply(this,arguments),c.removeHandler(d)},c.addHandler(d)},registerAsMutableSource:function(){return Batman.Property.registerSource(this)},mutation:function(a){return function(){var b,c;return b=a.apply(this,arguments),(c=this.event("change",false))!=null&&c.fire(this,this),b}},prevent:function(a){return this.event(a).prevent(),this},allow:function(a){return this.event(a).allow(),this},isPrevented:function(a){var b;return(b=this.event(a,false))!=null?b.isPrevented():void 0},fire:function(){var b,c,d;return c=arguments[0],b=2<=arguments.length?a.call(arguments,1):[],(d=this.event(c,false))!=null?d.fireWithContext(this,b):void 0},allowAndFire:function(){var b,c,d;return c=arguments[0],b=2<=arguments.length?a.call(arguments,1):[],(d=this.event(c,false))!=null?d.allowAndFireWithContext(this,b):void 0}}}.call(this),function(){var a=[].slice;Batman.Enumerable={isEnumerable:!0,map:function(a,b){var c;return b==null&&(b=Batman.container),c=[],this.forEach(function(){return c.push(a.apply(b,arguments))}),c},mapToProperty:function(a){var b;return b=[],this.forEach(function(c){return b.push(c.get(a))}),b},every:function(a,b){var c;return b==null&&(b=Batman.container),c=!0,this.forEach(function(){return c=c&&a.apply(b,arguments)}),c},some:function(a,b){var c;return b==null&&(b=Batman.container),c=!1,this.forEach(function(){return c=c||a.apply(b,arguments)}),c},reduce:function(b,c){var d,e,f;return d=0,f=this,c!=null?e=!0:e=!1,this.forEach(function(){if(!e){c=arguments[0],e=!0;return}return c=b.apply(null,[c].concat(a.call(arguments),[d],[f]))}),c},filter:function(a){var b,c;return b=new this.constructor,b.add?c=function(b,c){return a(c)&&b.add(c),b}:b.set?c=function(b,c,d){return a(c,d)&&b.set(c,d),b}:(b.push||(b=[]),c=function(b,c){return a(c)&&b.push(c),b}),this.reduce(c,b)},inGroupsOf:function(a){var b,c,d;return d=[],b=!1,c=0,this.forEach(function(e){return c++%a===0&&(b=[],d.push(b)),b.push(e)}),d}}}.call(this),function(){var a,b=[].slice;a=Object.prototype.toString,Batman.SimpleHash=function(){function c(a){this._storage={},this.length=0,a!=null&&this.update(a)}return Batman.extend(c.prototype,Batman.Enumerable),c.prototype.hasKey=function(a){var b,c,d,e;if(this.objectKey(a)){if(!this._objectStorage)return!1;if(c=this._objectStorage[this.hashKeyFor(a)])for(d=0,e=c.length;d<e;d++){b=c[d];if(this.equality(b[0],a))return!0}return!1}return a=this.prefixedKey(a),this._storage.hasOwnProperty(a)},c.prototype.get=function(a){var b,c,d,e;if(!this.objectKey(a))return this._storage[this.prefixedKey(a)];if(!this._objectStorage)return void 0;if(c=this._objectStorage[this.hashKeyFor(a)])for(d=0,e=c.length;d<e;d++){b=c[d];if(this.equality(b[0],a))return b[1]}},c.prototype.set=function(a,b){var c,d,e,f,g,h;if(this.objectKey(a)){this._objectStorage||(this._objectStorage={}),d=(e=this._objectStorage)[h=this.hashKeyFor(a)]||(e[h]=[]);for(f=0,g=d.length;f<g;f++){c=d[f];if(this.equality(c[0],a))return c[1]=b}return this.length++,d.push([a,b]),b}return a=this.prefixedKey(a),this._storage[a]==null&&this.length++,this._storage[a]=b},c.prototype.unset=function(a){var b,c,d,e,f,g,h,i,j,k;if(!this.objectKey(a))return a=this.prefixedKey(a),g=this._storage[a],this._storage[a]!=null&&(this.length--,delete this._storage[a]),g;if(!this._objectStorage)return void 0;b=this.hashKeyFor(a);if(f=this._objectStorage[b])for(c=i=0,j=f.length;i<j;c=++i){k=f[c],d=k[0],h=k[1];if(this.equality(d,a))return e=f.splice(c,1),f.length||delete this._objectStorage[b],this.length--,e[0][1]}},c.prototype.getOrSet=function(a,b){var c;return c=this.get(a),c||(c=b(),this.set(a,c)),c},c.prototype.prefixedKey=function(a){return"_"+a},c.prototype.unprefixedKey=function(a){return a.slice(1)},c.prototype.hashKeyFor=function(b){var c,d;return(c=b!=null?typeof b.hashKey=="function"?b.hashKey():void 0:void 0)?c:(d=a.call(b),d==="[object Array]"?d:b)},c.prototype.equality=function(a,b){return a===b?!0:a!==a&&b!==b?!0:(a!=null?typeof a.isEqual=="function"?a.isEqual(b):void 0:void 0)&&(b!=null?typeof b.isEqual=="function"?b.isEqual(a):void 0:void 0)?!0:!1},c.prototype.objectKey=function(a){return typeof a!="string"},c.prototype.forEach=function(a,b){var c,d,e,f,g,h,i,j,k,l,m;e=[];if(this._objectStorage){j=this._objectStorage;for(c in j){g=j[c],k=g.slice();for(h=0,i=k.length;h<i;h++)l=k[h],d=l[0],f=l[1],e.push(a.call(b,d,f,this))}}m=this._storage;for(c in m)f=m[c],e.push(a.call(b,this.unprefixedKey(c),f,this));return e},c.prototype.keys=function(){var a;return a=[],Batman.SimpleHash.prototype.forEach.call(this,function(b){return a.push(b)}),a},c.prototype.toArray=c.prototype.keys,c.prototype.clear=function(){return this._storage={},delete this._objectStorage,this.length=0},c.prototype.isEmpty=function(){return this.length===0},c.prototype.merge=function(){var a,c,d,e,f;d=1<=arguments.length?b.call(arguments,0):[],c=new this.constructor,d.unshift(this);for(e=0,f=d.length;e<f;e++)a=d[e],a.forEach(function(a,b){return c.set(a,b)});return c},c.prototype.update=function(a){var b,c,d;d=[];for(b in a)c=a[b],d.push(this.set(b,c));return d},c.prototype.replace=function(a){var b=this;return this.forEach(function(c,d){if(!(c in a))return b.unset(c)}),this.update(a)},c.prototype.toObject=function(){var a,b,c,d,e,f;b={},e=this._storage;for(a in e)d=e[a],b[this.unprefixedKey(a)]=d;if(this._objectStorage){f=this._objectStorage;for(a in f)c=f[a],b[a]=c[0][1]}return b},c.prototype.toJSON=c.prototype.toObject,c}()}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b},c=[].slice;Batman.AssociationCurator=function(a){function d(a){this.model=a,d.__super__.constructor.call(this),this._byTypeStorage=new Batman.SimpleHash}return b(d,a),d.availableAssociations=["belongsTo","hasOne","hasMany"],d.prototype.add=function(a){var b;return this.set(a.label,a),(b=this._byTypeStorage.get(a.associationType))||(b=new Batman.SimpleSet,this._byTypeStorage.set(a.associationType,b)),b.add(a)},d.prototype.getByType=function(a){return this._byTypeStorage.get(a)},d.prototype.getByLabel=function(a){return this.get(a)},d.prototype.reset=function(){return this.forEach(function(a,b){return b.reset()}),!0},d.prototype.merge=function(){var a,b;return a=1<=arguments.length?c.call(arguments,0):[],b=d.__super__.merge.apply(this,arguments),b._byTypeStorage=this._byTypeStorage.merge(a.map(function(a){return a._byTypeStorage})),b},d.prototype._markDirtyAttribute=function(a,b){var c;if((c=this.lifecycle.get("state"))!=="loading"&&c!=="creating"&&c!=="saving"&&c!=="saved"){if(this.lifecycle.startTransition("set"))return this.dirtyKeys.set(a,b);throw new Batman.StateMachine.InvalidTransitionError("Can't set while in state "+this.lifecycle.get("state"))}},d}(Batman.SimpleHash)}.call(this),function(){var a=[].slice;Batman.SimpleSet=function(){function b(){var a,b;this._storage=[],this.length=0,b=function(){var b,c,d;d=[];for(b=0,c=arguments.length;b<c;b++)a=arguments[b],a!=null&&d.push(a);return d}.apply(this,arguments),b.length>0&&this.add.apply(this,b)}return Batman.extend(b.prototype,Batman.Enumerable),b.prototype.has=function(a){return!!~this._indexOfItem(a)},b.prototype.add=function(){var b,c,d,e,f;d=1<=arguments.length?a.call(arguments,0):[],b=[];for(e=0,f=d.length;e<f;e++){c=d[e];if(!!~this._indexOfItem(c))continue;this._storage.push(c),b.push(c)}return this.length=this._storage.length,this.fire&&b.length!==0&&(this.fire("change",this,this),this.fire.apply(this,["itemsWereAdded"].concat(a.call(b)))),b},b.prototype.remove=function(){var b,c,d,e,f,g;d=1<=arguments.length?a.call(arguments,0):[],e=[];for(f=0,g=d.length;f<g;f++){c=d[f];if(!~(b=this._indexOfItem(c)))continue;this._storage.splice(b,1),e.push(c)}return this.length=this._storage.length,this.fire&&e.length!==0&&(this.fire("change",this,this),this.fire.apply(this,["itemsWereRemoved"].concat(a.call(e)))),e},b.prototype.find=function(a){var b,c,d,e;e=this._storage;for(c=0,d=e.length;c<d;c++){b=e[c];if(a(b))return b}},b.prototype.forEach=function(a,b){var c,d,e,f,g;f=this._storage,g=[];for(d=0,e=f.length;d<e;d++)c=f[d],g.push(a.call(b,c,null,this));return g},b.prototype.isEmpty=function(){return this.length===0},b.prototype.clear=function(){var b;return b=this._storage,this._storage=[],this.length=0,this.fire&&b.length!==0&&(this.fire("change",this,this),this.fire.apply(this,["itemsWereRemoved"].concat(a.call(b)))),b},b.prototype.replace=function(a){try{return typeof this.prevent=="function"&&this.prevent("change"),this.clear(),this.add.apply(this,a.toArray())}finally{typeof this.allowAndFire=="function"&&this.allowAndFire("change",this,this)}},b.prototype.toArray=function(){return this._storage.slice()},b.prototype.merge=function(){var b,c,d,e,f;c=1<=arguments.length?a.call(arguments,0):[],b=new this.constructor,c.unshift(this);for(e=0,f=c.length;e<f;e++)d=c[e],d.forEach(function(a){return b.add(a)});return b},b.prototype.indexedBy=function(a){return this._indexes||(this._indexes=new Batman.SimpleHash),this._indexes.get(a)||this._indexes.set(a,new Batman.SetIndex(this,a))},b.prototype.indexedByUnique=function(a){return this._uniqueIndexes||(this._uniqueIndexes=new Batman.SimpleHash),this._uniqueIndexes.get(a)||this._uniqueIndexes.set(a,new Batman.UniqueSetIndex(this,a))},b.prototype.sortedBy=function(a,b){var c;return b==null&&(b="asc"),b=b.toLowerCase()==="desc"?"desc":"asc",this._sorts||(this._sorts=new Batman.SimpleHash),c=this._sorts.get(a)||this._sorts.set(a,new Batman.Object),c.get(b)||c.set(b,new Batman.SetSort(this,a,b))},b.prototype.equality=Batman.SimpleHash.prototype.equality,b.prototype._indexOfItem=function(a){var b,c,d,e,f;f=this._storage;for(b=d=0,e=f.length;d<e;b=++d){c=f[b];if(this.equality(a,c))return b}return-1},b}()}.call(this),function(){var a,b,c=[].slice;a=[],b=!0,Batman.Property=function(){function d(a,b){this.base=a,this.key=b}return Batman.mixin(d.prototype,Batman.EventEmitter),d._sourceTrackerStack=a,d._sourceTrackerStackValid=b,d.defaultAccessor={get:function(a){return this[a]},set:function(a,b){return this[a]=b},unset:function(a){var b;return b=this[a],delete this[a],b},cache:!1},d.defaultAccessorForBase=function(a){var b;return((b=a._batman)!=null?b.getFirst("defaultAccessor"):void 0)||Batman.Property.defaultAccessor},d.accessorForBaseAndKey=function(a,b){var c,d,e,f,g,h,i,j,k;if((e=a._batman)!=null){c=(h=e.keyAccessors)!=null?h.get(b):void 0;if(!c){i=e.ancestors();for(f=0,g=i.length;f<g;f++){d=i[f],c=(j=d._batman)!=null?(k=j.keyAccessors)!=null?k.get(b):void 0:void 0;if(c)break}}}return c||this.defaultAccessorForBase(a)},d.forBaseAndKey=function(a,b){return a.isObservable?a.property(b):new Batman.Keypath(a,b)},d.withoutTracking=function(a){return this.wrapTrackingPrevention(a)()},d.wrapTrackingPrevention=function(a){return function(){Batman.Property.pushDummySourceTracker();try{return a.apply(this,arguments)}finally{Batman.Property.popSourceTracker()}}},d.registerSource=function(c){var d;if(!c.isEventEmitter)return;return b?d=a[a.length-1]:(d=[],a.push(d),b=!0),d!=null&&d.push(c),void 0},d.pushSourceTracker=function(){return b?b=!1:a.push([])},d.popSourceTracker=function(){return b?a.pop():(b=!0,void 0)},d.pushDummySourceTracker=function(){return b||(a.push([]),b=!0),a.push(null)},d.prototype._isolationCount=0,d.prototype.cached=!1,d.prototype.value=null,d.prototype.sources=null,d.prototype.isProperty=!0,d.prototype.isDead=!1,d.prototype.eventClass=Batman.PropertyEvent,d.prototype.isEqual=function(a){return this.constructor===a.constructor&&this.base===a.base&&this.key===a.key},d.prototype.hashKey=function(){return this._hashKey||(this._hashKey="<Batman.Property base: "+Batman.Hash.prototype.hashKeyFor(this.base)+', key: "'+Batman.Hash.prototype.hashKeyFor(this.key)+'">')},d.prototype.event=function(a){var b,c;return b=this.eventClass||Batman.Event,this.events||(this.events={}),(c=this.events)[a]||(c[a]=new b(this,a)),this.events[a]},d.prototype.changeEvent=function(){return this._changeEvent||(this._changeEvent=this.event("change"))},d.prototype.accessor=function(){return this._accessor||(this._accessor=this.constructor.accessorForBaseAndKey(this.base,this.key))},d.prototype.eachObserver=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n;d=this.key,c=(k=this.changeEvent().handlers)!=null?k.slice():void 0;if(c)for(g=0,i=c.length;g<i;g++)e=c[g],a(e);if(this.base.isObservable){l=this.base._batman.ancestors(),n=[];for(h=0,j=l.length;h<j;h++)b=l[h],b.isObservable&&b.hasProperty(d)?(f=b.property(d),c=(m=f.changeEvent().handlers)!=null?m.slice():void 0,c?n.push(function(){var b,d,f;f=[];for(b=0,d=c.length;b<d;b++)e=c[b],f.push(a(e));return f}()):n.push(void 0)):n.push(void 0);return n}},d.prototype.observers=function(){var a;return a=[],this.eachObserver(function(b){return a.push(b)}),a},d.prototype.hasObservers=function(){return this.observers().length>0},d.prototype.updateSourcesFromTracker=function(){var a,b,c,d,e,f,g,h,i,j;b=this.constructor.popSourceTracker(),a=this.sourceChangeHandler();if(this.sources){h=this.sources;for(d=0,f=h.length;d<f;d++)c=h[d],c!=null&&c.event("change").removeHandler(a)}this.sources=b;if(this.sources){i=this.sources,j=[];for(e=0,g=i.length;e<g;e++)c=i[e],j.push(c!=null?c.event("change").addHandler(a):void 0);return j}},d.prototype.getValue=function(){this.registerAsMutableSource();if(!this.isCached()){this.constructor.pushSourceTracker();try{this.value=this.valueFromAccessor(),this.cached=!0}finally{this.updateSourcesFromTracker()}}return this.value},d.prototype.isCachable=function(){var a;return this.isFinal()?!0:(a=this.accessor().cache,a!=null?!!a:!0)},d.prototype.isCached=function(){return this.isCachable()&&this.cached},d.prototype.isFinal=function(){return!!this.accessor()["final"]},d.prototype.refresh=function(){var a,b;this.cached=!1,a=this.value,b=this.getValue(),b!==a&&!this.isIsolated()&&this.fire(b,a);if(this.value!==void 0&&this.isFinal())return this.lockValue()},d.prototype.sourceChangeHandler=function(){var a=this;return this._sourceChangeHandler||(this._sourceChangeHandler=this._handleSourceChange.bind(this)),this._sourceChangeHandler},d.prototype._handleSourceChange=function(){return this.isIsolated()?this._needsRefresh=!0:!this.isFinal()&&!this.hasObservers()?this.cached=!1:this.refresh()},d.prototype.valueFromAccessor=function(){var a;return(a=this.accessor().get)!=null?a.call(this.base,this.key):void 0},d.prototype.setValue=function(a){var b;if(!(b=this.accessor().set))return;return this._changeValue(function(){return b.call(this.base,this.key,a)})},d.prototype.unsetValue=function(){var a;if(!(a=this.accessor().unset))return;return this._changeValue(function(){return a.call(this.base,this.key)})},d.prototype._changeValue=function(a){var b;this.cached=!1,this.constructor.pushDummySourceTracker();try{b=a.apply(this),this.refresh()}finally{this.constructor.popSourceTracker()}return!this.isCached()&&!this.hasObservers()&&this.die(),b},d.prototype.forget=function(a){return a!=null?this.changeEvent().removeHandler(a):this.changeEvent().clearHandlers()},d.prototype.observeAndFire=function(a){return this.observe(a),a.call(this.base,this.value,this.value,this.key)},d.prototype.observe=function(a){return this.changeEvent().addHandler(a),this.sources==null&&this.getValue(),this},d.prototype.observeOnce=function(a){var b,c;return b=this.changeEvent(),c=function(){return a.apply(this,arguments),b.removeHandler(c)},b.addHandler(c),this.sources==null&&this.getValue(),this},d.prototype._removeHandlers=function(){var a,b,c,d,e;a=this.sourceChangeHandler();if(this.sources){e=this.sources;for(c=0,d=e.length;c<d;c++)b=e[c],b.event("change").removeHandler(a)}return delete this.sources,this.changeEvent().clearHandlers()},d.prototype.lockValue=function(){return this._removeHandlers(),this.getValue=function(){return this.value},this.setValue=this.unsetValue=this.refresh=this.observe=function(){}},d.prototype.die=function(){var a,b;return this._removeHandlers(),(a=this.base._batman)!=null&&(b=a.properties)!=null&&b.unset(this.key),this.isDead=!0},d.prototype.fire=function(){var a;return(a=this.changeEvent()).fire.apply(a,c.call(arguments).concat([this.key]))},d.prototype.isolate=function(){return this._isolationCount===0&&(this._preIsolationValue=this.getValue()),this._isolationCount++},d.prototype.expose=function(){if(this._isolationCount===1)return this._isolationCount--,this._needsRefresh?(this.value=this._preIsolationValue,this.refresh()):this.value!==this._preIsolationValue&&this.fire(this.value,this._preIsolationValue),this._preIsolationValue=null;if(this._isolationCount>0)return this._isolationCount--},d.prototype.isIsolated=function(){return this._isolationCount>0},d}()}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Batman.Keypath=function(a){function c(a,b){typeof b=="string"?(this.segments=b.split("."),this.depth=this.segments.length):(this.segments=[b],this.depth=1),c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.isCachable=function(){return this.depth===1?c.__super__.isCachable.apply(this,arguments):!0},c.prototype.terminalProperty=function(){var a;a=Batman.getPath(this.base,this.segments.slice(0,-1));if(a==null)return;return Batman.Keypath.forBaseAndKey(a,this.segments[this.depth-1])},c.prototype.valueFromAccessor=function(){return this.depth===1?c.__super__.valueFromAccessor.apply(this,arguments):Batman.getPath(this.base,this.segments)},c.prototype.setValue=function(a){var b;return this.depth===1?c.__super__.setValue.apply(this,arguments):(b=this.terminalProperty())!=null?b.setValue(a):void 0},c.prototype.unsetValue=function(){var a;return this.depth===1?c.__super__.unsetValue.apply(this,arguments):(a=this.terminalProperty())!=null?a.unsetValue():void 0},c}(Batman.Property)}.call(this),function(){var a=[].slice;Batman.Observable={isObservable:!0,hasProperty:function(a){var b,c;return(b=this._batman)!=null?(c=b.properties)!=null?typeof c.hasKey=="function"?c.hasKey(a):void 0:void 0:void 0},property:function(a){var b,c,d;return Batman.initializeObject(this),c=this.propertyClass||Batman.Keypath,b=(d=this._batman).properties||(d.properties=new Batman.SimpleHash),b.get(a)||b.set(a,new c(this,a))},get:function(a){return this.property(a).getValue()},set:function(a,b){return this.property(a).setValue(b)},unset:function(a){return this.property(a).unsetValue()},getOrSet:Batman.SimpleHash.prototype.getOrSet,forget:function(a,b){var c;return a?this.property(a).forget(b):(c=this._batman.properties)!=null&&c.forEach(function(a,b){return b.forget()}),this},observe:function(){var b,c,d;return c=arguments[0],b=2<=arguments.length?a.call(arguments,1):[],(d=this.property(c)).observe.apply(d,b),this},observeAndFire:function(){var b,c,d;return c=arguments[0],b=2<=arguments.length?a.call(arguments,1):[],(d=this.property(c)).observeAndFire.apply(d,b),this},observeOnce:function(){var b,c,d;return c=arguments[0],b=2<=arguments.length?a.call(arguments,1):[],(d=this.property(c)).observeOnce.apply(d,b),this}}}.call(this),function(){Batman.DOM={textInputTypes:["text","search","tel","url","email","password"],scrollIntoView:function(a){var b;return(b=document.getElementById(a))!=null?typeof b.scrollIntoView=="function"?b.scrollIntoView():void 0:void 0},partial:function(a,b,c,d){var e;return d.prevent("rendered"),e=new Batman.View({source:b,context:c}),e.on("ready",function(){return Batman.DOM.setInnerHTML(a,""),Batman.DOM.appendChild(a,e.get("node")),d.allowAndFire("rendered")})},propagateBindingEvent:function(a,b){var c,d,e,f,g;while(c=(c||b).parentNode){e=Batman._data(c,"bindings");if(e!=null)for(f=0,g=e.length;f<g;f++)d=e[f],typeof d.childBindingAdded=="function"&&d.childBindingAdded(a)}},propagateBindingEvents:function(a){var b,c,d,e,f,g,h,i;i=a.childNodes;for(e=0,g=i.length;e<g;e++)d=i[e],Batman.DOM.propagateBindingEvents(d);if(c=Batman._data(a,"bindings"))for(f=0,h=c.length;f<h;f++)b=c[f],Batman.DOM.propagateBindingEvent(b,a)},trackBinding:function(a,b){var c;return(c=Batman._data(b,"bindings"))?c.push(a):Batman._data(b,"bindings",[a]),Batman.DOM.fire("bindingAdded",a),Batman.DOM.propagateBindingEvent(a,b),!0},onParseExit:function(a,b){var c;return c=Batman._data(a,"onParseExit")||Batman._data(a,"onParseExit",new Batman.SimpleSet),b!=null&&c.add(b),c},forgetParseExit:function(a,b){return Batman.removeData(a,"onParseExit",!0)},defineView:function(a,b){var c;return c=b.innerHTML,Batman.View.store.set(Batman.Navigator.normalizePath(a),c),c},setStyleProperty:function(a,b,c,d){return a.style.setProperty?a.style.setProperty(b,c,d):a.style.setAttribute(b,c,d)},removeOrDestroyNode:function(a){var b;return b=Batman._data(a,"view"),b||(b=Batman._data(a,"yielder")),b!=null&&b.get("cached")?Batman.DOM.removeNode(a):Batman.DOM.destroyNode(a)},insertBefore:function(a,b,c){return c==null&&(c=null),!c||a.childNodes.length<=0?Batman.DOM.appendChild(a,b):(Batman.DOM.willInsertNode(b),a.insertBefore(b,c),Batman.DOM.didInsertNode(b))},valueForNode:function(a,b,c){var d;b==null&&(b=""),c==null&&(c=!0),d=arguments.length>1;switch(a.nodeName.toUpperCase()){case"INPUT":case"TEXTAREA":return d?a.value=b:a.value;case"SELECT":if(d)return a.value=b;break;default:return d?Batman.DOM.setInnerHTML(a,c?Batman.escapeHTML(b):b):a.innerHTML}},nodeIsEditable:function(a){var b;return(b=a.nodeName.toUpperCase())==="INPUT"||b==="TEXTAREA"||b==="SELECT"},addEventListener:function(a,b,c){var d;return(d=Batman._data(a,"listeners"))||(d=Batman._data(a,"listeners",{})),d[b]||(d[b]=[]),d[b].push(c),Batman.DOM.hasAddEventListener?a.addEventListener(b,c,!1):a.attachEvent("on"+b,c)},removeEventListener:function(a,b,c){var d,e,f;if(f=Batman._data(a,"listeners"))if(d=f[b])e=d.indexOf(c),e!==-1&&d.splice(e,1);return Batman.DOM.hasAddEventListener?a.removeEventListener(b,c,!1):a.detachEvent("on"+b,c)},hasAddEventListener:typeof window!="undefined"&&window!==null?!!window.addEventListener:!!void 0,preventDefault:function(a){return typeof a.preventDefault=="function"?a.preventDefault():a.returnValue=!1},stopPropagation:function(a){return a.stopPropagation?a.stopPropagation():a.cancelBubble=!0},willInsertNode:function(a){var b,c,d,e,f,g;c=Batman._data(a,"view"),c!=null&&c.fire("beforeAppear",a),(f=Batman.data(a,"show"))!=null&&f.call(a),g=a.childNodes;for(d=0,e=g.length;d<e;d++)b=g[d],Batman.DOM.willInsertNode(b);return!0},didInsertNode:function(a){var b,c,d,e,f;c=Batman._data(a,"view"),c&&(c.fire("appear",a),c.applyYields()),f=a.childNodes;for(d=0,e=f.length;d<e;d++)b=f[d],Batman.DOM.didInsertNode(b);return!0},willRemoveNode:function(a){var b,c,d,e,f,g;c=Batman._data(a,"view"),c&&c.fire("beforeDisappear",a),(f=Batman.data(a,"hide"))!=null&&f.call(a),g=a.childNodes;for(d=0,e=g.length;d<e;d++)b=g[d],Batman.DOM.willRemoveNode(b);return!0},didRemoveNode:function(a){var b,c,d,e,f;c=Batman._data(a,"view"),c&&(c.retractYields(),c.fire("disappear",a)),f=a.childNodes;for(d=0,e=f.length;d<e;d++)b=f[d],Batman.DOM.didRemoveNode(b);return!0},willDestroyNode:function(a){var b,c,d,e,f;c=Batman._data(a,"view"),c&&(c.fire("beforeDestroy",a),c.get("yields").forEach(function(b,c){var d,e,f;f=[];for(d=0,e=c.length;d<e;d++)a=c[d].node,f.push(Batman.DOM.willDestroyNode(a));return f})),f=a.childNodes;for(d=0,e=f.length;d<e;d++)b=f[d],Batman.DOM.willDestroyNode(b);return!0},didDestroyNode:function(a){var b,c,d,e,f,g,h,i,j;g=Batman._data(a,"view"),g&&g.die(),(b=Batman._data(a,"bindings"))&&b.forEach(function(a){return a.die()});if(f=Batman._data(a,"listeners"))for(e in f)d=f[e],d.forEach(function(b){return Batman.DOM.removeEventListener(a,e,b)});Batman.removeData(a),Batman.removeData(a,void 0,!0),j=a.childNodes;for(h=0,i=j.length;h<i;h++)c=j[h],Batman.DOM.didDestroyNode(c);return!0}},Batman.mixin(Batman.DOM,Batman.EventEmitter,Batman.Observable),Batman.DOM.event("bindingAdded")}.call(this),function(){Batman.DOM.ReaderBindingDefinition=function(){function a(a,b,c,d){this.node=a,this.keyPath=b,this.context=c,this.renderer=d}return a}(),Batman.BindingDefinitionOnlyObserve={Data:"data",Node:"node",All:"all",None:"none"},Batman.DOM.readers={target:function(a){return a.onlyObserve=Batman.BindingDefinitionOnlyObserve.Node,Batman.DOM.readers.bind(a)},source:function(a){return a.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,Batman.DOM.readers.bind(a)},bind:function(a){var b,c;c=a.node;switch(c.nodeName.toLowerCase()){case"input":switch(c.getAttribute("type")){case"checkbox":return a.attr="checked",Batman.DOM.attrReaders.bind(a),!0;case"radio":b=Batman.DOM.RadioBinding;break;case"file":b=Batman.DOM.FileBinding}break;case"select":b=Batman.DOM.SelectBinding}return b||(b=Batman.DOM.ValueBinding),new b(a)},context:function(a){return a.context.descendWithDefinition(a)},mixin:function(a){return a.context=a.context.descend(Batman.mixins),new Batman.DOM.MixinBinding(a)},showif:function(a){return new Batman.DOM.ShowHideBinding(a)},hideif:function(a){return a.invert=!0,new Batman.DOM.ShowHideBinding(a)},insertif:function(a){return new Batman.DOM.InsertionBinding(a)},removeif:function(a){return a.invert=!0,new Batman.DOM.InsertionBinding(a)},route:function(a){return new Batman.DOM.RouteBinding(a)},view:function(a){return new Batman.DOM.ViewBinding(a)},partial:function(a){return Batman.DOM.partial(a.node,a.keyPath,a.context,a.renderer)},defineview:function(a){var b;return b=a.node,Batman.DOM.onParseExit(b,function(){var a;return(a=b.parentNode)!=null?a.removeChild(b):void 0}),Batman.DOM.defineView(a.keyPath,b),{skipChildren:!0}},renderif:function(a){return new Batman.DOM.DeferredRenderingBinding(a)},yield:function(a){var b,c;return c=a.node,b=a.keyPath,Batman.DOM.onParseExit(c,function(){return Batman.DOM.Yield.withName(b).set("containerNode",c)})},contentfor:function(a){var b,c,d,e,f;return c=a.node,f=a.value,e=a.swapMethod,d=a.renderer,b=a.keyPath,e||(e="append"),Batman.DOM.onParseExit(c,function(){var a;return(a=c.parentNode)!=null&&a.removeChild(c),d.view.pushYieldAction(b,e,c)})},replace:function(a){return a.swapMethod="replace",Batman.DOM.readers.contentfor(a)}}}.call(this),function(){var a=[].slice,b=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};Batman.DOM.events={click:function(b,c,d,e){return e==null&&(e="click"),Batman.DOM.addEventListener(b,e,function(){var f,g;g=arguments[0],f=2<=arguments.length?a.call(arguments,1):[];if(g.metaKey||g.ctrlKey||g.button===1)return;Batman.DOM.preventDefault(g);if(!Batman.DOM.eventIsAllowed(e,g))return;return c.apply(null,[b,g].concat(a.call(f),[d]))}),b.nodeName.toUpperCase()==="A"&&!b.href&&(b.href="#"),b},doubleclick:function(a,b,c){return Batman.DOM.events.click(a,b,c,"dblclick")},change:function(c,d,e){var f,g,h,i,j,k;g=function(){var a;switch(c.nodeName.toUpperCase()){case"TEXTAREA":return["input","keyup","change"];case"INPUT":return(a=c.type.toLowerCase(),b.call(Batman.DOM.textInputTypes,a)>=0)?(h=d,d=function(a,b){if(b.type==="keyup"&&Batman.DOM.events.isEnter(b))return;return h(a,b)},["input","keyup","change"]):["input","change"];default:return["change"]}}(),k=[];for(i=0,j=g.length;i<j;i++)f=g[i],k.push(Batman.DOM.addEventListener(c,f,function(){var b;return b=1<=arguments.length?a.call(arguments,0):[],d.apply(null,[c].concat(a.call(b),[e]))}));return k},isEnter:function(a){var b,c;return 13<=(b=a.keyCode)&&b<=14||13<=(c=a.which)&&c<=14||a.keyIdentifier==="Enter"||a.key==="Enter"},submit:function(b,c,d){return Batman.DOM.nodeIsEditable(b)?(Batman.DOM.addEventListener(b,"keydown",function(){var c;c=1<=arguments.length?a.call(arguments,0):[];if(Batman.DOM.events.isEnter(c[0]))return Batman.DOM._keyCapturingNode=b}),Batman.DOM.addEventListener(b,"keyup",function(){var e;e=1<=arguments.length?a.call(arguments,0):[];if(Batman.DOM.events.isEnter(e[0]))return Batman.DOM._keyCapturingNode===b&&(Batman.DOM.preventDefault(e[0]),c.apply(null,[b].concat(a.call(e),[d]))),Batman.DOM._keyCapturingNode=null})):Batman.DOM.addEventListener(b,"submit",function(){var e;return e=1<=arguments.length?a.call(arguments,0):[],Batman.DOM.preventDefault(e[0]),c.apply(null,[b].concat(a.call(e),[d]))}),b},other:function(b,c,d,e){return Batman.DOM.addEventListener(b,c,function(){var c;return c=1<=arguments.length?a.call(arguments,0):[],d.apply(null,[b].concat(a.call(c),[e]))})}},Batman.DOM.eventIsAllowed=function(a,b){var c,d,e;if(c=(d=Batman.currentApp)!=null?(e=d.shouldAllowEvent)!=null?e[a]:void 0:void 0)if(c(b)===!1)return!1;return!0}}.call(this),function(){Batman.DOM.AttrReaderBindingDefinition=function(){function a(a,b,c,d,e){this.node=a,this.attr=b,this.keyPath=c,this.context=d,this.renderer=e}return a}(),Batman.DOM.attrReaders={_parseAttribute:function(a){return a==="false"&&(a=!1),a==="true"&&(a=!0),a},source:function(a){return a.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,Batman.DOM.attrReaders.bind(a)},bind:function(a){var b;return b=function(){switch(a.attr){case"checked":case"disabled":case"selected":return Batman.DOM.CheckedBinding;case"value":case"href":case"src":case"size":return Batman.DOM.NodeAttributeBinding;case"class":return Batman.DOM.ClassBinding;case"style":return Batman.DOM.StyleBinding;default:return Batman.DOM.AttributeBinding}}(),new b(a)},context:function(a){return a.context.descendWithDefinition(a)},event:function(a){return new Batman.DOM.EventBinding(a)},addclass:function(a){return new Batman.DOM.AddClassBinding(a)},removeclass:function(a){return a.invert=!0,new Batman.DOM.AddClassBinding(a)},foreach:function(a){return new Batman.DOM.IteratorBinding(a)},formfor:function(a){return new Batman.DOM.FormBinding(a),a.context.descendWithDefinition(a)}}}.call(this),function(){var a,b,c,d,e,f=[].slice,g={}.hasOwnProperty,h=function(a,b){function d(){this.constructor=a}for(var c in b)g.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};c=function(a,b){var c,d,e,f;typeof b=="function"&&(b={get:b}),f=["cachable","cacheable"];for(d=0,e=f.length;d<e;d++)c=f[d],c in b&&("cache"in b||(b.cache=b[c]));return b},d=function(a){return function(b){return{get:function(c){var d,e,f,g,h,i,j,k=this;return(e=b.get.apply(this,arguments))!=null?e:(d=!1,f=void 0,(i=(g=this._batman).promises)==null&&(g.promises={}),(j=(h=this._batman.promises)[c])==null&&(h[c]=function(){var b,e;return b=function(a,b){return d&&k.set(c,b),f=b},e=a.call(k,b,c),f==null&&(f=e),!0}()),d=!0,f)},cache:!0}}},e=function(a,b){var c,d;b=(typeof b=="function"?b(a):void 0)||b;for(c in a)d=a[c],c in b||(b[c]=d);return b},b={_defineAccessor:function(){var a,b,e,g,h,i,j,k,l;e=2<=arguments.length?f.call(arguments,0,h=arguments.length-1):(h=0,[]),a=arguments[h++];if(a==null)return Batman.Property.defaultAccessorForBase(this);if(e.length===0&&(k=Batman.typeOf(a))!=="Object"&&k!=="Function")return Batman.Property.accessorForBaseAndKey(this,a);if(typeof a.promise=="function")return this._defineWrapAccessor.apply(this,f.call(e).concat([d(a.promise)]));Batman.initializeObject(this);if(e.length===0)return this._batman.defaultAccessor=c(this,a);(g=this._batman).keyAccessors||(g.keyAccessors=new Batman.SimpleHash),l=[];for(i=0,j=e.length;i<j;i++)b=e[i],l.push(this._batman.keyAccessors.set(b,c(this,a)));return l},_defineWrapAccessor:function(){var a,b,c,d,g,h,i;b=2<=arguments.length?f.call(arguments,0,d=arguments.length-1):(d=0,[]),c=arguments[d++],Batman.initializeObject(this);if(b.length===0)return this._defineAccessor(e(this._defineAccessor(),c));i=[];for(g=0,h=b.length;g<h;g++)a=b[g],i.push(this._defineAccessor(a,e(this._defineAccessor(a),c)));return i},_resetPromises:function(){var a;if(this._batman.promises==null)return;for(a in this._batman.promises)this._resetPromise(a)},_resetPromise:function(a){this.unset(a),this.property(a).cached=!1,delete this._batman.promises[a]}},a=function(a){function d(){var a;a=1<=arguments.length?f.call(arguments,0):[],this._batman=new Batman._Batman(this),this.mixin.apply(this,a)}var c;return h(d,a),Batman.initializeObject(d),Batman.initializeObject(d.prototype),Batman.mixin(d.prototype,b,Batman.EventEmitter,Batman.Observable),Batman.mixin(d,b,Batman.EventEmitter,Batman.Observable),d.classMixin=function(){return Batman.mixin.apply(Batman,[this].concat(f.call(arguments)))},d.mixin=function(){return this.classMixin.apply(this.prototype,arguments)},d.prototype.mixin=d.classMixin,d.classAccessor=d._defineAccessor,d.accessor=function(){var a;return(a=this.prototype)._defineAccessor.apply(a,arguments)},d.prototype.accessor=d._defineAccessor,d.wrapClassAccessor=d._defineWrapAccessor,d.wrapAccessor=function(){var a;return(a=this.prototype)._defineWrapAccessor.apply(a,arguments)},d.prototype.wrapAccessor=d._defineWrapAccessor,d.observeAll=function(){return this.prototype.observe.apply(this.prototype,arguments)},d.singleton=function(a){return a==null&&(a="sharedInstance"),this.classAccessor(a,{get:function(){var b;return this[b="_"+a]||(this[b]=new this)}})},d.accessor("_batmanID",function(){return this._batmanID()}),c=0,d.prototype._batmanID=function(){var a,b;return this._batman.check(this),(b=(a=this._batman).id)==null&&(a.id=c++),this._batman.id},d.prototype.hashKey=function(){var a;if(typeof this.isEqual=="function")return;return(a=this._batman).hashKey||(a.hashKey="<Batman.Object "+this._batmanID()+">")},d.prototype.toJSON=function(){var a,b,c;b={};for(a in this){if(!g.call(this,a))continue;c=this[a],a!=="_batman"&&a!=="hashKey"&&a!=="_batmanID"&&(b[a]=(c!=null?c.toJSON:void 0)?c.toJSON():c)}return b},d}(Object),Batman.Object=a}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};Batman.Renderer=function(b){function o(b,c,d){this.node=b,this.context=c,this.view=d,this.resume=a(this.resume,this),this.start=a(this.start,this),o.__super__.constructor.call(this),this.context instanceof Batman.RenderContext,this.immediate=Batman.setImmediate(this.start)}var d,e,f,g,h,i,j,k,l,m,n;c(o,b),o.prototype.deferEvery=50,o.prototype.start=function(){return this.startTime=new Date,this.prevent("parsed"),this.prevent("rendered"),this.parseNode(this.node)},o.prototype.resume=function(){return this.startTime=new Date,this.parseNode(this.resumeNode)},o.prototype.finish=function(){return this.startTime=null,this.prevent("stopped"),this.allowAndFire("parsed"),this.allowAndFire("rendered")},o.prototype.stop=function(){return Batman.clearImmediate(this.immediate),this.fire("stopped")},n=["parsed","rendered","stopped"];for(j=0,l=n.length;j<l;j++)g=n[j],o.prototype.event(g).oneShot=!0;d=/^data\-(.*)/,e=["view","renderif","foreach","formfor","context","bind","source","target"],f={};for(i=k=0,m=e.length;k<m;i=++k)h=e[i],f[h]=i;return o.prototype._sortBindings=function(a,b){var c,d;return c=f[a[0]],d=f[b[0]],c==null&&(c=e.length),d==null&&(d=e.length),c>d?1:d>c?-1:a[0]>b[0]?1:b[0]>a[0]?-1:0},o.prototype.parseNode=function(a){var b,c,e,f,g,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w=this;if(this.deferEvery&&new Date-this.startTime>this.deferEvery){this.resumeNode=a,this.timeout=Batman.setImmediate(this.resume);return}if(a.getAttribute&&a.attributes){g=[],s=a.attributes;for(o=0,q=s.length;o<q;o++){c=s[o],h=(t=c.nodeName.match(d))!=null?t[1]:void 0;if(!h)continue;g.push((i=h.split("-")).length>1?[i[0],i.slice(1,i.length+1||9e9).join("-"),c.value]:[h,void 0,c.value])}u=g.sort(this._sortBindings);for(p=0,r=u.length;p<r;p++){v=u[p],h=v[0],b=v[1],n=v[2],e=b?(l=Batman.DOM.attrReaders[h])?(f=new Batman.DOM.AttrReaderBindingDefinition(a,b,n,this.context,this),l(f)):void 0:(l=Batman.DOM.readers[h])?(f=new Batman.DOM.ReaderBindingDefinition(a,n,this.context,this),l(f)):void 0;if(e instanceof Batman.RenderContext)k=this.context,this.context=e,Batman.DOM.onParseExit(a,function(){return w.context=k});else if(e!=null?e.skipChildren:void 0){m=!0;break}}}return(j=this.nextNode(a,m))?this.parseNode(j):this.finish()},o.prototype.nextNode=function(a,b){var c,d,e,f,g,h;if(!b){c=a.childNodes;if(c!=null?c.length:void 0)return c[0]}f=a.nextSibling,(g=Batman.DOM.onParseExit(a))!=null&&g.forEach(function(a){return a()}),Batman.DOM.forgetParseExit(a);if(this.node===a)return;if(f)return f;d=a;while(d=d.parentNode){e=d.nextSibling,(h=Batman.DOM.onParseExit(d))!=null&&h.forEach(function(a){return a()}),Batman.DOM.forgetParseExit(d);if(this.node===d)return;if(e)return e}},o}(Batman.Object)}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};Batman.DOM.AbstractBinding=function(b){function j(b){this._fireDataChange=a(this._fireDataChange,this),this.node=b.node,this.keyPath=b.keyPath,this.renderContext=b.context,this.renderer=b.renderer,b.onlyObserve&&(this.onlyObserve=b.onlyObserve),b.skipParseFilter!=null&&(this.skipParseFilter=b.skipParseFilter),this.skipParseFilter||this.parseFilter(),this.bindImmediately&&this.bind()}var d,e,f,g,h,i;return c(j,b),f=/(^|,)\s*(?:(true|false)|("[^"]*")|(\{[^\}]*\})|(([0-9]+[a-zA-Z\_]|[a-zA-Z])[\w\-\.]*[\?\!]?))\s*(?=$|,)/g,d=/(?:\]\.)(.+?)(?=[\[\.]|\s*\||$)/,e=/(?!^\s*)\[(.*?)\]/g,j.accessor("filteredValue",{get:function(){var a,b,c,d;return d=this.get("unfilteredValue"),c=this,a=this.get("renderContext"),this.filterFunctions.length>0?(b=this.filterFunctions.reduce(function(b,d,e){var f;f=c.filterArguments[e].map(function(a){return a._keypath?c.renderContext.get(a._keypath):a}),f.unshift(b);while(f.length<d.length-1)f.push(void 0);return f.push(c),d.apply(a,f)},d),b):d},set:function(a,b){return this.set("unfilteredValue",b)}}),j.accessor("unfilteredValue",{get:function(){var a;return(a=this.get("key"))?Batman.RenderContext.deProxy(Batman.getPath(this,["keyContext",a])):this.get("value")},set:function(a,b){var c,d,e;if(!(c=this.get("key")))return this.set("value",b);d=this.get("keyContext");if(d&&d!==Batman.container)return e=Batman.Property.forBaseAndKey(d,c),e.setValue(b)}}),j.accessor("keyContext",function(){return this.renderContext.contextForKey(this.key)}),g=Batman.BindingDefinitionOnlyObserve.All,h=Batman.BindingDefinitionOnlyObserve.Data,i=Batman.BindingDefinitionOnlyObserve.Node,j.prototype.bindImmediately=!0,j.prototype.shouldSet=!0,j.prototype.isInputBinding=!1,j.prototype.escapeValue=!0,j.prototype.onlyObserve=g,j.prototype.skipParseFilter=!1,j.prototype.isTwoWay=function(){return this.key!=null&&this.filterFunctions.length===0},j.prototype.bind=function(){var a,b;this.node&&((a=this.onlyObserve)===g||a===i)&&Batman.DOM.nodeIsEditable(this.node)&&(Batman.DOM.events.change(this.node,this._fireNodeChange.bind(this)),this.onlyObserve===i&&this._fireNodeChange()),((b=this.onlyObserve)===g||b===h)&&this.observeAndFire("filteredValue",this._fireDataChange);if(this.node)return Batman.DOM.trackBinding(this,this.node)},j.prototype._fireNodeChange=function(a){var b;return this.shouldSet=!1,b=this.value||this.get("keyContext"),typeof this.nodeChange=="function"&&this.nodeChange(this.node,b,a),this.fire("nodeChange",this.node,b),this.shouldSet=!0},j.prototype._fireDataChange=function(a){if(this.shouldSet)return typeof this.dataChange=="function"&&this.dataChange(a,this.node),this.fire("dataChange",a,this.node)},j.prototype.die=function(){var a;return this.forget(),(a=this._batman.properties)!=null&&a.forEach(function(a,b){return b.die()}),this.fire("die"),this.node=null,this.keyPath=null,this.renderContext=null,this.renderer=null,this.dead=!0,!0},j.prototype.parseFilter=function(){var a,b,c,f,g,h,i,j,k;this.filterFunctions=[],this.filterArguments=[],i=this.keyPath;while(d.test(i))i=i.replace(d,"]['$1']");g=i.replace(e," | get $1 ").replace(/'/g,'"').split(/(?!")\s+\|\s+(?!")/);try{h=this.parseSegment(j=g.shift())[0]}catch(l){}h&&h._keypath?this.key=h._keypath:this.value=h;if(g.length){while(f=g.shift()){k=f.indexOf(" "),k===-1&&(k=f.length),c=f.substr(0,k),a=f.substr(k),!!(b=Batman.Filters[c]),this.filterFunctions.push(b);try{this.filterArguments.push(this.parseSegment(a))}catch(l){}}return!0}},j.prototype.parseSegment=function(a){return a=a.replace(f,function(a,b,c,d,e,f,g){var h;return b==null&&(b=""),h=f?'{"_keypath": "'+f+'"}':c||d||e,b+h}),JSON.parse("["+a+"]")},j}(Batman.Object)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Batman.DOM.ViewBinding=function(a){function c(){c.__super__.constructor.apply(this,arguments),this.renderer.prevent("rendered"),this.node.removeAttribute("data-view")}return b(c,a),c.prototype.skipChildren=!0,c.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,c.prototype.dataChange=function(a){var b,c=this;if(a==null)return;return a.isView?(this.view=a,this.view.set("context",this.renderContext),this.view.set("node",this.node)):this.view=new a({node:this.node,context:this.renderContext,parentView:this.renderer.view}),this.view.on("ready",function(){return c.renderer.allowAndFire("rendered")}),this.forget(),(b=this._batman.properties)!=null?b.forEach(function(a,b){return b.die()}):void 0},c.prototype.die=function(){return this.view=null,c.__super__.die.apply(this,arguments)},c}(Batman.DOM.AbstractBinding)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Batman.DOM.ViewArgumentBinding=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.None,c}(Batman.DOM.AbstractBinding)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Batman.DOM.ValueBinding=function(a){function c(a){var b;this.isInputBinding=(b=a.node.nodeName.toLowerCase())==="input"||b==="textarea",c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.nodeChange=function(a,b){if(this.isTwoWay())return this.set("filteredValue",this.node.value)},c.prototype.dataChange=function(a,b){return Batman.DOM.valueForNode(this.node,a,this.escapeValue)},c}(Batman.DOM.AbstractBinding)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Batman.DOM.ShowHideBinding=function(a){function c(a){var b;b=a.node.style.display;if(!b||b==="none")b="";this.originalDisplay=b,this.invert=a.invert,c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,c.prototype.dataChange=function(a){var b,c,d;return c=Batman._data(this.node,"view"),!!a==!this.invert?(c!=null&&c.fire("beforeAppear",this.node),(d=Batman.data(this.node,"show"))!=null&&d.call(this.node),this.node.style.display=this.originalDisplay,c!=null?c.fire("appear",this.node):void 0):(c!=null&&c.fire("beforeDisappear",this.node),typeof (b=Batman.data(this.node,"hide"))=="function"?b.call(this.node):Batman.DOM.setStyleProperty(this.node,"display","none","important"),c!=null?c.fire("disappear",this.node):void 0)},c}(Batman.DOM.AbstractBinding)}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};Batman.DOM.SelectBinding=function(b){function d(){this.updateOptionBindings=a(this.updateOptionBindings,this),this.nodeChange=a(this.nodeChange,this),this.dataChange=a(this.dataChange,this),this.childBindingAdded=a(this.childBindingAdded,this),this.selectedBindings=new Batman.SimpleSet,d.__super__.constructor.apply(this,arguments)}return c(d,b),d.prototype.isInputBinding=!0,d.prototype.canSetImplicitly=!0,d.prototype.childBindingAdded=function(a){var b,c=this;if(a instanceof Batman.DOM.CheckedBinding)a.on("dataChange",b=function(){return c.nodeChange()}),a.on("die",function(){return a.forget("dataChange",b),c.selectedBindings.remove(a)}),this.selectedBindings.add(a);else{if(!(a instanceof Batman.DOM.IteratorBinding))return;a.on("nodeAdded",b=function(){return c._fireDataChange(c.get("filteredValue"))}),a.on("nodeRemoved",b),a.on("die",function(){return a.forget("nodeAdded",b),a.forget("nodeRemoved",b)})}return this._fireDataChange(this.get("filteredValue"))},d.prototype.lastKeyContext=null,d.prototype.dataChange=function(a){var b,c,d,e,f,g,h,i=this;this.lastKeyContext||(this.lastKeyContext=this.get("keyContext")),this.lastKeyContext!==this.get("keyContext")&&(this.canSetImplicitly=!0,this.lastKeyContext=this.get("keyContext"));if(a!=null?a.forEach:void 0){d={},h=this.node.children;for(e=0,f=h.length;e<f;e++)b=h[e],b.selected=!1,c=d[g=b.value]||(d[g]=[]),c.push(b);a.forEach(function(a){var b,c,e,f,g;if(b=d[a]){g=[];for(e=0,f=b.length;e<f;e++)c=b[e],g.push(c.selected=!0);return g}})}else a==null&&this.canSetImplicitly?this.node.value&&(this.canSetImplicitly=!1,this.set("unfilteredValue",this.node.value)):(this.canSetImplicitly=!1,Batman.DOM.valueForNode(this.node,a,this.escapeValue));this.updateOptionBindings()},d.prototype.nodeChange=function(){var a,b;this.isTwoWay()&&(b=this.node.multiple?function(){var b,c,d,e;d=this.node.children,e=[];for(b=0,c=d.length;b<c;b++)a=d[b],a.selected&&e.push(a.value);return e}.call(this):this.node.value,typeof b===Array&&b.length===1&&(b=b[0]),this.set("unfilteredValue",b),this.updateOptionBindings())},d.prototype.updateOptionBindings=function(){return this.selectedBindings.forEach(function(a){return a._fireNodeChange()})},d}(Batman.DOM.AbstractBinding)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Batman.DOM.RouteBinding=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.onAnchorTag=!1,c.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,c.accessor("dispatcher",function(){return this.renderContext.get("dispatcher")||Batman.App.get("current.dispatcher")}),c.prototype.bind=function(){var a=this;return this.node.nodeName.toUpperCase()==="A"&&(this.onAnchorTag=!0),c.__super__.bind.apply(this,arguments),Batman.DOM.events.click(this.node,function(b,c){var d;if(c.__batmanActionTaken)return;c.__batmanActionTaken=!0,d=a.pathFromValue(a.get("filteredValue"));if(d!=null)return Batman.redirect(d)})},c.prototype.dataChange=function(a){var b;a&&(b=this.pathFromValue(a));if(this.onAnchorTag)return b&&Batman.navigator?b=Batman.navigator.linkTo(b):b="#",this.node.href=b},c.prototype.pathFromValue=function(a){var b;if(a)return a.isNamedRouteQuery?a.get("path"):(b=this.get("dispatcher"))!=null?b.pathFromParams(a):void 0},c}(Batman.DOM.AbstractBinding)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Batman.DOM.RadioBinding=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.accessor("parsedNodeValue",function(){return Batman.DOM.attrReaders._parseAttribute(this.node.value)}),c.prototype.firstBind=!0,c.prototype.dataChange=function(a){var b;return b=this.get("filteredValue"),b!=null?this.node.checked=b===Batman.DOM.attrReaders._parseAttribute(this.node.value):this.firstBind&&this.node.checked&&this.set("filteredValue",this.get("parsedNodeValue")),this.firstBind=!1},c.prototype.nodeChange=function(a){if(this.isTwoWay())return this.set("filteredValue",this.get("parsedNodeValue"))},c}(Batman.DOM.AbstractBinding)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Batman.DOM.MixinBinding=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,c.prototype.dataChange=function(a){if(a!=null)return Batman.mixin(this.node,a)},c}(Batman.DOM.AbstractBinding)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Batman.DOM.FileBinding=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.isInputBinding=!0,c.prototype.nodeChange=function(a,b){if(!this.isTwoWay())return;return a.hasAttribute("multiple")?this.set("filteredValue",Array.prototype.slice.call(a.files)):this.set("filteredValue",a.files[0])},c}(Batman.DOM.AbstractBinding)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Batman.DOM.DeferredRenderingBinding=function(a){function c(){c.__super__.constructor.apply(this,arguments),this.node.removeAttribute("data-renderif")}return b(c,a),c.prototype.rendered=!1,c.prototype.skipChildren=!0,c.prototype.nodeChange=function(){},c.prototype.dataChange=function(a){if(a&&!this.rendered)return this.render()},c.prototype.render=function(){return new Batman.Renderer(this.node,this.renderContext,this.renderer.view),this.rendered=!0},c}(Batman.DOM.AbstractBinding)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Batman.DOM.AbstractAttributeBinding=function(a){function c(a){this.attributeName=a.attr,c.__super__.constructor.apply(this,arguments)}return b(c,a),c}(Batman.DOM.AbstractBinding)}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};Batman.DOM.FormBinding=function(b){function d(){this.childBindingAdded=a(this.childBindingAdded,this),d.__super__.constructor.apply(this,arguments),this.contextName=this.attributeName,delete this.attributeName,Batman.DOM.events.submit(this.get("node"),function(a,b){return Batman.DOM.preventDefault(b)}),this.setupErrorsList()}return c(d,b),d.current=null,d.prototype.errorClass="error",d.prototype.defaultErrorsListSelector="div.errors",d.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.None,d.accessor("errorsListSelector",function(){return this.get("node").getAttribute("data-errors-list")||this.defaultErrorsListSelector}),d.prototype.childBindingAdded=function(a){var b,c,d,e;if(a.isInputBinding&&Batman.isChildOf(this.get("node"),a.get("node"))&&~(d=a.get("key").indexOf(this.contextName)))return e=a.get("node"),c=a.get("key").slice(d+this.contextName.length+1),b=new Batman.DOM.AttrReaderBindingDefinition(e,this.errorClass,this.get("keyPath")+(" | get 'errors."+c+".length'"),this.renderContext,this.renderer),new Batman.DOM.AddClassBinding(b)},d.prototype.setupErrorsList=function(){if(this.errorsListNode=Batman.DOM.querySelector(this.get("node"),this.get("errorsListSelector"))){Batman.DOM.setInnerHTML(this.errorsListNode,this.errorsListHTML());if(!this.errorsListNode.getAttribute("data-showif"))return this.errorsListNode.setAttribute("data-showif",""+this.contextName+".errors.length")}},d.prototype.errorsListHTML=function(){return'<ul>\n  <li data-foreach-error="'+this.contextName+'.errors" data-bind="error.fullMessage"></li>\n</ul>'},d}(Batman.DOM.AbstractAttributeBinding)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Batman.DOM.EventBinding=function(a){function c(){var a,b,d,e=this;c.__super__.constructor.apply(this,arguments),!(d=this.node.getAttribute("data-confirm")),b=function(){var a;if(d&&!confirm(d))return;return(a=e.get("filteredValue"))!=null?a.apply(e.get("callbackContext"),arguments):void 0},(a=Batman.DOM.events[this.attributeName])?a(this.node,b,this.renderContext):Batman.DOM.events.other(this.node,this.attributeName,b,this.renderContext)}return b(c,a),c.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.None,c.accessor("callbackContext",function(){var a;return a=this.key.split("."),a.pop(),a.length>0?this.get("keyContext").get(a.join(".")):this.get("keyContext")}),c.wrapAccessor("unfilteredValue",function(a){return{get:function(){var b,c,d,e;if(c=this.get("key")){e=c.split(".");if(e.length>1){b=e.pop(),d=Batman.getPath(this,["keyContext"].concat(e)),d=Batman.RenderContext.deProxy(d);if(d!=null)return d[b]}}return a.get.apply(this,arguments)}}}),c}(Batman.DOM.AbstractAttributeBinding)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Batman.DOM.NodeAttributeBinding=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.dataChange=function(a){return a==null&&(a=""),this.node[this.attributeName]=a},c.prototype.nodeChange=function(a){if(this.isTwoWay())return this.set("filteredValue",Batman.DOM.attrReaders._parseAttribute(a[this.attributeName]))},c}(Batman.DOM.AbstractAttributeBinding)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Batman.DOM.CheckedBinding=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.isInputBinding=!0,c.prototype.dataChange=function(a){return this.node[this.attributeName]=!!a},c}(Batman.DOM.NodeAttributeBinding)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Batman.DOM.AttributeBinding=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,c.prototype.dataChange=function(a){return this.node.setAttribute(this.attributeName,a)},c.prototype.nodeChange=function(a){if(this.isTwoWay())return this.set("filteredValue",Batman.DOM.attrReaders._parseAttribute(a.getAttribute(this.attributeName)))},c}(Batman.DOM.AbstractAttributeBinding)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Batman.DOM.AddClassBinding=function(a){function c(a){var b;this.invert=a.invert,this.classes=function(){var c,d,e,f;e=a.attr.split("|"),f=[];for(c=0,d=e.length;c<d;c++)b=e[c],f.push({name:b,pattern:new RegExp("(?:^|\\s)"+b+"(?:$|\\s)","i")});return f}(),c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,c.prototype.dataChange=function(a){var b,c,d,e,f,g,h,i;b=this.node.className,h=this.classes;for(f=0,g=h.length;f<g;f++)i=h[f],d=i.name,e=i.pattern,c=e.test(b),!!a==!this.invert?c||(this.node.className=""+b+" "+d):c&&(this.node.className=b.replace(e," "));return!0},c}(Batman.DOM.AbstractAttributeBinding)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Batman.DOM.AbstractCollectionBinding=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.bindCollection=function(a){var b;return a instanceof Batman.Hash&&(a=a.meta),a===this.collection?!0:(this.unbindCollection(),this.collection=a,((b=this.collection)!=null?b.isObservable:void 0)?(this.collection.observeAndFire("toArray",this.handleArrayChanged),!0):!1)},c.prototype.unbindCollection=function(){var a;if((a=this.collection)!=null?a.isObservable:void 0)return this.collection.forget("toArray",this.handleArrayChanged)},c.prototype.handleArrayChanged=function(){},c.prototype.die=function(){return this.unbindCollection(),c.__super__.die.apply(this,arguments)},c}(Batman.DOM.AbstractAttributeBinding)}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a},d=[].slice;Batman.DOM.StyleBinding=function(e){function f(){this.setStyle=a(this.setStyle,this),this.handleArrayChanged=a(this.handleArrayChanged,this),this.oldStyles={},this.styleBindings={},f.__super__.constructor.apply(this,arguments)}return c(f,e),f.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,f.prototype.dataChange=function(a){var c,e,f,g,h,i,j,k,l;if(!a){this.resetStyles();return}this.unbindCollection();if(typeof a=="string"){this.resetStyles(),j=a.split(";");for(h=0,i=j.length;h<i;h++)g=j[h],k=g.split(":"),e=k[0],c=2<=k.length?d.call(k,1):[],this.setStyle(e,c.join(":"));return}if(a instanceof Batman.Hash)return this.bindCollection(a);a instanceof Batman.Object&&(a=a.toJSON()),this.resetStyles(),l=[];for(f in a){if(!b.call(a,f))continue;l.push(this.bindSingleAttribute(f,""+this.keyPath+"."+f))}return l},f.prototype.handleArrayChanged=function(a){var b=this;return this.collection.forEach(function(a,c){return b.bindSingleAttribute(a,""+b.keyPath+"."+a)})},f.prototype.bindSingleAttribute=function(a,b){var c;return c=new Batman.DOM.AttrReaderBindingDefinition(this.node,a,b,this.renderContext,this.renderer),this.styleBindings[a]=new Batman.DOM.StyleBinding.SingleStyleBinding(c,this)},f.prototype.setStyle=function(a,b){a=Batman.helpers.camelize(a.trim(),!0),this.oldStyles[a]==null&&(this.oldStyles[a]=this.node.style[a]||"");if(b!=null?b.trim:void 0)b=b.trim();return b==null&&(b=""),this.node.style[a]=b},f.prototype.resetStyles=function(){var a,c,d,e;d=this.oldStyles,e=[];for(a in d){if(!b.call(d,a))continue;c=d[a],e.push(this.setStyle(a,c))}return e},f.prototype.resetBindings=function(){var a,b,c;c=this.styleBindings;for(a in c)b=c[a],b._fireDataChange(""),b.die();return this.styleBindings={}},f.prototype.unbindCollection=function(){return this.resetBindings(),f.__super__.unbindCollection.apply(this,arguments)},f.SingleStyleBinding=function(a){function b(a,c){this.parent=c,b.__super__.constructor.call(this,a)}return c(b,a),b.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,b.prototype.isTwoWay=function(){return!1},b.prototype.dataChange=function(a){return this.parent.setStyle(this.attributeName,a)},b}(Batman.DOM.AbstractAttributeBinding),f}(Batman.DOM.AbstractCollectionBinding)}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};Batman.DOM.IteratorBinding=function(b){function d(b){this.handleArrayChanged=a(this.handleArrayChanged,this);var c,e,f=this;e=b.node,this.iteratorName=b.attr,this.key=b.keyPath,this.parentRenderer=b.renderer,this.nodeMap=new Batman.SimpleHash,this.rendererMap=new Batman.SimpleHash,this.prototypeNode=e.cloneNode(!0),this.prototypeNode.removeAttribute("data-foreach-"+this.iteratorName),c=e.nextSibling,this.startNode=document.createComment("start "+this.iteratorName+"-"+this.get("_batmanID")),this.endNode=document.createComment("end "+this.iteratorName+"-"+this.get("_batmanID")),this.endNode[Batman.expando]=e[Batman.expando],Batman.canDeleteExpando&&delete e[Batman.expando],Batman.DOM.insertBefore(e.parentNode,this.startNode,c),Batman.DOM.insertBefore(e.parentNode,this.endNode,c),this.parentRenderer.prevent("rendered"),Batman.DOM.onParseExit(e.parentNode,function(){return Batman.DOM.destroyNode(e),f.bind(),f.parentRenderer.allowAndFire("rendered")}),b.node=this.endNode,d.__super__.constructor.apply(this,arguments)}return c(d,b),d.prototype.currentActionNumber=0,d.prototype.queuedActionNumber=0,d.prototype.bindImmediately=!1,d.prototype.skipChildren=!0,d.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,d.prototype.parentNode=function(){return this.endNode.parentNode},d.prototype.dataChange=function(a){var b,c;if(a==null)return this.handleArrayChanged([]);if(!this.bindCollection(a))return b=(a!=null?a.forEach:void 0)?(c=[],a.forEach(function(a){return c.push(a)}),c):Object.keys(a),this.handleArrayChanged(b)},d.prototype.handleArrayChanged=function(a){var b,c,d,e,f,g,h,i,j,k,l=this;g=this.parentNode(),h=this._getStartNodeIndex()+1,i=this.nodeMap.merge();if(a)for(c=j=0,k=a.length;j<k;c=++j){d=a[c],f=g.childNodes[h+c];if(f!=null&&this._itemForNode(f)===d){i.unset(d);continue}e=(b=this.nodeMap.get(d))?(i.unset(d),b):this._newNodeForItem(d),Batman.DOM.insertBefore(this.parentNode(),e,f)}i.forEach(function(a,b){return l._nodesToBeRendered.has(b)?(l._nodesToBeRemoved||(l._nodesToBeRemoved=new Batman.SimpleSet),l._nodesToBeRemoved.add(b)):l._removeItem(a)})},d.prototype._itemForNode=function(a){return Batman._data(a,""+this.iteratorName+"Item")},d.prototype._newNodeForItem=function(a){var b,c,d=this;return b=this.prototypeNode.cloneNode(!0),this._nodesToBeRendered||(this._nodesToBeRendered=new Batman.SimpleSet),this._nodesToBeRendered.add(b),Batman._data(b,""+this.iteratorName+"Item",a),this.nodeMap.set(a,b),this.parentRenderer.prevent("rendered"),c=new Batman.Renderer(b,this.renderContext.descend(a,this.iteratorName),this.parentRenderer.view),c.once("rendered",function(){var c;return d._nodesToBeRendered.remove(b),((c=d._nodesToBeRemoved)!=null?c.has(b):void 0)?(d._nodesToBeRemoved.remove(b),d._removeItem(a)):(Batman.DOM.propagateBindingEvents(b),d.fire("nodeAdded",b,a)),d.parentRenderer.allowAndFire("rendered")}),b},d.prototype._getStartNodeIndex=function(){var a,b,c,d,e;e=this.parentNode().childNodes;for(a=c=0,d=e.length;c<d;a=++c){b=e[a];if(b===this.startNode)return a}return 0},d.prototype._removeItem=function(a){var b;return b=this.nodeMap.unset(a),Batman.DOM.destroyNode(b),this.fire("nodeRemoved",b,a)},d.prototype.die=function(){var a;return this._nodesToBeRendered&&!this._nodesToBeRendered.isEmpty()&&(this._nodesToBeRemoved||(this._nodesToBeRemoved=new Batman.SimpleSet),(a=this._nodesToBeRemoved).add.apply(a,this._nodesToBeRendered.toArray())),d.__super__.die.apply(this,arguments)},d}(Batman.DOM.AbstractCollectionBinding)}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};Batman.DOM.ClassBinding=function(d){function e(){return this.handleArrayChanged=a(this.handleArrayChanged,this),e.__super__.constructor.apply(this,arguments)}return c(e,d),e.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,e.prototype.dataChange=function(a){if(a!=null)return this.unbindCollection(),typeof a=="string"?this.node.className=a:(this.bindCollection(a),this.updateFromCollection())},e.prototype.updateFromCollection=function(){var a,c,d;if(this.collection)return a=this.collection.map?this.collection.map(function(a){return a}):function(){var a,e;a=this.collection,e=[];for(c in a){if(!b.call(a,c))continue;d=a[c],e.push(c)}return e}.call(this),a.toArray!=null&&(a=a.toArray()),this.node.className=a.join(" ")},e.prototype.handleArrayChanged=function(){return this.updateFromCollection()},e}(Batman.DOM.AbstractCollectionBinding)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Batman.ValidationError=function(a){function c(a,b){c.__super__.constructor.call(this,{attribute:a,message:b})}return b(c,a),c.accessor("fullMessage",function(){return Batman.t("errors.format",{attribute:Batman.helpers.humanize(this.attribute),message:this.message})}),c}(Batman.Object)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b},c=[].slice;Batman.StorageAdapter=function(a){function d(a){var b;d.__super__.constructor.call(this,{model:a}),b=this.constructor,b.ModelMixin&&Batman.extend(a,b.ModelMixin),b.RecordMixin&&Batman.extend(a.prototype,b.RecordMixin)}return b(d,a),d.StorageError=function(a){function c(a){c.__super__.constructor.apply(this,arguments),this.message=a}return b(c,a),c.prototype.name="StorageError",c}(Error),d.RecordExistsError=function(a){function c(a){c.__super__.constructor.call(this,a||"Can't create this record because it already exists in the store!")}return b(c,a),c.prototype.name="RecordExistsError",c}(d.StorageError),d.NotFoundError=function(a){function c(a){c.__super__.constructor.call(this,a||"Record couldn't be found in storage!")}return b(c,a),c.prototype.name="NotFoundError",c}(d.StorageError),d.NotAllowedError=function(a){function c(a){c.__super__.constructor.call(this,a||"Storage operation denied access to the operation!")}return b(c,a),c.prototype.name="NotAllowedError",c}(d.StorageError),d.NotAcceptableError=function(a){function c(a){c.__super__.constructor.call(this,a||"Storage operation permitted but the request was malformed!")}return b(c,a),c.prototype.name="NotAcceptableError",c}(d.StorageError),d.UnprocessableRecordError=function(a){function c(a){c.__super__.constructor.call(this,a||"Storage adapter could not process the record!")}return b(c,a),c.prototype.name="UnprocessableRecordError",c}(d.StorageError),d.InternalStorageError=function(a){function c(a){c.__super__.constructor.call(this,a||"An error occured during the storage operation!")}return b(c,a),c.prototype.name="InternalStorageError",c}(d.StorageError),d.NotImplementedError=function(a){function c(a){c.__super__.constructor.call(this,a||"This operation is not implemented by the storage adpater!")}return b(c,a),c.prototype.name="NotImplementedError",c}(d.StorageError),d.prototype.isStorageAdapter=!0,d.prototype.storageKey=function(a){var b;return b=(a!=null?a.constructor:void 0)||this.model,b.get("storageKey")||Batman.helpers.pluralize(Batman.helpers.underscore(b.get("resourceName")))},d.prototype.getRecordFromData=function(a,b){var c;return b==null&&(b=this.model),c=new b,c._withoutDirtyTracking(function(){return this.fromJSON(a)}),c},d.skipIfError=function(a){return function(b,c){return b.error!=null?c():a.call(this,b,c)}},d.prototype.before=function(){return this._addFilter.apply(this,["before"].concat(c.call(arguments)))},d.prototype.after=function(){return this._addFilter.apply(this,["after"].concat(c.call(arguments)))},d.prototype._inheritFilters=function(){var a,b,c,d,e,f;if(!this._batman.check(this)||!this._batman.filters){d=this._batman.getFirst("filters"),this._batman.filters={before:{},after:{}};if(d!=null){f=[];for(e in d)a=d[e],f.push(function(){var d;d=[];for(c in a)b=a[c],d.push(this._batman.filters[e][c]=b.slice(0));return d}.call(this));return f}}},d.prototype._addFilter=function(){var a,b,d,e,f,g,h,i;e=arguments[0],d=3<=arguments.length?c.call(arguments,1,g=arguments.length-1):(g=1,[]),a=arguments[g++],this._inheritFilters();for(h=0,i=d.length;h<i;h++)b=d[h],(f=this._batman.filters[e])[b]||(f[b]=[]),this._batman.filters[e][b].push(a);return!0},d.prototype.runFilter=function(a,b,c,d){var e,f,g,h,i=this;return this._inheritFilters(),f=this._batman.filters[a].all||[],e=this._batman.filters[a][b]||[],c.action=b,g=a==="before"?e.concat(f):f.concat(e),h=function(a){var b;return a!=null&&(c=a),(b=g.shift())!=null?b.call(i,c,h):d.call(i,c)},h()},d.prototype.runBeforeFilter=function(){return this.runFilter.apply(this,["before"].concat(c.call(arguments)))},d.prototype.runAfterFilter=function(a,b,c){return this.runFilter("after",a,b,this.exportResult(c))},d.prototype.exportResult=function(a){return function(b){return a(b.error,b.result,b)}},d.prototype._jsonToAttributes=function(a){return JSON.parse(a)},d.prototype.perform=function(a,b,c,d){var e,f,g=this;return c||(c={}),e={options:c,subject:b},f=function(b){return b!=null&&(e=b),g.runAfterFilter(a,e,d)},this.runBeforeFilter(a,e,function(b){return this[a](b,f)}),void 0},d}(Batman.Object)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b},c=[].slice,d=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};Batman.RestStorage=function(a){function k(){k.__super__.constructor.apply(this,arguments),this.defaultRequestOptions=Batman.extend({},this.defaultRequestOptions)}var e,f,g,h,i,j=this;b(k,a),k.CommunicationError=function(a){function c(a){c.__super__.constructor.call(this,a||"A communication error has occurred!")}return b(c,a),c.prototype.name="CommunicationError",c}(k.StorageError),k.JSONContentType="application/json",k.PostBodyContentType="application/x-www-form-urlencoded",k.BaseMixin={request:function(a,b,c){return c||(c=b,b={}),b.method||(b.method="GET"),b.action=a,this._doStorageOperation(b.method.toLowerCase(),b,c)}},k.ModelMixin=Batman.extend({},k.BaseMixin,{urlNestsUnder:function(){var a,b,d,e,f;b=1<=arguments.length?c.call(arguments,0):[],d={};for(e=0,f=b.length;e<f;e++)a=b[e],d[a+"_id"]=Batman.helpers.pluralize(a);return this.url=function(b){var c,e,f;c=Batman.helpers.pluralize(this.get("resourceName").toLowerCase());for(a in d){f=d[a],e=b.data[a];if(e)return delete b.data[a],""+f+"/"+e+"/"+c}return c},this.prototype.url=function(){var b,c,e,f,g;b=Batman.helpers.pluralize(this.constructor.get("resourceName").toLowerCase());for(a in d){f=d[a],e=this.get("dirtyKeys").get(a),e===void 0&&(e=this.get(a));if(e){g=""+f+"/"+e+"/"+b;break}}g||(g=b);if(c=this.get("id"))g+="/"+c;return g}}}),k.RecordMixin=Batman.extend({},k.BaseMixin),k.prototype.defaultRequestOptions={type:"json"},k.prototype._implicitActionNames=["create","read","update","destroy","readAll"],k.prototype.serializeAsForm=!0,k.prototype.recordJsonNamespace=function(a){return Batman.helpers.singularize(this.storageKey(a))},k.prototype.collectionJsonNamespace=function(a){return Batman.helpers.pluralize(this.storageKey(a.prototype))},k.prototype._execWithOptions=function(a,b,c,d){return d==null&&(d=a),typeof a[b]=="function"?a[b].call(d,c):a[b]},k.prototype._defaultCollectionUrl=function(a){return""+this.storageKey(a.prototype)},k.prototype._addParams=function(a,b){var c;return b&&b.action&&!(c=b.action,d.call(this._implicitActionNames,c)>=0)&&(a+="/"+b.action.toLowerCase()),a},k.prototype._addUrlAffixes=function(a,b,c){var d,e;return e=[a,this.urlSuffix(b,c)],a.charAt(0)!=="/"&&(d=this.urlPrefix(b,c),d.charAt(d.length-1)!=="/"&&e.unshift("/"),e.unshift(d)),e.join("")},k.prototype.urlPrefix=function(a,b){return this._execWithOptions(a,"urlPrefix",b.options)||""},k.prototype.urlSuffix=function(a,b){return this._execWithOptions(a,"urlSuffix",b.options)||""},k.prototype.urlForRecord=function(a,b){var c,d,e;if((e=b.options)!=null?e.recordUrl:void 0)d=this._execWithOptions(b.options,"recordUrl",b.options,a);else if(a.url)d=this._execWithOptions(a,"url",b.options);else{d=a.constructor.url?this._execWithOptions(a.constructor,"url",b.options):this._defaultCollectionUrl(a.constructor);if(b.action!=="create"){if((c=a.get("id"))==null)throw new this.constructor.StorageError("Couldn't get/set record primary key on "+b.action+"!");d=d+"/"+c}}return this._addUrlAffixes(this._addParams(d,b.options),a,b)},k.prototype.urlForCollection=function(a,b){var c,d;return c=((d=b.options)!=null?d.collectionUrl:void 0)?this._execWithOptions(b.options,"collectionUrl",b.options,b.options.urlContext):a.url?this._execWithOptions(a,"url",b.options):this._defaultCollectionUrl(a,b.options),this._addUrlAffixes(this._addParams(c,b.options),a,b)},k.prototype.request=function(a,b){var c;return c=Batman.extend(a.options,{autosend:!1,success:function(b){return a.data=b},error:function(b){return a.error=b},loaded:function(){return a.response=a.request.get("response"),b()}}),a.request=new Batman.Request(c),a.request.send()},k.prototype.perform=function(a,b,c,d){return c||(c={}),Batman.extend(c,this.defaultRequestOptions),k.__super__.perform.call(this,a,b,c,d)},k.prototype.before("all",k.skipIfError(function(a,b){if(!a.options.url)try{a.options.url=a.subject.prototype?this.urlForCollection(a.subject,a):this.urlForRecord(a.subject,a)}catch(c){a.error=c}return b()})),k.prototype.before("get","put","post","delete",k.skipIfError(function(a,b){return a.options.method=a.action.toUpperCase(),b()})),k.prototype.before("create","update",k.skipIfError(function(a,b){var c,d,e;return d=a.subject.toJSON(),(e=this.recordJsonNamespace(a.subject))?(c={},c[e]=d):c=d,a.options.data=c,b()})),k.prototype.before("create","update","put","post",k.skipIfError(function(a,b){return this.serializeAsForm?a.options.contentType=this.constructor.PostBodyContentType:a.options.data!=null&&(a.options.data=JSON.stringify(a.options.data),a.options.contentType=this.constructor.JSONContentType),b()})),k.prototype.after("all",k.skipIfError(function(a,b){var c;if(a.data==null)return b();if(typeof a.data=="string"){if(a.data.length>0)try{c=this._jsonToAttributes(a.data)}catch(d){return a.error=d,b()}}else typeof a.data=="object"&&(c=a.data);return c!=null&&(a.json=c),b()})),k.prototype.extractFromNamespace=function(a,b){return b&&a[b]!=null?a[b]:a},k.prototype.after("create","read","update",k.skipIfError(function(a,b){var c;return a.json!=null&&(c=this.extractFromNamespace(a.json,this.recordJsonNamespace(a.subject)),a.subject._withoutDirtyTracking(function(){return this.fromJSON(c)})),a.result=a.subject,b()})),k.prototype.after("readAll",k.skipIfError(function(a,b){var c,d;return d=this.collectionJsonNamespace(a.subject),a.recordsAttributes=this.extractFromNamespace(a.json,d),Batman.typeOf(a.recordsAttributes)!=="Array"&&(d=this.recordJsonNamespace(a.subject.prototype),a.recordsAttributes=[this.extractFromNamespace(a.json,d)]),a.result=a.records=function(){var b,d,e,f;e=a.recordsAttributes,f=[];for(b=0,d=e.length;b<d;b++)c=e[b],f.push(this.getRecordFromData(c,a.subject));return f}.call(this),b()})),k.prototype.after("get","put","post","delete",k.skipIfError(function(a,b){var c,d;return a.json!=null&&(c=a.json,d=a.subject.prototype?this.collectionJsonNamespace(a.subject):this.recordJsonNamespace(a.subject),a.result=d&&a.json[d]!=null?a.json[d]:a.json),b()})),k.HTTPMethods={create:"POST",update:"PUT",read:"GET",readAll:"GET",destroy:"DELETE"},i=["create","read","update","destroy","readAll","get","post","put","delete"],f=function(a){return k.prototype[a]=k.skipIfError(function(b,c){var d;return(d=b.options).method||(d.method=this.constructor.HTTPMethods[a]),this.request(b,c)})};for(g=0,h=i.length;g<h;g++)e=i[g],f(e);return k.prototype.after("all",function(a,b){return a.error&&(a.error=this._errorFor(a.error,a)),b()}),k._statusCodeErrors={0:k.CommunicationError,403:k.NotAllowedError,404:k.NotFoundError,406:k.NotAcceptableError,409:k.RecordExistsError,422:k.UnprocessableRecordError,500:k.InternalStorageError,501:k.NotImplementedError},k.prototype._errorFor=function(a,b){var c,d;if(a instanceof Error||a.request==null)return a;if(c=this.constructor._statusCodeErrors[a.request.status])d=a.request,a=new c,a.request=d,a.env=b;return a},k}.call(this,Batman.StorageAdapter)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Batman.LocalStorage=function(a){function c(){if(typeof window.localStorage=="undefined")return null;c.__super__.constructor.apply(this,arguments),this.storage=localStorage}return b(c,a),c.prototype.storageRegExpForRecord=function(a){return new RegExp("^"+this.storageKey(a)+"(\\d+)$")},c.prototype.nextIdForRecord=function(a){var b,c;return c=this.storageRegExpForRecord(a),b=1,this._forAllStorageEntries(function(a,d){var e;if(e=c.exec(a))return b=Math.max(b,parseInt(e[1],10)+1)}),b},c.prototype._forAllStorageEntries=function(a){var b,c,d,e;for(b=d=0,e=this.storage.length;0<=e?d<e:d>e;b=0<=e?++d:--d)c=this.storage.key(b),a.call(this,c,this.storage.getItem(c));return!0},c.prototype._storageEntriesMatching=function(a,b){var c,d;return c=this.storageRegExpForRecord(a.prototype),d=[],this._forAllStorageEntries(function(e,f){var g,h;if(h=c.exec(e)){g=this._jsonToAttributes(f),g[a.primaryKey]=h[1];if(this._dataMatches(b,g))return d.push(g)}}),d},c.prototype._dataMatches=function(a,b){var c,d,e;d=!0;for(c in a){e=a[c];if(b[c]!==e){d=!1;break}}return d},c.prototype.before("read","create","update","destroy",c.skipIfError(function(a,b){var c=this;return a.action==="create"?a.id=a.subject.get("id")||a.subject._withoutDirtyTracking(function(){return a.subject.set("id",c.nextIdForRecord(a.subject))}):a.id=a.subject.get("id"),a.id==null?a.error=new this.constructor.StorageError("Couldn't get/set record primary key on "+a.action+"!"):a.key=this.storageKey(a.subject)+a.id,b()})),c.prototype.before("create","update",c.skipIfError(function(a,b){return a.recordAttributes=JSON.stringify(a.subject),b()})),c.prototype.after("read",c.skipIfError(function(a,b){if(typeof a.recordAttributes=="string")try{a.recordAttributes=this._jsonToAttributes(a.recordAttributes)}catch(c){return a.error=c,b()}return a.subject._withoutDirtyTracking(function(){return this.fromJSON(a.recordAttributes)}),b()})),c.prototype.after("read","create","update","destroy",c.skipIfError(function(a,b){return a.result=a.subject,b()})),c.prototype.after("readAll",c.skipIfError(function(a,b){var c;return a.result=a.records=function(){var b,d,e,f;e=a.recordsAttributes,f=[];for(b=0,d=e.length;b<d;b++)c=e[b],f.push(this.getRecordFromData(c,a.subject));return f}.call(this),b()})),c.prototype.read=c.skipIfError(function(a,b){return a.recordAttributes=this.storage.getItem(a.key),a.recordAttributes||(a.error=new this.constructor.NotFoundError),b()}),c.prototype.create=c.skipIfError(function(a,b){var c,d;return c=a.key,d=a.recordAttributes,this.storage.getItem(c)?arguments[0].error=new this.constructor.RecordExistsError:this.storage.setItem(c,d),b()}),c.prototype.update=c.skipIfError(function(a,b){var c,d;return c=a.key,d=a.recordAttributes,this.storage.setItem(c,d),b()}),c.prototype.destroy=c.skipIfError(function(a,b){var c;return c=a.key,this.storage.removeItem(c),b()}),c.prototype.readAll=c.skipIfError(function(a,b){try{arguments[0].recordsAttributes=this._storageEntriesMatching(a.subject,a.options.data)}catch(c){arguments[0].error=c}return b()}),c}(Batman.StorageAdapter)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Batman.SessionStorage=function(a){function c(){if(typeof window.sessionStorage=="undefined")return null;c.__super__.constructor.apply(this,arguments),this.storage=sessionStorage}return b(c,a),c}(Batman.LocalStorage)}.call(this),function(){Batman.Encoders=new Batman.Object}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Batman.ParamsReplacer=function(a){function c(a,b){this.navigator=a,this.params=b}return b(c,a),c.prototype.redirect=function(){return this.navigator.replace(this.toObject())},c.prototype.replace=function(a){return this.params.replace(a),this.redirect()},c.prototype.update=function(a){return this.params.update(a),this.redirect()},c.prototype.clear=function(){return this.params.clear(),this.redirect()},c.prototype.toObject=function(){return this.params.toObject()},c.accessor({get:function(a){return this.params.get(a)},set:function(a,b){var c,d;return c=this.params.get(a),d=this.params.set(a,b),c!==b&&this.redirect(),d},unset:function(a){var b,c;return b=this.params.hasKey(a),c=this.params.unset(a),b&&this.redirect(),c}}),c}(Batman.Object)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Batman.ParamsPusher=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.redirect=function(){return this.navigator.push(this.toObject())},c}(Batman.ParamsReplacer)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Batman.NamedRouteQuery=function(a){function c(a,b){var d;b==null&&(b=[]),c.__super__.constructor.call(this,{routeMap:a,args:b});for(d in this.get("routeMap").childrenByName)this[d]=this._queryAccess.bind(this,d)}return b(c,a),c.prototype.isNamedRouteQuery=!0,c.accessor("route",function(){var a,b,c,d,e,f,g;f=this.get("routeMap"),b=f.memberRoute,a=f.collectionRoute,g=[b,a];for(d=0,e=g.length;d<e;d++){c=g[d];if(c!=null&&c.namedArguments.length===this.get("args").length)return c}return a||b}),c.accessor("path",function(){return this.path()}),c.accessor("routeMap","args","cardinality","hashValue",Batman.Property.defaultAccessor),c.accessor({get:function(a){if(a==null)return;return typeof a=="string"?this.nextQueryForName(a):this.nextQueryWithArgument(a)},cache:!1}),c.accessor("withHash",function(){var a=this;return new Batman.Accessible(function(b){return a.withHash(b)})}),c.prototype.withHash=function(a){var b;return b=this.clone(),b.set("hashValue",a),b},c.prototype.nextQueryForName=function(a){var b;if(b=this.get("routeMap").childrenByName[a])return new Batman.NamedRouteQuery(b,this.args)},c.prototype.nextQueryWithArgument=function(a){var b;return b=this.args.slice(0),b.push(a),this.clone(b)},c.prototype.path=function(){var a,b,c,d,e,f,g;e={},d=this.get("route.namedArguments");for(c=f=0,g=d.length;f<g;c=++f)a=d[c],(b=this.get("args")[c])!=null&&(e[a]=this._toParam(b));return this.get("hashValue")!=null&&(e["#"]=this.get("hashValue")),this.get("route").pathFromParams(e)},c.prototype.toString=function(){return this.path()},c.prototype.clone=function(a){return a==null&&(a=this.args),new Batman.NamedRouteQuery(this.routeMap,a)},c.prototype._toParam=function(a){return a instanceof Batman.AssociationProxy&&(a=a.get("target")),(a!=null?a.toParam:void 0)!=null?a.toParam():a},c.prototype._queryAccess=function(a,b){var c;return c=this.nextQueryForName(a),b!=null&&(c=c.nextQueryWithArgument(b)),c},c}(Batman.Object)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Batman.Dispatcher=function(a){function d(a,b){d.__super__.constructor.call(this,{app:a,routeMap:b})}var c;return b(d,a),d.canInferRoute=function(a){return a instanceof Batman.Model||a instanceof Batman.AssociationProxy||a.prototype instanceof Batman.Model},d.paramsFromArgument=function(a){var b;return b=function(a){return Batman.helpers.camelize(Batman.helpers.pluralize(a.get("resourceName")),!0)},this.canInferRoute(a)?a instanceof Batman.Model||a instanceof Batman.AssociationProxy?(a.isProxy&&(a=a.get("target")),a!=null?{controller:b(a.constructor),action:"show",id:a.get("id")}:{}):a.prototype instanceof Batman.Model?{controller:b(a),action:"index"}:a:a},c=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.accessor("__app",Batman.Property.defaultAccessor),c.accessor(function(a){return this.get("__app."+Batman.helpers.capitalize(a)+"Controller.sharedController")}),c}(Batman.Object),d.accessor("controllers",function(){return new c({__app:this.get("app")})}),d.prototype.routeForParams=function(a){return a=this.constructor.paramsFromArgument(a),this.get("routeMap").routeForParams(a)},d.prototype.pathFromParams=function(a){var b;return typeof a=="string"?a:(a=this.constructor.paramsFromArgument(a),(b=this.routeForParams(a))!=null?b.pathFromParams(a):void 0)},d.prototype.dispatch=function(a){var b,c,d,e,f,g;c=this.constructor.paramsFromArgument(a),e=this.routeForParams(c);if(e)f=e.pathAndParamsFromArgument(c),d=f[0],a=f[1],this.set("app.currentRoute",e),this.set("app.currentURL",d),this.get("app.currentParams").replace(a||{}),e.dispatch(a);else{if(Batman.typeOf(a)==="Object"&&!this.constructor.canInferRoute(a))return this.get("app.currentParams").replace(a);this.get("app.currentParams").clear(),b={type:"404",isPrevented:!1,preventDefault:function(){return this.isPrevented=!0}},(g=Batman.currentApp)!=null&&g.fire("error",b);if(b.isPrevented)return a;if(a!=="/404")return Batman.redirect("/404")}return d},d}.call(this,Batman.Object)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Batman.Route=function(a){function c(a,b){var d,e,f,g,h,i,j,k,l,m;j=this.constructor.regexps,a.indexOf("/")!==0&&(a="/"+a),g=a.replace(j.escapeRegExp,"\\$&"),i=RegExp("^"+g.replace(j.openOptParam,"(?:").replace(j.closeOptParam,")?").replace(j.namedParam,"([^/]+)").replace(j.splatParam,"(.*?)")+j.queryParam+"$"),j.namedOrSplat.lastIndex=0,f=function(){var a;a=[];while(e=j.namedOrSplat.exec(g))a.push(e[1]);return a}(),h={templatePath:a,pattern:g,regexp:i,namedArguments:f,baseParams:b},m=this.optionKeys;for(k=0,l=m.length;k<l;k++)d=m[k],h[d]=b[d],delete b[d];c.__super__.constructor.call(this,h)}return b(c,a),c.regexps={namedParam:/:([\w\d]+)/g,splatParam:/\*([\w\d]+)/g,queryParam:"(?:\\?.+)?",namedOrSplat:/[:|\*]([\w\d]+)/g,namePrefix:"[:|*]",escapeRegExp:/[-[\]{}+?.,\\^$|#\s]/g,openOptParam:/\(/g,closeOptParam:/\)/g},c.prototype.optionKeys=["member","collection"],c.prototype.testKeys=["controller","action"],c.prototype.isRoute=!0,c.prototype.paramsFromPath=function(a){var b,c,d,e,f,g,h,i,j;h=new Batman.URI(a),f=this.get("namedArguments"),g=Batman.extend({path:h.path},this.get("baseParams")),d=this.get("regexp").exec(h.path).slice(1);for(b=i=0,j=d.length;i<j;b=++i)c=d[b],e=f[b],g[e]=c;return Batman.extend(g,h.queryParams)},c.prototype.pathFromParams=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p;f=Batman.extend({},a),g=this.get("templatePath"),j=this.constructor.regexps,o=this.get("namedArguments");for(k=0,m=o.length;k<m;k++)d=o[k],i=RegExp(""+j.namePrefix+d),e=g.replace(i,f[d]!=null?f[d]:""),e!==g&&(delete f[d],g=e);g=g.replace(j.openOptParam,"").replace(j.closeOptParam,"").replace(/([^\/])\/+$/,"$1"),p=this.testKeys;for(l=0,n=p.length;l<n;l++)c=p[l],delete f[c];return f["#"]&&(b=f["#"],delete f["#"]),h=Batman.URI.queryFromParams(f),h&&(g+="?"+h),b&&(g+="#"+b),g},c.prototype.test=function(a){var b,c,d,e,f,g;if(typeof a=="string")c=a;else if(a.path!=null)c=a.path;else{c=this.pathFromParams(a),g=this.testKeys;for(e=0,f=g.length;e<f;e++){b=g[e];if((d=this.get(b))!=null&&a[b]!==d)return!1}}return this.get("regexp").test(c)},c.prototype.pathAndParamsFromArgument=function(a){var b,c;return typeof a=="string"?(b=this.paramsFromPath(a),c=a):(b=a,c=this.pathFromParams(a)),[c,b]},c.prototype.dispatch=function(a){return this.test(a)?this.get("callback")(a):!1},c.prototype.callback=function(){throw new Batman.DevelopmentError("Override callback in a Route subclass")},c}(Batman.Object)}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};Batman.ControllerActionRoute=function(b){function d(b,c){this.callback=a(this.callback,this);var e,f,g;c.signature&&(g=c.signature.split("#"),f=g[0],e=g[1],e||(e="index"),c.controller=f,c.action=e,delete c.signature),d.__super__.constructor.call(this,b,c)}return c(d,b),d.prototype.optionKeys=["member","collection","app","controller","action"],d.prototype.callback=function(a){var b;return b=this.get("app.dispatcher.controllers."+this.get("controller")),b.dispatch(this.get("action"),a)},d}(Batman.Route)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Batman.CallbackActionRoute=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.optionKeys=["member","collection","callback","app"],c.prototype.controller=!1,c.prototype.action=!1,c}(Batman.Route)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b},c=[].slice;Batman.Hash=function(a){function m(){this.meta=new this.constructor.Metadata(this),Batman.SimpleHash.apply(this,arguments),m.__super__.constructor.apply(this,arguments)}var d,e,f,g,h,i,j,k,l=this;b(m,a),m.Metadata=function(a){function c(a){this.hash=a}return b(c,a),Batman.extend(c.prototype,Batman.Enumerable),c.accessor("length",function(){return this.hash.registerAsMutableSource(),this.hash.length}),c.accessor("isEmpty","keys","toArray",function(a){return this.hash.registerAsMutableSource(),this.hash[a]()}),c.prototype.forEach=function(){var a;return(a=this.hash).forEach.apply(a,arguments)},c}(Batman.Object),Batman.extend(m.prototype,Batman.Enumerable),m.prototype.propertyClass=Batman.Property,m.defaultAccessor={get:Batman.SimpleHash.prototype.get,set:m.mutation(function(a,b){var c;return c=Batman.SimpleHash.prototype.set.call(this,a,b),this.fire("itemsWereAdded",a),c}),unset:m.mutation(function(a){var b;return b=Batman.SimpleHash.prototype.unset.call(this,a),b!=null&&this.fire("itemsWereRemoved",a),b}),cache:!1},m.accessor(m.defaultAccessor),m.prototype._preventMutationEvents=function(a){this.prevent("change"),this.prevent("itemsWereAdded"),this.prevent("itemsWereRemoved");try{return a.call(this)}finally{this.allow("change"),this.allow("itemsWereAdded"),this.allow("itemsWereRemoved")}},m.prototype.clear=m.mutation(function(){var a,b;return a=this.keys(),this._preventMutationEvents(function(){var a=this;return this.forEach(function(b){return a.unset(b)})}),b=Batman.SimpleHash.prototype.clear.call(this),this.fire.apply(this,["itemsWereRemoved"].concat(c.call(a))),b}),m.prototype.update=m.mutation(function(a){var b;b=[],this._preventMutationEvents(function(){var c=this;return Batman.forEach(a,function(a,d){return c.hasKey(a)||b.push(a),c.set(a,d)})});if(b.length>0)return this.fire.apply(this,["itemsWereAdded"].concat(c.call(b)))}),m.prototype.replace=m.mutation(function(a){var b,d;b=[],d=[],this._preventMutationEvents(function(){var c=this;return this.forEach(function(b,e){if(!Batman.objectHasKey(a,b))return c.unset(b),d.push(b)}),Batman.forEach(a,function(a,d){return c.hasKey(a)||b.push(a),c.set(a,d)})}),b.length>0&&this.fire.apply(this,["itemsWereAdded"].concat(c.call(b)));if(d.length>0)return this.fire.apply(this,["itemsWereRemoved"].concat(c.call(d)))}),j=["equality","hashKeyFor","objectKey","prefixedKey","unprefixedKey"];for(f=0,h=j.length;f<h;f++)d=j[f],m.prototype[d]=Batman.SimpleHash.prototype[d];k=["hasKey","forEach","isEmpty","keys","toArray","merge","toJSON","toObject"],e=function(a){return m.prototype[a]=function(){return this.registerAsMutableSource(),Batman.SimpleHash.prototype[a].apply(this,arguments)}};for(g=0,i=k.length;g<i;g++)d=k[g],e(d);return m}.call(this,Batman.Object)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Batman.RenderCache=function(a){function c(){c.__super__.constructor.apply(this,arguments),this.keyQueue=[]}return b(c,a),c.prototype.maximumLength=4,c.prototype.viewForOptions=function(a){var b=this;return a.cache===!1||a.viewClass.prototype.cache===!1?this._newViewFromOptions(a):this.getOrSet(a,function(){return b._newViewFromOptions(Batman.extend({},a))})},c.prototype._newViewFromOptions=function(a){return new a.viewClass(a)},c.wrapAccessor(function(a){return{cache:!1,get:function(b){var c;return c=a.get.call(this,b),c&&this._addOrBubbleKey(b),c},set:function(b,c){var d;return d=a.set.apply(this,arguments),d.set("cached",!0),this._addOrBubbleKey(b),this._evictExpiredKeys(),d},unset:function(b){var c;return c=a.unset.apply(this,arguments),c.set("cached",!1),this._removeKeyFromQueue(b),c}}}),c.prototype.equality=function(a,b){var c;if(Object.keys(a).length!==Object.keys(b).length)return!1;for(c in a)if(c!=="view"&&a[c]!==b[c])return!1;return!0},c.prototype.reset=function(){var a,b,c,d,e;d=this.keyQueue.slice(0),e=[];for(b=0,c=d.length;b<c;b++)a=d[b],e.push(this.unset(a));return e},c.prototype._addOrBubbleKey=function(a){return this._removeKeyFromQueue(a),this.keyQueue.unshift(a)},c.prototype._removeKeyFromQueue=function(a){var b,c,d,e,f;f=this.keyQueue;for(b=d=0,e=f.length;d<e;b=++d){c=f[b];if(this.equality(c,a)){this.keyQueue.splice(b,1);break}}return a},c.prototype._evictExpiredKeys=function(){var a,b,c,d,e,f;if(this.length>this.maximumLength){a=this.keyQueue.slice(0);for(b=d=e=this.maximumLength,f=a.length;e<=f?d<f:d>f;b=e<=f?++d:--d)c=a[b],this.get(c).isInDOM()||this.unset(c)}},c}(Batman.Hash)}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a},d=[].slice,e=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};Batman.Controller=function(b){function g(){this.redirect=a(this.redirect,this),this.handleError=a(this.handleError,this),this.errorHandler=a(this.errorHandler,this),g.__super__.constructor.apply(this,arguments),this._resetActionFrames()}var f;return c(g,b),g.singleton("sharedController"),g.wrapAccessor("routingKey",function(a){return{get:function(){return this.routingKey!=null?this.routingKey:(!Batman.config.minificationErrors,Batman.functionName(this.constructor).replace(/Controller$/,""))}}}),g.accessor("_renderContext",function(){return Batman.RenderContext.root().descend(this)}),f=function(a,b){return b?typeof a=="string"?a={only:[a]}:(a.only&&Batman.typeOf(a.only)!=="Array"&&(a.only=[a.only]),a.except&&Batman.typeOf(a.except)!=="Array"&&(a.except=[a.except])):(b=a,a={}),a.block=b,a},g.beforeFilter=function(){var a,b,c;return Batman.initializeObject(this),b=f.apply(null,arguments),a=(c=this._batman).beforeFilters||(c.beforeFilters=[]),a.push(b)},g.afterFilter=function(){var a,b,c;return Batman.initializeObject(this),b=f.apply(null,arguments),a=(c=this._batman).afterFilters||(c.afterFilters=[]),a.push(b)},g.afterFilter(function(a){if(this.autoScrollToHash&&a["#"]!=null)return this.scrollToHash(a["#"])}),g.catchError=function(){var a,b,c,e,f,g,h,i,j,k;c=2<=arguments.length?d.call(arguments,0,h=arguments.length-1):(h=0,[]),f=arguments[h++],Batman.initializeObject(this),(g=this._batman).errorHandlers||(g.errorHandlers=new Batman.SimpleHash),e=Batman.typeOf(f["with"])==="Array"?f["with"]:[f["with"]],k=[];for(i=0,j=c.length;i<j;i++)b=c[i],a=this._batman.errorHandlers.get(b)||[],k.push(this._batman.errorHandlers.set(b,a.concat(e)));return k},g.prototype.errorHandler=function(a){var b,c,d=this;return b=(c=this._actionFrames)!=null?c[this._actionFrames.length-1]:void 0,function(c,e,f){if(!c)return typeof a=="function"?a(e,f):void 0;if(b!=null?b.error:void 0)return;b!=null&&(b.error=c);if(!d.handleError(c))throw c}},g.prototype.handleError=function(a){var b,c,d=this;return b=!1,(c=this.constructor._batman.getAll("errorHandlers"))!=null&&c.forEach(function(c){return c.forEach(function(c,e){var f,g,h,i;if(a instanceof c){b=!0,i=[];for(g=0,h=e.length;g<h;g++)f=e[g],i.push(f.call(d,a));return i}})}),b},g.prototype.renderCache=new Batman.RenderCache,g.prototype.defaultRenderYield="main",g.prototype.autoScrollToHash=!0,g.prototype.dispatch=function(a,b){var c;b==null&&(b={}),b.controller||(b.controller=this.get("routingKey")),b.action||(b.action=a),b.target||(b.target=this),this._resetActionFrames(),this.set("action",a),this.set("params",b),Batman.DOM.Yield.cycleAll(),this.executeAction(a,b),Batman.DOM.Yield.clearAllStale(),c=this._afterFilterRedirect,delete this._afterFilterRedirect;if(c)return Batman.redirect(c)},g.prototype.executeAction=function(a,b){var c,d,e,f,g,h,i=this;return b==null&&(b=this.get("params")),e=this._actionFrames[this._actionFrames.length-1],c=new Batman.ControllerActionFrame({parentFrame:e,action:a},function(){var c;return i._afterFilterRedirect||i._runFilters(a,b,"afterFilters"),i._resetActionFrames(),(c=Batman.navigator)!=null?c.redirect=d:void 0}),this._actionFrames.push(c),c.startOperation({internal:!0}),d=(g=Batman.navigator)!=null?g.redirect:void 0,(h=Batman.navigator)!=null&&(h.redirect=this.redirect),this._runFilters(a,b,"beforeFilters"),this._afterFilterRedirect||(f=this[a](b)),c.operationOccurred||this.render(),c.finishOperation(),f},g.prototype.redirect=function(a){var b;b=this._actionFrames[this._actionFrames.length-1];if(!b)return Batman.typeOf(a)==="Object"&&(a.controller||(a.controller=this)),Batman.redirect(a);!b.operationOccurred,b.startAndFinishOperation();if(this._afterFilterRedirect==null)return this._afterFilterRedirect=a},g.prototype.render=function(a){var b,c,d,e,f,g=this;a==null&&(a={}),(c=(e=this._actionFrames)!=null?e[this._actionFrames.length-1]:void 0)&&c.startOperation();if(a===!1){c.finishOperation();return}return b=(c!=null?c.action:void 0)||this.get("action"),a&&(a.into||(a.into=this.defaultRenderYield)),a.view?(d=a.view,a.view=null):(a.viewClass||(a.viewClass=this._viewClassForAction(b)),a.context||(a.context=this.get("_renderContext")),a.source||(a.source=Batman.helpers.underscore(this.get("routingKey")+"/"+b)),d=this.renderCache.viewForOptions(a)),d&&((f=Batman.currentApp)!=null&&f.prevent("ready"),d.once("ready",function(){var b;return Batman.DOM.Yield.withName(a.into).replace(d.get("node")),(b=Batman.currentApp)!=null&&b.allowAndFire("ready"),c!=null?c.finishOperation():void 0})),d},g.prototype.scrollToHash=function(a){return a==null&&(a=this.get("params")["#"]),Batman.DOM.scrollIntoView(a)},g.prototype._resetActionFrames=function(){return this._actionFrames=[]},g.prototype._viewClassForAction=function(a){var b,c;return b=this.get("routingKey").replace("/","_"),((c=Batman.currentApp)!=null?c[Batman.helpers.camelize(""+b+"_"+a+"_view")]:void 0)||Batman.View},g.prototype._runFilters=function(a,b,c){var d,f,g,h,i;if(c=(i=this.constructor._batman)!=null?i.get(c):void 0)for(g=0,h=c.length;g<h;g++){f=c[g];if(f.only&&e.call(f.only,a)<0)continue;if(f.except&&e.call(f.except,a)>=0)continue;if(this._afterFilterRedirect)return;d=f.block,typeof d=="function"?d.call(this,b):typeof this[d]=="function"&&this[d](b)}},g}(Batman.Object)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Batman.Set=function(a){function l(){Batman.SimpleSet.apply(this,arguments)}var c,d,e,f,g,h,i,j,k=this;b(l,a),Batman.extend(l.prototype,Batman.Enumerable),l._applySetAccessors=function(a){var b,c,d,e;c={first:function(){return this.toArray()[0]},last:function(){return this.toArray()[this.length-1]},isEmpty:function(){return this.isEmpty()},toArray:function(){return this.toArray()},length:function(){return this.registerAsMutableSource(),this.length},indexedBy:function(){var a=this;return new Batman.TerminalAccessible(function(b){return a.indexedBy(b)})},indexedByUnique:function(){var a=this;return new Batman.TerminalAccessible(function(b){return a.indexedByUnique(b)})},sortedBy:function(){var a=this;return new Batman.TerminalAccessible(function(b){return a.sortedBy(b)})},sortedByDescending:function(){var a=this;return new Batman.TerminalAccessible(function(b){return a.sortedBy(b,"desc")})}},e=[];for(d in c)b=c[d],e.push(a.accessor(d,b));return e},l._applySetAccessors(l),i=["add","remove","clear","replace","indexedBy","indexedByUnique","sortedBy","equality","_indexOfItem"];for(e=0,g=i.length;e<g;e++)c=i[e],l.prototype[c]=Batman.SimpleSet.prototype[c];j=["find","merge","forEach","toArray","isEmpty","has"],d=function(a){return l.prototype[a]=function(){return this.registerAsMutableSource(),Batman.SimpleSet.prototype[a].apply(this,arguments)}};for(f=0,h=j.length;f<h;f++)c=j[f],d(c);return l.prototype.toJSON=l.prototype.toArray,l}.call(this,Batman.Object)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Batman.ErrorsSet=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.accessor(function(a){return this.indexedBy("attribute").get(a)}),c.prototype.add=function(a,b){return c.__super__.add.call(this,new Batman.ValidationError(a,b))},c}(Batman.Set)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b},c=[].slice;Batman.SetProxy=function(a){function j(a){var b=this;this.base=a,j.__super__.constructor.call(this),this.length=this.base.length,this.base.on("itemsWereAdded",function(){var a;return a=1<=arguments.length?c.call(arguments,0):[],b.set("length",b.base.length),b.fire.apply(b,["itemsWereAdded"].concat(c.call(a)))}),this.base.on("itemsWereRemoved",function(){var a;return a=1<=arguments.length?c.call(arguments,0):[],b.set("length",b.base.length),b.fire.apply(b,["itemsWereRemoved"].concat(c.call(a)))})}var d,e,f,g,h,i=this;b(j,a),Batman.extend(j.prototype,Batman.Enumerable),j.prototype.filter=function(a){return this.reduce(function(b,c){return a(c)&&b.add(c),b},new Batman.Set)},j.prototype.replace=function(){var a,b;return a=this.property("length"),a.isolate(),b=this.base.replace.apply(this,arguments),a.expose(),b},Batman.Set._applySetAccessors(j),h=["add","remove","find","clear","has","merge","toArray","isEmpty","indexedBy","indexedByUnique","sortedBy"],e=function(a){return j.prototype[a]=function(){var b;return(b=this.base)[a].apply(b,arguments)}};for(f=0,g=h.length;f<g;f++)d=h[f],e(d);return j.accessor("length",{get:function(){return this.registerAsMutableSource(),this.length},set:function(a,b){return this.length=b}}),j}.call(this,Batman.Object)}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a},d=[].slice;Batman.BinarySetOperation=function(b){function e(b,c){this.left=b,this.right=c,this._setup=a(this._setup,this),e.__super__.constructor.call(this),this._setup(this.left,this.right),this._setup(this.right,this.left)}return c(e,b),e.prototype._setup=function(a,b){var c=this;return a.on("itemsWereAdded",function(){var e;return e=1<=arguments.length?d.call(arguments,0):[],c._itemsWereAddedToSource.apply(c,[a,b].concat(d.call(e)))}),a.on("itemsWereRemoved",function(){var e;return e=1<=arguments.length?d.call(arguments,0):[],c._itemsWereRemovedFromSource.apply(c,[a,b].concat(d.call(e)))}),this._itemsWereAddedToSource.apply(this,[a,b].concat(d.call(a.toArray())))},e.prototype.merge=function(){var a,b,c,e,f;b=1<=arguments.length?d.call(arguments,0):[],a=new Batman.Set,b.unshift(this);for(e=0,f=b.length;e<f;e++)c=b[e],c.forEach(function(b){return a.add(b)});return a},e.prototype.filter=Batman.SetProxy.prototype.filter,e}(Batman.Set)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b},c=[].slice;Batman.SetUnion=function(a){function d(){return d.__super__.constructor.apply(this,arguments)}return b(d,a),d.prototype._itemsWereAddedToSource=function(){var a,b,d;return d=arguments[0],b=arguments[1],a=3<=arguments.length?c.call(arguments,2):[],this.add.apply(this,a)},d.prototype._itemsWereRemovedFromSource=function(){var a,b,d,e,f;return f=arguments[0],e=arguments[1],b=3<=arguments.length?c.call(arguments,2):[],d=function(){var c,d,f;f=[];for(c=0,d=b.length;c<d;c++)a=b[c],e.has(a)||f.push(a);return f}(),this.remove.apply(this,d)},d}(Batman.BinarySetOperation)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b},c=[].slice;Batman.SetIntersection=function(a){function d(){return d.__super__.constructor.apply(this,arguments)}return b(d,a),d.prototype._itemsWereAddedToSource=function(){var a,b,d,e,f;f=arguments[0],e=arguments[1],b=3<=arguments.length?c.call(arguments,2):[],d=function(){var c,d,f;f=[];for(c=0,d=b.length;c<d;c++)a=b[c],e.has(a)&&f.push(a);return f}();if(d.length>0)return this.add.apply(this,d)},d.prototype._itemsWereRemovedFromSource=function(){var a,b,d;return d=arguments[0],b=arguments[1],a=3<=arguments.length?c.call(arguments,2):[],this.remove.apply(this,a)},d}(Batman.BinarySetOperation)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b},c=[].slice;Batman.SetComplement=function(a){function d(){return d.__super__.constructor.apply(this,arguments)}return b(d,a),d.prototype._itemsWereAddedToSource=function(){var a,b,d,e,f,g;g=arguments[0],f=arguments[1],b=3<=arguments.length?c.call(arguments,2):[];if(g===this.left){d=function(){var c,d,e;e=[];for(c=0,d=b.length;c<d;c++)a=b[c],f.has(a)||e.push(a);return e}();if(d.length>0)return this.add.apply(this,d)}else{e=function(){var c,d,e;e=[];for(c=0,d=b.length;c<d;c++)a=b[c],f.has(a)&&e.push(a);return e}();if(e.length>0)return this.remove.apply(this,e)}},d.prototype._itemsWereRemovedFromSource=function(){var a,b,d,e,f;f=arguments[0],e=arguments[1],b=3<=arguments.length?c.call(arguments,2):[];if(f===this.left)return this.remove.apply(this,b);d=function(){var c,d,f;f=[];for(c=0,d=b.length;c<d;c++)a=b[c],e.has(a)&&f.push(a);return f}();if(d.length>0)return this.add.apply(this,d)},d.prototype._addComplement=function(a,b){var c,d;d=function(){var d,e,f;f=[];for(d=0,e=a.length;d<e;d++)c=a[d],b.has(c)&&f.push(c);return f}();if(d.length>0)return this.add.apply(this,d)},d}(Batman.BinarySetOperation)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b},c=[].slice;Batman.StateMachine=function(a){function d(a){this.nextEvents=[],this.set("_state",a)}return b(d,a),d.InvalidTransitionError=function(a){this.message=a!=null?a:""},d.InvalidTransitionError.prototype=new Error,d.transitions=function(a){var b,d,e,f,g,h,i,j,k,l,m=this;for(e in a){j=a[e];if(!j.from||!j.to)continue;f={},j.from.forEach?j.from.forEach(function(a){return f[a]=j.to}):f[j.from]=j.to,a[e]=f}this.prototype.transitionTable=Batman.extend({},this.prototype.transitionTable,a),g=[],b=function(a){var b;b="is"+Batman.helpers.capitalize(a);if(m.prototype[b]!=null)return;return g.push(b),m.prototype[b]=function(){return this.get("state")===a}},l=this.prototype.transitionTable,k=function(a){return m.prototype[a]=function(){return this.startTransition(a)}};for(e in l){i=l[e];if(!!this.prototype[e])continue;k(e);for(d in i)h=i[d],b(d),b(h)}return g.length&&this.accessor.apply(this,c.call(g).concat([function(a){return this[a]()}])),this},d.accessor("state",function(){return this.get("_state")}),d.prototype.isTransitioning=!1,d.prototype.transitionTable={},d.prototype.onTransition=function(a,b,c){return this.on(""+a+"->"+b,c)},d.prototype.onEnter=function(a,b){return this.on("enter "+a,b)},d.prototype.onExit=function(a,b){return this.on("exit "+a,b)},d.prototype.startTransition=Batman.Property.wrapTrackingPrevention(function(a){var b,c;if(this.isTransitioning){this.nextEvents.push(a);return}return c=this.get("state"),b=this.nextStateForEvent(a),b?(this.isTransitioning=!0,this.fire("exit "+c),this.set("_state",b),this.fire(""+c+"->"+b),this.fire("enter "+b),this.fire(a),this.isTransitioning=!1,this.nextEvents.length>0&&this.startTransition(this.nextEvents.shift()),!0):!1}),d.prototype.canStartTransition=function(a,b){return b==null&&(b=this.get("state")),!!this.nextStateForEvent(a,b)},d.prototype.nextStateForEvent=function(a,b){var c;return b==null&&(b=this.get("state")),(c=this.transitionTable[a])!=null?c[b]:void 0},d}(Batman.Object),Batman.DelegatingStateMachine=function(a){function c(a,b){this.base=b,c.__super__.constructor.call(this,a)}return b(c,a),c.prototype.fire=function(){var a,b;return a=c.__super__.fire.apply(this,arguments),(b=this.base).fire.apply(b,arguments),a},c}(Batman.StateMachine)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b},c=[].slice;Batman.Model=function(a){function k(a){a==null&&(a={}),Batman.typeOf(a)==="Object"?k.__super__.constructor.call(this,a):(k.__super__.constructor.call(this),this.set("id",a))}var d,e,f,g,h,i,j;b(k,a),k.storageKey=null,k.primaryKey="id",k.persist=function(){var a,b;return a=arguments[0],b=2<=arguments.length?c.call(arguments,1):[],Batman.initializeObject(this.prototype),a=a.isStorageAdapter?a:new a(this),b.length>0&&Batman.mixin.apply(Batman,[a].concat(c.call(b))),this.prototype._batman.storage=a,a},k.storageAdapter=function(){return Batman.initializeObject(this.prototype),this.prototype._batman.storage},k.encode=function(){var a,b,d,e,f,g,h,i,j;f=2<=arguments.length?c.call(arguments,0,h=arguments.length-1):(h=0,[]),d=arguments[h++],Batman.initializeObject(this.prototype),(g=this.prototype._batman).encoders||(g.encoders=new Batman.SimpleHash),a={};switch(Batman.typeOf(d)){case"String":f.push(d);break;case"Function":a.encode=d;break;default:a=d}for(i=0,j=f.length;i<j;i++)e=f[i],b=Batman.extend({as:e},this.defaultEncoder,a),this.prototype._batman.encoders.set(e,b)},k.defaultEncoder={encode:function(a){return a},decode:function(a){return a}},k.observeAndFire("primaryKey",function(a,b){return this.encode(b,{encode:!1,decode:!1}),this.encode(a,{encode:!1,decode:this.defaultEncoder.decode})}),k.validate=function(){var a,b,d,e,f,g,h,i,j,k,l;a=2<=arguments.length?c.call(arguments,0,h=arguments.length-1):(h=0,[]),d=arguments[h++],Batman.initializeObject(this.prototype),f=(g=this.prototype._batman).validators||(g.validators=[]);if(typeof d=="function")return f.push({keys:a,callback:d});k=Batman.Validators,l=[];for(i=0,j=k.length;i<j;i++)e=k[i],(b=e.matches(d))?l.push(f.push({keys:a,validator:new e(b)})):l.push(void 0);return l},k.classAccessor("resourceName",{get:function(){return this.resourceName!=null?this.resourceName:(!Batman.config.minificationErrors,Batman.helpers.underscore(Batman.functionName(this)))}}),k.classAccessor("all",{get:function(){return this._batman.check(this),this.prototype.hasStorage()&&!this._batman.allLoadTriggered&&(this.load(),this._batman.allLoadTriggered=!0),this.get("loaded")},set:function(a,b){return this.set("loaded",b)}}),k.classAccessor("loaded",{get:function(){return this._loaded||(this._loaded=new Batman.Set)},set:function(a,b){return this._loaded=b}}),k.classAccessor("first",function(){return this.get("all").toArray()[0]}),k.classAccessor("last",function(){var a;return a=this.get("all").toArray(),a[a.length-1]}),k.clear=function(){var a,b;return Batman.initializeObject(this),a=this.get("loaded").clear(),(b=this._batman.get("associations"))!=null&&b.reset(),this._resetPromises(),a},k.find=function(a,b){return this.findWithOptions(a,void 0,b)},k.findWithOptions=function(a,b,c){var d;return b==null&&(b={}),d=new this,d._withoutDirtyTracking(function(){return this.set("id",a)}),d.loadWithOptions(b,c),d},k.load=function(a,b){var c;return(c=typeof a)==="function"||c==="undefined"?(b=a,a={}):a={data:a},this.loadWithOptions(a,b)},k.loadWithOptions=function(a,b){var c=this;return this.fire("loading",a),this._doStorageOperation("readAll",a,function(a,d,e){var f;return a!=null?(c.fire("error",a),typeof b=="function"?b(a,[]):void 0):(f=c._mapIdentities(d),c.fire("loaded",f,e),typeof b=="function"?b(a,f,e):void 0)})},k.create=function(a,b){var c,d;return b||(d=[{},a],a=d[0],b=d[1]),c=new this(a),c.save(b),c},k.findOrCreate=function(a,b){var c,d;return d=new this(a),d.isNew()?d.save(b):(c=this._mapIdentity(d),b(void 0,c)),d},k.createFromJSON=function(a){var b;return b=new this,b._withoutDirtyTracking(function(){return this.fromJSON(a)}),this._mapIdentity(b)},k._mapIdentity=function(a){return this._mapIdentities([a])[0]},k._mapIdentities=function(a){var b,c,d,e,f,g,h,i,j;e=[];for(d=g=0,h=a.length;g<h;d=++g){f=a[d];if((c=f.get("id"))==null)continue;(b=(i=this.get("loaded.indexedBy.id").get(c))!=null?i.toArray()[0]:void 0)?(b._withoutDirtyTracking(function(){var a;return this.updateAttributes(((a=f.get("attributes"))!=null?a.toObject():void 0)||{})}),a[d]=b):e.push(f)}return e.length&&(j=this.get("loaded")).add.apply(j,e),a},k._doStorageOperation=function(a,b,c){var d;return d=this.prototype._batman.get("storage"),d.perform(a,this,b,c)},i=["find","load","create"];for(e=0,g=i.length;e<g;e++)d=i[e],k[d]=Batman.Property.wrapTrackingPrevention(k[d]);k.InstanceLifecycleStateMachine=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.transitions({load:{from:["dirty","clean"],to:"loading"},create:{from:["dirty","clean"],to:"creating"},save:{from:["dirty","clean"],to:"saving"},destroy:{from:["dirty","clean"],to:"destroying"},failedValidation:{from:["saving","creating"],to:"dirty"},loaded:{loading:"clean"},created:{creating:"clean"},saved:{saving:"clean"},destroyed:{destroying:"destroyed"},set:{from:["dirty","clean"],to:"dirty"},error:{from:["saving","creating","loading","destroying"],to:"error"}}),c}(Batman.DelegatingStateMachine),k.accessor("lifecycle",function(){return this.lifecycle||(this.lifecycle=new Batman.Model.InstanceLifecycleStateMachine("clean",this))}),k.accessor("attributes",function(){return this.attributes||(this.attributes=new Batman.Hash)}),k.accessor("dirtyKeys",function(){return this.dirtyKeys||(this.dirtyKeys=new Batman.Hash)}),k.accessor("_dirtiedKeys",function(){return this._dirtiedKeys||(this._dirtiedKeys=new Batman.SimpleSet)}),k.accessor("errors",function(){return this.errors||(this.errors=new Batman.ErrorsSet)}),k.accessor("isNew",function(){return this.isNew()}),k.accessor("isDirty",function(){return this.isDirty()}),k.accessor(k.defaultAccessor={get:function(a){return Batman.getPath(this,["attributes",a])},set:function(a,b){return this._willSet(a)?this.get("attributes").set(a,b):this.get(a)},unset:function(a){return this.get("attributes").unset(a)}}),k.wrapAccessor("id",function(a){return{get:function(){var b;return b=this.constructor.primaryKey,b==="id"?a.get.apply(this,arguments):this.get(b)},set:function(b,c){var d,e;return typeof c=="string"&&c.match(/[^0-9]/)===null&&""+(d=parseInt(c,10))===c&&(c=d),e=this.constructor.primaryKey,e==="id"?(this._willSet(b),a.set.apply(this,arguments)):this.set(e,c)}}}),k.prototype.isNew=function(){return typeof this.get("id")=="undefined"},k.prototype.isDirty=function(){return this.get("lifecycle.state")==="dirty"},k.prototype.updateAttributes=function(a){return this.mixin(a),this},k.prototype.toString=function(){return""+this.constructor.get("resourceName")+": "+this.get("id")},k.prototype.toParam=function(){return this.get("id")},k.prototype.toJSON=function(){var a,b,c=this;return b={},a=this._batman.get("encoders"),!!a&&!a.isEmpty()&&a.forEach(function(a,d){var e,f;if(d.encode){f=c.get(a);if(typeof f!="undefined"){e=d.encode(f,a,b,c);if(typeof e!="undefined")return b[d.as]=e}}}),b},k.prototype.fromJSON=function(a){var b,c,d,e,f=this;d={},b=this._batman.get("encoders");if(!b||b.isEmpty()||!b.some(function(a,b){return b.decode!=null}))for(c in a)e=a[c],d[c]=e;else b.forEach(function(b,c){if(c.decode&&typeof a[c.as]!="undefined")return d[b]=c.decode(a[c.as],c.as,a,d,f)});return this.constructor.primaryKey!=="id"&&(d.id=a[this.constructor.primaryKey]),this.mixin(d)},k.prototype.hasStorage=function(){return this._batman.get("storage")!=null},k.prototype.load=function(a,b){var c;return b?a={data:a}:(c=[{},a],a=c[0],b=c[1]),this.loadWithOptions(a,b)},k.prototype.loadWithOptions=function(a,b){var c,d,e,f=this;d=Object.keys(a).length!==0;if((e=this.get("lifecycle.state"))==="destroying"||e==="destroyed"){typeof b=="function"&&b(new Error("Can't load a destroyed record!"));return}if(this.get("lifecycle").load())return c=[],b!=null&&c.push(b),d||(this._currentLoad=c),this._doStorageOperation("read",a,function(a,e,g){var h,i;a?f.get("lifecycle").error():(f.get("lifecycle").loaded(),e=f.constructor._mapIdentity(e)),d||(f._currentLoad=null);for(h=0,i=c.length;h<i;h++)b=c[h],b(a,e,g)});if(this.get("lifecycle.state")!=="loading"||!!d)return typeof b=="function"?b(new Batman.StateMachine.InvalidTransitionError("Can't load while in state "+this.get("lifecycle.state"))):void 0;if(b!=null)return this._currentLoad.push(b)},k.prototype.save=function(a,b){var c,d,e,f,g,h,i=this;return b||(g=[{},a],a=g[0],b=g[1]),d=this.isNew(),h=d?["create","create","created"]:["save","update","saved"],e=h[0],f=h[1],c=h[2],this.get("lifecycle").startTransition(e)?this.validate(function(d,e){var g;return d||e.length?(i.get("lifecycle").failedValidation(),typeof b=="function"?b(d||e,i):void 0):(g=i.constructor._batman.get("associations"),i._withoutDirtyTracking(function(){var a,b=this;return g!=null?(a=g.getByType("belongsTo"))!=null?a.forEach(function(a,c){return a.apply(b)}):void 0:void 0}),i._doStorageOperation(f,{data:a},function(a,d,e){return a?a instanceof Batman.ErrorsSet?i.get("lifecycle").failedValidation():i.get("lifecycle").error():(i.get("dirtyKeys").clear(),i.get("_dirtiedKeys").clear(),g&&d._withoutDirtyTracking(function(){var b,c;return(b=g.getByType("hasOne"))!=null&&b.forEach(function(b,c){return b.apply(a,d)}),(c=g.getByType("hasMany"))!=null?c.forEach(function(b,c){return b.apply(a,d)}):void 0}),d=i.constructor._mapIdentity(d),i.get("lifecycle").startTransition(c)),typeof b=="function"?b(a,d||i,e):void 0}))}):typeof b=="function"?b(new Batman.StateMachine.InvalidTransitionError("Can't save while in state "+this.get("lifecycle.state"))):void 0},k.prototype.destroy=function(a,b){var c,d=this;return b||(c=[{},a],a=c[0],b=c[1]),this.get("lifecycle").destroy()?this._doStorageOperation("destroy",{data:a},function(a,c,e){return a?d.get("lifecycle").error():(d.constructor.get("loaded").remove(d),d.get("lifecycle").destroyed()),typeof b=="function"?b(a,c,e):void 0}):typeof b=="function"?b(new Batman.StateMachine.InvalidTransitionError("Can't destroy while in state "+this.get("lifecycle.state"))):void 0},k.prototype.validate=function(a){var b,c,d,e,f,g,h,i,j,k,l,m;d=this.get("errors"),d.clear(),h=this._batman.get("validators")||[];if(!h||h.length===0)return typeof a=="function"&&a(void 0,d),!0;c=h.reduce(function(a,b){return a+b.keys.length},0),e=function(){if(--c===0)return typeof a=="function"?a(void 0,d):void 0};for(i=0,k=h.length;i<k;i++){g=h[i],m=g.keys;for(j=0,l=m.length;j<l;j++){f=m[j],b=[d,this,f,e];try{g.validator?g.validator.validateEach.apply(g.validator,b):g.callback.apply(g,b)}catch(n){typeof a=="function"&&a(n,d)}}}},k.prototype.associationProxy=function(a){var b,c,d;return Batman.initializeObject(this),b=(c=this._batman).associationProxies||(c.associationProxies={}),b[d=a.label]||(b[d]=new a.proxyClass(a,this)),b[a.label]},k.prototype._willSet=function(a){return this._pauseDirtyTracking?!0:this.get("lifecycle").startTransition("set")?(this.get("_dirtiedKeys").has(a)||(this.set("dirtyKeys."+a,this.get(a)),this.get("_dirtiedKeys").add(a)),!0):!1},k.prototype._doStorageOperation=function(a,b,c){var d,e=this;return d=this._batman.get("storage"),d.perform(a,this,b,function(){return c.apply(null,arguments)})},k.prototype._withoutDirtyTracking=function(a){var b;return this._pauseDirtyTracking=!0,b=a.call(this),this._pauseDirtyTracking=!1,b},j=["load","save","validate","destroy"];for(f=0,h=j.length;f<h;f++)d=j[f],k.prototype[d]=Batman.Property.wrapTrackingPrevention(k.prototype[d]);return k}.call(this,Batman.Object)}.call(this),function(){var a,b,c,d,e,f=this;e=Batman.AssociationCurator.availableAssociations,b=function(a){return Batman.Model[a]=function(b,c){var d,e;return Batman.initializeObject(this),d=(e=this._batman).associations||(e.associations=new Batman.AssociationCurator(this)),d.add(new(Batman[""+Batman.helpers.capitalize(a)+"Association"])(this,b,c))}};for(c=0,d=e.length;c<d;c++)a=e[c],b(a)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Batman.Proxy=function(a){function c(a){c.__super__.constructor.call(this),a!=null&&this.set("target",a)}return b(c,a),c.prototype.isProxy=!0,c.accessor("target",Batman.Property.defaultAccessor),c.accessor({get:function(a){var b;return(b=this.get("target"))!=null?b.get(a):void 0},set:function(a,b){var c;return(c=this.get("target"))!=null?c.set(a,b):void 0},unset:function(a){var b;return(b=this.get("target"))!=null?b.unset(a):void 0}}),c}(Batman.Object)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Batman.AssociationProxy=function(a){function c(a,b){this.association=a,this.model=b,c.__super__.constructor.call(this)}return b(c,a),c.prototype.loaded=!1,c.prototype.toJSON=function(){var a;a=this.get("target");if(a!=null)return this.get("target").toJSON()},c.prototype.load=function(a){var b=this;return this.fetch(function(c,d){return c||b._setTarget(d),typeof a=="function"?a(c,d):void 0}),this.get("target")},c.prototype.loadFromLocal=function(){var a;if(!this._canLoad())return;return(a=this.fetchFromLocal())&&this._setTarget(a),a},c.prototype.fetch=function(a){var b;return this._canLoad()?(b=this.fetchFromLocal(),b?a(void 0,b):this.fetchFromRemote(a)):a(void 0,void 0)},c.accessor("loaded",Batman.Property.defaultAccessor),c.accessor("target",{get:function(){return this.fetchFromLocal()},set:function(a,b){return b}}),c.prototype._canLoad=function(){return(this.get("foreignValue")||this.get("primaryValue"))!=null},c.prototype._setTarget=function(a){return this.set("target",a),this.set("loaded",!0),this.fire("loaded",a)},c}(Batman.Proxy)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Batman.HasOneProxy=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.accessor("primaryValue",function(){return this.model.get(this.association.primaryKey)}),c.prototype.fetchFromLocal=function(){return this.association.setIndex().get(this.get("primaryValue"))},c.prototype.fetchFromRemote=function(a){var b,c=this;return b={data:{}},b.data[this.association.foreignKey]=this.get("primaryValue"),this.association.options.url&&(b.collectionUrl=this.association.options.url,b.urlContext=this.model),this.association.getRelatedModel().loadWithOptions(b,function(b,c){if(b)throw b;return!c||c.length<=0?a(new Error("Couldn't find related record!"),void 0):a(void 0,c[0])})},c}(Batman.AssociationProxy)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Batman.BelongsToProxy=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.accessor("foreignValue",function(){return this.model.get(this.association.foreignKey)}),c.prototype.fetchFromLocal=function(){return this.association.setIndex().get(this.get("foreignValue"))},c.prototype.fetchFromRemote=function(a){var b,c=this;return b={},this.association.options.url&&(b.recordUrl=this.association.options.url),this.association.getRelatedModel().findWithOptions(this.get("foreignValue"),b,function(b,c){if(b)throw b;return a(void 0,c)})},c}(Batman.AssociationProxy)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Batman.PolymorphicBelongsToProxy=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.accessor("foreignTypeValue",function(){return this.model.get(this.association.foreignTypeKey)}),c.prototype.fetchFromLocal=function(){return this.association.setIndexForType(this.get("foreignTypeValue")).get(this.get("foreignValue"))},c.prototype.fetchFromRemote=function(a){var b,c=this;return b={},this.association.options.url&&(b.recordUrl=this.association.options.url),this.association.getRelatedModelForType(this.get("foreignTypeValue")).findWithOptions(this.get("foreignValue"),b,function(b,c){if(b)throw b;return a(void 0,c)})},c}(Batman.BelongsToProxy)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Batman.Accessible=function(a){function c(){this.accessor.apply(this,arguments)}return b(c,a),c}(Batman.Object),Batman.TerminalAccessible=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.propertyClass=Batman.Property,c}(Batman.Accessible)}.call(this),function(){Batman.mixins=new Batman.Object}.call(this),function(){Batman.URI=function(){function m(b){var c,d;d=l.exec(b),c=14;while(c--)this[a[c]]=d[c]||"";this.queryParams=this.constructor.paramsFromQuery(this.query),delete this.authority,delete this.userInfo,delete this.relative,delete this.directory,delete this.file,delete this.query}var a,b,c,d,e,f,g,h,i,j,k,l;return l=/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,a=["source","protocol","authority","userInfo","user","password","hostname","port","relative","path","directory","file","query","hash"],m.prototype.queryString=function(){return this.constructor.queryFromParams(this.queryParams)},m.prototype.toString=function(){return[this.protocol?""+this.protocol+":":void 0,this.authority()?"//":void 0,this.authority(),this.relative()].join("")},m.prototype.userInfo=function(){return[this.user,this.password?":"+this.password:void 0].join("")},m.prototype.authority=function(){return[this.userInfo(),this.user||this.password?"@":void 0,this.hostname,this.port?":"+this.port:void 0].join("")},m.prototype.relative=function(){var a;return a=this.queryString(),[this.path,a?"?"+a:void 0,this.hash?"#"+this.hash:void 0].join("")},m.prototype.directory=function(){var a;return a=this.path.split("/"),a.length>1?a.slice(0,a.length-1).join("/")+"/":""},m.prototype.file=function(){var a;return a=this.path.split("/"),a[a.length-1]},m.paramsFromQuery=function(a){var b,d,e,g,i,j;d={},j=a.split("&");for(g=0,i=j.length;g<i;g++)e=j[g],(b=e.match(f))?h(d,c(b[1]),c(b[2])):h(d,c(e),null);return d},m.decodeQueryComponent=c=function(a){return decodeURIComponent(a.replace(i,"%20"))},g=/^[\[\]]*([^\[\]]+)\]*(.*)/,b=[/^\[\]\[([^\[\]]+)\]$/,/^\[\](.+)$/],i=/\+/g,k=/%20/g,f=/^([^=]*)=(.*)/,h=function(a,c,d){var e,f,i,j,k,l,m,n;if(!(k=c.match(g)))return;i=k[1],e=k[2];if(e==="")a[i]=d;else if(e==="[]"){(l=a[i])==null&&(a[i]=[]);if(Batman.typeOf(a[i])!=="Array")throw new Error("expected Array (got "+Batman.typeOf(a[i])+') for param "'+i+'"');a[i].push(d)}else if(k=e.match(b[0])||e.match(b[1])){f=k[1],(m=a[i])==null&&(a[i]=[]);if(Batman.typeOf(a[i])!=="Array")throw new Error("expected Array (got "+Batman.typeOf(a[i])+') for param "'+i+'"');j=a[i][a[i].length-1],Batman.typeOf(j)!=="Object"||f in j?a[i].push(h({},f,d)):h(j,f,d)}else{(n=a[i])==null&&(a[i]={});if(Batman.typeOf(a[i])!=="Object")throw new Error("expected Object (got "+Batman.typeOf(a[i])+') for param "'+i+'"');a[i]=h(a[i],e,d)}return a},m.queryFromParams=j=function(a,b){var c,d,f,g;if(a==null)return b;g=Batman.typeOf(a);if(b==null&&g!=="Object")throw new Error("value must be an Object");switch(g){case"Array":return function(){var d,e;c=[];if(a.length===0)c.push(j(null,""+b+"[]"));else for(d=0,e=a.length;d<e;d++)f=a[d],c.push(j(f,""+b+"[]"));return c}().join("&");case"Object":return function(){var c;c=[];for(d in a)f=a[d],c.push(j(f,b?""+b+"["+e(d)+"]":e(d)));return c}().join("&");default:return b!=null?""+b+"="+e(a):e(a)}},m.encodeComponent=d=function(a){return a!=null?encodeURIComponent(a):""},m.encodeQueryComponent=e=function(a){return d(a).replace(k,"+")},m}()}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Batman.Request=function(a){function d(a){var b,c,e,f;c={};for(e in a){b=a[e];if(e!=="success"&&e!=="error"&&e!=="loading"&&e!=="loaded")continue;c[e]=b,delete a[e]}d.__super__.constructor.call(this,a);for(e in c)b=c[e],this.on(e,b);((f=this.get("url"))!=null?f.length:void 0)>0?this.autosend&&this.send():this.observe("url",function(a){if(a!=null)return this.send()})}var c;return b(d,a),d.objectToFormData=function(a){var b,c,d,e,f,g,h,i;d=function(a,b,c){var e,f,g;return c==null&&(c=!1),b instanceof Batman.container.File?[[a,b]]:f=function(){switch(Batman.typeOf(b)){case"Object":return f=function(){var f;f=[];for(e in b)g=b[e],f.push(d(c?e:""+a+"["+e+"]",g));return f}(),f.reduce(function(a,b){return a.concat(b)},[]);case"Array":return b.reduce(function(b,c){return b.concat(d(""+a+"[]",c))},[]);default:return[[a,b!=null?b:""]]}}()},b=new Batman.container.FormData,h=d("",a,!0);for(f=0,g=h.length;f<g;f++)i=h[f],c=i[0],e=i[1],b.append(c,e);return b},d.dataHasFileUploads=c=function(a){var b,d,e,f,g;if(typeof File!="undefined"&&File!==null&&a instanceof File)return!0;d=Batman.typeOf(a);switch(d){case"Object":for(b in a){e=a[b];if(c(e))return!0}break;case"Array":for(f=0,g=a.length;f<g;f++){e=a[f];if(c(e))return!0}}return!1},d.wrapAccessor("method",function(a){return{set:function(b,c){return a.set.call(this,b,c!=null?typeof c.toUpperCase=="function"?c.toUpperCase():void 0:void 0)}}}),d.prototype.method="GET",d.prototype.hasFileUploads=function(){return c(this.data)},d.prototype.contentType="application/x-www-form-urlencoded",d.prototype.autosend=!0,d.prototype.send=function(){},d}(Batman.Object)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b},c=[].slice;Batman.SetObserver=function(a){function d(a){var b=this;this.base=a,this._itemObservers=new Batman.SimpleHash,this._setObservers=new Batman.SimpleHash,this._setObservers.set("itemsWereAdded",function(){return b.fire.apply(b,["itemsWereAdded"].concat(c.call(arguments)))}),this._setObservers.set("itemsWereRemoved",function(){return b.fire.apply(b,["itemsWereRemoved"].concat(c.call(arguments)))}),this.on("itemsWereAdded",this.startObservingItems.bind(this)),this.on("itemsWereRemoved",this.stopObservingItems.bind(this))}return b(d,a),d.prototype.observedItemKeys=[],d.prototype.observerForItemAndKey=function(a,b){},d.prototype._getOrSetObserverForItemAndKey=function(a,b){var c=this;return this._itemObservers.getOrSet(a,function(){var d;return d=new Batman.SimpleHash,d.getOrSet(b,function(){return c.observerForItemAndKey(a,b)})})},d.prototype.startObserving=function(){return this._manageItemObservers("observe"),this._manageSetObservers("addHandler")},d.prototype.stopObserving=function(){return this._manageItemObservers("forget"),this._manageSetObservers("removeHandler")},d.prototype.startObservingItems=function(){var a,b,d,e,f;b=1<=arguments.length?c.call(arguments,0):[],f=[];for(d=0,e=b.length;d<e;d++)a=b[d],f.push(this._manageObserversForItem(a,"observe"));return f},d.prototype.stopObservingItems=function(){var a,b,d,e,f;b=1<=arguments.length?c.call(arguments,0):[],f=[];for(d=0,e=b.length;d<e;d++)a=b[d],f.push(this._manageObserversForItem(a,"forget"));return f},d.prototype._manageObserversForItem=function(a,b){var c,d,e,f;if(!a.isObservable)return;f=this.observedItemKeys;for(d=0,e=f.length;d<e;d++)c=f[d],a[b](c,this._getOrSetObserverForItemAndKey(a,c));if(b==="forget")return this._itemObservers.unset(a)},d.prototype._manageItemObservers=function(a){var b=this;return this.base.forEach(function(c){return b._manageObserversForItem(c,a)})},d.prototype._manageSetObservers=function(a){var b=this;if(!this.base.isObservable)return;return this._setObservers.forEach(function(c,d){return b.base.event(c)[a](d)})},d}(Batman.Object)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Batman.SetSort=function(a){function c(a,b,d){var e,f=this;this.key=b,d==null&&(d="asc"),c.__super__.constructor.call(this,a),this.descending=d.toLowerCase()==="desc",this.base.isObservable&&(this._setObserver=new Batman.SetObserver(this.base),this._setObserver.observedItemKeys=[this.key],e=function(){return f._reIndex()},this._setObserver.observerForItemAndKey=function(){return e},this._setObserver.on("itemsWereAdded",e),this._setObserver.on("itemsWereRemoved",e),this.startObserving()),this._reIndex()}return b(c,a),c.prototype.startObserving=function(){var a;return(a=this._setObserver)!=null?a.startObserving():void 0},c.prototype.stopObserving=function(){var a;return(a=this._setObserver)!=null?a.stopObserving():void 0},c.prototype.toArray=function(){return this.get("_storage")},c.prototype.forEach=function(a,b){var c,d,e,f,g,h;g=this.get("_storage"),h=[];for(d=e=0,f=g.length;e<f;d=++e)c=g[d],h.push(a.call(b,c,d,this));return h},c.prototype.find=function(a){var b,c,d,e;this.base.registerAsMutableSource(),e=this.get("_storage");for(c=0,d=e.length;c<d;c++){b=e[c];if(a(b))return b}},c.prototype.merge=function(a){return this.base.registerAsMutableSource(),function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b),f=typeof e;return f=="object"||f=="function"?e||d:d}(Batman.Set,this._storage,function(){}).merge(a).sortedBy(this.key,this.order)},c.prototype.compare=function(a,b){return a===b?0:a===void 0?1:b===void 0?-1:a===null?1:b===null?-1:a===!1?1:b===!1?-1:a===!0?1:b===!0?-1:a!==a?b!==b?0:1:b!==b?-1:a>b?1:a<b?-1:0},c.prototype._reIndex=function(){var a,b,c=this;return a=this.base.toArray().sort(function(a,b){var d,e,f;return e=Batman.get(a,c.key),typeof e=="function"&&(e=e.call(a)),e!=null&&(e=e.valueOf()),f=Batman.get(b,c.key),typeof f=="function"&&(f=f.call(b)),f!=null&&(f=f.valueOf()),d=c.descending?-1:1,c.compare.call(c,e,f)*d}),(b=this._setObserver)!=null&&b.startObservingItems.apply(b,a),this.set("_storage",a)},c}(Batman.SetProxy)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Batman.AssociationSet=function(a){function c(a,b){var d;this.foreignKeyValue=a,this.association=b,d=new Batman.Set,c.__super__.constructor.call(this,d,"_batmanID")}return b(c,a),c.prototype.loaded=!1,c.prototype.load=function(a){var b=this;return this.foreignKeyValue==null?a(void 0,this):this.association.getRelatedModel().loadWithOptions(this._getLoadOptions(),function(c,d){return c||b.markAsLoaded(),a(c,b)})},c.prototype._getLoadOptions=function(){var a;return a={data:{}},a.data[this.association.foreignKey]=this.foreignKeyValue,this.association.options.url&&(a.collectionUrl=this.association.options.url,a.urlContext=this.association.parentSetIndex().get(this.foreignKeyValue)),a},c.accessor("loaded",Batman.Property.defaultAccessor),c.prototype.markAsLoaded=function(){return this.set("loaded",!0),this.fire("loaded")},c}(Batman.SetSort)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Batman.PolymorphicAssociationSet=function(a){function c(a,b,d){this.foreignKeyValue=a,this.foreignTypeKeyValue=b,this.association=d,c.__super__.constructor.call(this,this.foreignKeyValue,this.association)}return b(c,a),c.prototype._getLoadOptions=function(){var a;return a={data:{}},a.data[this.association.foreignKey]=this.foreignKeyValue,a.data[this.association.foreignTypeKey]=this.foreignTypeKeyValue,this.association.options.url&&(a.collectionUrl=this.association.options.url,a.urlContext=this.association.parentSetIndex().get(this.foreignKeyValue)),a},c}(Batman.AssociationSet)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b},c=[].slice;Batman.SetIndex=function(a){function d(a,b){var e=this;this.base=a,this.key=b,d.__super__.constructor.call(this),this._storage=new Batman.Hash,this.base.isEventEmitter&&(this._setObserver=new Batman.SetObserver(this.base),this._setObserver.observedItemKeys=[this.key],this._setObserver.observerForItemAndKey=this.observerForItemAndKey.bind(this),this._setObserver.on("itemsWereAdded",function(){var a,b,d,f,g;b=1<=arguments.length?c.call(arguments,0):[],g=[];for(d=0,f=b.length;d<f;d++)a=b[d],g.push(e._addItem(a));return g}),this._setObserver.on("itemsWereRemoved",function(){var a,b,d,f,g;b=1<=arguments.length?c.call(arguments,0):[],g=[];for(d=0,f=b.length;d<f;d++)a=b[d],g.push(e._removeItem(a));return g})),this.base.forEach(this._addItem.bind(this)),this.startObserving()}return b(d,a),d.accessor("toArray",function(){return this.toArray()}),Batman.extend(d.prototype,Batman.Enumerable),d.prototype.propertyClass=Batman.Property,d.accessor(function(a){return this._resultSetForKey(a)}),d.prototype.startObserving=function(){var a;return(a=this._setObserver)!=null?a.startObserving():void 0},d.prototype.stopObserving=function(){var a;return(a=this._setObserver)!=null?a.stopObserving():void 0},d.prototype.observerForItemAndKey=function(a,b){var c=this;return function(b,d){return c._removeItemFromKey(a,d),c._addItemToKey(a,b)}},d.prototype.forEach=function(a,b){var c=this;return this._storage.forEach(function(d,e){if(e.get("length")>0)return a.call(b,d,e,c)})},d.prototype.toArray=function(){var a;return a=[],this._storage.forEach(function(b,c){if(c.get("length")>0)return a.push(b)}),a},d.prototype._addItem=function(a){return this._addItemToKey(a,this._keyForItem(a))},d.prototype._addItemToKey=function(a,b){return this._resultSetForKey(b).add(a)},d.prototype._removeItem=function(a){return this._removeItemFromKey(a,this._keyForItem(a))},d.prototype._removeItemFromKey=function(a,b){return this._resultSetForKey(b).remove(a)},d.prototype._resultSetForKey=function(a){return this._storage.getOrSet(a,function(){return new Batman.Set})},d.prototype._keyForItem=function(a){return Batman.Keypath.forBaseAndKey(a,this.key).getValue()},d}(Batman.Object)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Batman.PolymorphicAssociationSetIndex=function(a){function c(a,b,d){this.association=a,this.type=b,c.__super__.constructor.call(this,this.association.getRelatedModel().get("loaded"),d)}return b(c,a),c.prototype._resultSetForKey=function(a){return this.association.setForKey(a)},c.prototype._addItem=function(a){if(this.association.modelType()!==a.get(this.association.foreignTypeKey))return;return c.__super__._addItem.apply(this,arguments)},c.prototype._removeItem=function(a){if(this.association.modelType()!==a.get(this.association.foreignTypeKey))return;return c.__super__._removeItem.apply(this,arguments)},c}(Batman.SetIndex)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Batman.AssociationSetIndex=function(a){function c(a,b){this.association=a,c.__super__.constructor.call(this,this.association.getRelatedModel().get("loaded"),b)}return b(c,a),c.prototype._resultSetForKey=function(a){return this.association.setForKey(a)},c.prototype.forEach=function(a,b){var c=this;return this.association.proxies.forEach(function(d,e){var f;f=c.association.indexValueForRecord(d);if(e.get("length")>0)return a.call(b,f,e,c)})},c.prototype.toArray=function(){var a;return a=[],this.forEach(function(b){return a.push(b)}),a},c}(Batman.SetIndex)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Batman.UniqueSetIndex=function(a){function c(){this._uniqueIndex=new Batman.Hash,c.__super__.constructor.apply(this,arguments)}return b(c,a),c.accessor(function(a){return this._uniqueIndex.get(a)}),c.prototype._addItemToKey=function(a,b){this._resultSetForKey(b).add(a);if(!this._uniqueIndex.hasKey(b))return this._uniqueIndex.set(b,a)},c.prototype._removeItemFromKey=function(a,b){var d;return d=this._resultSetForKey(b),c.__super__._removeItemFromKey.apply(this,arguments),d.isEmpty()?this._uniqueIndex.unset(b):this._uniqueIndex.set(b,d.toArray()[0])},c}(Batman.SetIndex)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Batman.UniqueAssociationSetIndex=function(a){function c(a,b){this.association=a,c.__super__.constructor.call(this,this.association.getRelatedModel().get("loaded"),b)}return b(c,a),c}(Batman.UniqueSetIndex)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Batman.PolymorphicUniqueAssociationSetIndex=function(a){function c(a,b,d){this.association=a,this.type=b,c.__super__.constructor.call(this,this.association.getRelatedModelForType(b).get("loaded"),d)}return b(c,a),c}(Batman.UniqueSetIndex)}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b=[].slice;Batman.Navigator=function(){function c(b){this.app=b,this.handleCurrentLocation=a(this.handleCurrentLocation,this)}return c.defaultClass=function(){return Batman.config.usePushState&&Batman.PushStateNavigator.isSupported()?Batman.PushStateNavigator:Batman.HashbangNavigator},c.forApp=function(a){return new(this.defaultClass())(a)},c.prototype.start=function(){var a=this;if(typeof window=="undefined")return;if(this.started)return;return this.started=!0,this.startWatching(),Batman.currentApp.prevent("ready"),Batman.setImmediate(function(){if(a.started&&Batman.currentApp)return a.handleCurrentLocation(),Batman.currentApp.allowAndFire("ready")})},c.prototype.stop=function(){return this.stopWatching(),this.started=!1},c.prototype.handleLocation=function(a){var b;b=this.pathFromLocation(a);if(b===this.cachedPath)return;return this.dispatch(b)},c.prototype.handleCurrentLocation=function(){return this.handleLocation(window.location)},c.prototype.dispatch=function(a){return this.cachedPath=this.app.get("dispatcher").dispatch(a),this._lastRedirect&&(this.cachedPath=this._lastRedirect),this.cachedPath},c.prototype.push=function(a){var b,c,d;return c=typeof (d=this.app.get("dispatcher")).pathFromParams=="function"?d.pathFromParams(a):void 0,c&&(this._lastRedirect=c),b=this.dispatch(a),(!this._lastRedirect||this._lastRedirect===b)&&this.pushState(null,"",b),b},c.prototype.replace=function(a){var b,c,d;return c=typeof (d=this.app.get("dispatcher")).pathFromParams=="function"?d.pathFromParams(a):void 0,c&&(this._lastRedirect=c),b=this.dispatch(a),(!this._lastRedirect||this._lastRedirect===b)&&this.replaceState(null,"",b),b},c.prototype.redirect=c.prototype.push,c.prototype.normalizePath=function(){var a,c,d;return d=1<=arguments.length?b.call(arguments,0):[],d=function(){var b,e,f;f=[];for(a=b=0,e=d.length;b<e;a=++b)c=d[a],f.push((""+c).replace(/^(?!\/)/,"/").replace(/\/+$/,""));return f}(),d.join("")||"/"},c.normalizePath=c.prototype.normalizePath,c}()}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Batman.PushStateNavigator=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.isSupported=function(){var a;return(typeof window!=="undefined"&&window!==null?(a=window.history)!=null?a.pushState:void 0:void 0)!=null},c.prototype.startWatching=function(){return Batman.DOM.addEventListener(window,"popstate",this.handleCurrentLocation)},c.prototype.stopWatching=function(){return Batman.DOM.removeEventListener(window,"popstate",this.handleCurrentLocation)},c.prototype.pushState=function(a,b,c){if(c!==this.pathFromLocation(window.location))return window.history.pushState(a,b,this.linkTo(c))},c.prototype.replaceState=function(a,b,c){if(c!==this.pathFromLocation(window.location))return window.history.replaceState(a,b,this.linkTo(c))},c.prototype.linkTo=function(a){return this.normalizePath(Batman.config.pathPrefix,a)},c.prototype.pathFromLocation=function(a){var b,c;return b=""+(a.pathname||"")+(a.search||""),c=new RegExp("^"+this.normalizePath(Batman.config.pathPrefix)),this.normalizePath(b.replace(c,""))},c.prototype.handleLocation=function(a){var b,d;return d=this.pathFromLocation(a),d==="/"&&(b=Batman.HashbangNavigator.prototype.pathFromLocation(a))!=="/"?this.replace(b):c.__super__.handleLocation.apply(this,arguments)},c}(Batman.Navigator)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Batman.HashbangNavigator=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.HASH_PREFIX="#!",typeof window!="undefined"&&window!==null&&"onhashchange"in window?(c.prototype.startWatching=function(){return Batman.DOM.addEventListener(window,"hashchange",this.handleCurrentLocation)},c.prototype.stopWatching=function(){return Batman.DOM.removeEventListener(window,"hashchange",this.handleCurrentLocation)}):(c.prototype.startWatching=function(){return this.interval=setInterval(this.handleCurrentLocation,100)},c.prototype.stopWatching=function(){return this.interval=clearInterval(this.interval)}),c.prototype.pushState=function(a,b,c){return window.location.hash=this.linkTo(c)},c.prototype.replaceState=function(a,b,c){var d;return d=window.location,d.replace(""+d.pathname+d.search+this.linkTo(c))},c.prototype.linkTo=function(a){return this.HASH_PREFIX+a},c.prototype.pathFromLocation=function(a){var b;return b=a.hash,(b!=null?b.substr(0,2):void 0)===this.HASH_PREFIX?this.normalizePath(b.substr(2)):"/"},c.prototype.handleLocation=function(a){var b;return Batman.config.usePushState?(b=Batman.PushStateNavigator.prototype.pathFromLocation(a),b==="/"?c.__super__.handleLocation.apply(this,arguments):a.replace(this.normalizePath(""+Batman.config.pathPrefix+this.linkTo(b)))):c.__super__.handleLocation.apply(this,arguments)},c}(Batman.Navigator)}.call(this),function(){Batman.RouteMap=function(){function a(){this.childrenByOrder=[],this.childrenByName={}}return a.prototype.memberRoute=null,a.prototype.collectionRoute=null,a.prototype.routeForParams=function(a){var b,c,d,e;e=this.childrenByOrder;for(c=0,d=e.length;c<d;c++){b=e[c];if(b.test(a))return b}return void 0},a.prototype.addRoute=function(a,b){var c,d,e=this;return this.childrenByOrder.push(b),a.length>0&&(d=a.split(".")).length>0?(c=d.shift(),this.childrenByName[c]||(this.childrenByName[c]=new Batman.RouteMap),this.childrenByName[c].addRoute(d.join("."),b)):b.get("member")?this.memberRoute=b:this.collectionRoute=b,!0},a}()}.call(this),function(){var a=[].slice;Batman.RouteMapBuilder=function(){function b(a,b,c,d){this.app=a,this.routeMap=b,this.parent=c,this.baseOptions=d!=null?d:{},this.parent?(this.rootPath=this.parent._nestingPath(),this.rootName=this.parent._nestingName()):(this.rootPath="",this.rootName="")}return b.BUILDER_FUNCTIONS=["resources","member","collection","route","root"],b.ROUTES={index:{cardinality:"collection",path:function(a){return a},name:function(a){return a}},"new":{cardinality:"collection",path:function(a){return""+a+"/new"},name:function(a){return""+a+".new"}},show:{cardinality:"member",path:function(a){return""+a+"/:id"},name:function(a){return a}},edit:{cardinality:"member",path:function(a){return""+a+"/:id/edit"},name:function(a){return""+a+".edit"}},collection:{cardinality:"collection",path:function(a,b){return""+a+"/"+b},name:function(a,b){return""+a+"."+b}},member:{cardinality:"member",path:function(a,b){return""+a+"/:id/"+b},name:function(a,b){return""+a+"."+b}}},b.prototype.resources=function(){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A;e=1<=arguments.length?a.call(arguments,0):[],o=function(){var a,b,c;c=[];for(a=0,b=e.length;a<b;a++)d=e[a],typeof d=="string"&&c.push(d);return c}(),typeof e[e.length-1]=="function"&&(g=e.pop()),typeof e[e.length-1]=="object"?l=e.pop():l={},c={index:!0,"new":!0,show:!0,edit:!0};if(l.except){z=l.except;for(t=0,w=z.length;t<w;t++)k=z[t],c[k]=!1;delete l.except}else if(l.only){for(k in c)s=c[k],c[k]=!1;A=l.only;for(u=0,x=A.length;u<x;u++)k=A[u],c[k]=!0;delete l.only}for(v=0,y=o.length;v<y;v++){n=o[v],p=Batman.helpers.pluralize(n),i=Batman.helpers.camelize(p,!0),h=this._childBuilder({controller:i}),g!=null&&g.call(h);for(b in c){j=c[b];if(!j)continue;r=this.constructor.ROUTES[b],f=r.name(p),m=r.path(p),q=Batman.extend({controller:i,action:b,path:m,as:f},l),h[r.cardinality](b,q)}}return!0},b.prototype.member=function(){return this._addRoutesWithCardinality.apply(this,["member"].concat(a.call(arguments)))},b.prototype.collection=function(){return this._addRoutesWithCardinality.apply(this,["collection"].concat(a.call(arguments)))},b.prototype.root=function(a,b){return this.route("/",a,b)},b.prototype.route=function(a,b,c,d){return d||(typeof c=="function"?(d=c,c=void 0):typeof b=="function"&&(d=b,b=void 0)),c?b&&(c.signature=b):(typeof b=="string"?c={signature:b}:c=b,c||(c={})),d&&(c.callback=d),c.as||(c.as=this._nameFromPath(a)),c.path=a,this._addRoute(c)},b.prototype._addRoutesWithCardinality=function(){var b,c,d,e,f,g,h,i,j,k;b=arguments[0],d=3<=arguments.length?a.call(arguments,1,i=arguments.length-1):(i=1,[]),e=arguments[i++],typeof e=="string"&&(d.push(e),e={}),e=Batman.extend({},this.baseOptions,e),e[b]=!0,h=this.constructor.ROUTES[b],f=Batman.helpers.underscore(e.controller);for(j=0,k=d.length;j<k;j++)c=d[j],g=Batman.extend({action:c},e),g.path==null&&(g.path=h.path(f,c)),g.as==null&&(g.as=h.name(f,c)),this._addRoute(g);return!0},b.prototype._addRoute=function(a){var b,c,d,e;return a==null&&(a={}),d=this.rootPath+a.path,c=this.rootName+Batman.helpers.camelize(a.as,!0),delete a.as,delete a.path,b=a.callback?Batman.CallbackActionRoute:Batman.ControllerActionRoute,a.app=this.app,e=new b(d,a),this.routeMap.addRoute(c,e)},b.prototype._nameFromPath=function(a){return a=a.replace(Batman.Route.regexps.namedOrSplat,"").replace(/\/+/g,".").replace(/(^\.)|(\.$)/g,""),a},b.prototype._nestingPath=function(){var a,b;return this.parent?(a=":"+Batman.helpers.singularize(this.baseOptions.controller)+"Id",b=Batman.helpers.underscore(this.baseOptions.controller),""+this.parent._nestingPath()+b+"/"+a+"/"):""},b.prototype._nestingName=function(){return this.parent?this.parent._nestingName()+this.baseOptions.controller+".":""},b.prototype._childBuilder=function(a){return a==null&&(a={}),new Batman.RouteMapBuilder(this.app,this.routeMap,this,a)},b}()}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b},c=[].slice;Batman.App=function(a){function i(){return i.__super__.constructor.apply(this,arguments)}var c,d,e,f,g,h=this;b(i,a),i.classAccessor("currentParams",{get:function(){return new Batman.Hash},"final":!0}),i.classAccessor("paramsManager",{get:function(){var a,b;if(!(a=this.get("navigator")))return;return b=this.get("currentParams"),b.replacer=new Batman.ParamsReplacer(a,b)},"final":!0}),i.classAccessor("paramsPusher",{get:function(){var a,b;if(!(a=this.get("navigator")))return;return b=this.get("currentParams"),b.pusher=new Batman.ParamsPusher(a,b)},"final":!0}),i.classAccessor("routes",function(){return new Batman.NamedRouteQuery(this.get("routeMap"))}),i.classAccessor("routeMap",function(){return new Batman.RouteMap}),i.classAccessor("routeMapBuilder",function(){return new Batman.RouteMapBuilder(this,this.get("routeMap"))}),i.classAccessor("dispatcher",function(){return new Batman.Dispatcher(this,this.get("routeMap"))}),i.classAccessor("controllers",function(){return this.get("dispatcher.controllers")}),i.classAccessor("_renderContext",function(){return Batman.RenderContext.base.descend(this)}),i.requirePath="",i.layout=void 0,i.shouldAllowEvent={},g=Batman.RouteMapBuilder.BUILDER_FUNCTIONS,d=function(a){return i[a]=function(){var b;return(b=this.get("routeMapBuilder"))[a].apply(b,arguments)}};for(e=0,f=g.length;e<f;e++)c=g[e],d(c);return i.event("ready").oneShot=!0,i.event("run").oneShot=!0,i.run=function(){var a,b,c=this;if(Batman.currentApp){if(Batman.currentApp===this)return;Batman.currentApp.stop()}return this.hasRun?!1:this.isPrevented("run")?(this.wantsToRun=!0,!1):(delete this.wantsToRun,Batman.currentApp=this,Batman.App.set("current",this),this.get("dispatcher")==null&&(this.set("dispatcher",new Batman.Dispatcher(this,this.get("routeMap"))),this.set("controllers",this.get("dispatcher.controllers"))),this.get("navigator")==null&&(this.set("navigator",Batman.Navigator.forApp(this)),this.on("run",function(){Batman.navigator=c.get("navigator");if(Object.keys(c.get("dispatcher").routeMap).length>0)return Batman.navigator.start()})),this.observe("layout",function(a){return a!=null?a.on("ready",function(){return c.fire("ready")}):void 0}),a=this.get("layout"),a?typeof a=="string"&&(b=this[Batman.helpers.camelize(a)+"View"]):a!==null&&(b=Batman.View),b&&(a=this.set("layout",new b({context:this,node:document}))),this.hasRun=!0,this.fire("run"),this)},i.event("ready").oneShot=!0,i.event("stop").oneShot=!0,i.stop=function(){var a;return(a=this.navigator)!=null&&a.stop(),Batman.navigator=null,this.hasRun=!1,this.fire("stop"),this},i}.call(this,Batman.Object)}.call(this),function(){Batman.Association=function(){function a(a,b,c){var d,e,f,g;this.model=a,this.label=b,c==null&&(c={}),d={namespace:Batman.currentApp,name:Batman.helpers.camelize(Batman.helpers.singularize(this.label))},this.options=Batman.extend(d,this.defaultOptions,c),this.options.nestUrl&&(this.model.urlNestsUnder!=null,this.model.urlNestsUnder(Batman.helpers.underscore(this.getRelatedModel().get("resourceName")))),this.options.extend!=null&&Batman.extend(this,this.options.extend),e={encode:this.options.saveInline?this.encoder():!1,decode:this.decoder()},this.model.encode(this.label,e),g=this,f=function(){return g.getAccessor.call(this,g,this.model,this.label)},this.model.accessor(this.label,{get:f,set:a.defaultAccessor.set,unset:a.defaultAccessor.unset})}return a.prototype.associationType="",a.prototype.isPolymorphic=!1,a.prototype.defaultOptions={saveInline:!0,autoload:!0,nestUrl:!1},a.prototype.getRelatedModel=function(){var a,b,c;return c=this.options.namespace||Batman.currentApp,a=this.options.name,b=c!=null?c[a]:void 0,b},a.prototype.getFromAttributes=function(a){return a.get("attributes."+this.label)},a.prototype.setIntoAttributes=function(a,b){return a.get("attributes").set(this.label,b)},a.prototype.inverse=function(){var a,b,c=this;if(b=this.getRelatedModel()._batman.get("associations"))return this.options.inverseOf?b.getByLabel(this.options.inverseOf):(a=null,b.forEach(function(b,d){if(d.getRelatedModel()===c.model)return a=d}),a)},a.prototype.reset=function(){return delete this.index,!0},a}()}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Batman.PluralAssociation=function(a){function c(){c.__super__.constructor.apply(this,arguments),this._resetSetHashes()}return b(c,a),c.prototype.proxyClass=Batman.AssociationSet,c.prototype.isSingular=!1,c.prototype.setForRecord=function(a){var b,c,d=this;return c=this.indexValueForRecord(a),b=this.setIndex(),Batman.Property.withoutTracking(function(){return d._setsByRecord.getOrSet(a,function(){var a,b;if(c!=null){a=d._setsByValue.get(c);if(a!=null)return a}return b=d.proxyClassInstanceForKey(c),c!=null&&d._setsByValue.set(c,b),b})}),c!=null?b.get(c):this._setsByRecord.get(a)},c.prototype.setForKey=Batman.Property.wrapTrackingPrevention(function(a){var b,c=this;return b=void 0,this._setsByRecord.forEach(function(d,e){if(b!=null)return;if(c.indexValueForRecord(d)===a)return b=e}),b!=null?(b.foreignKeyValue=a,b):this._setsByValue.getOrSet(a,function(){return c.proxyClassInstanceForKey(a)})}),c.prototype.proxyClassInstanceForKey=function(a){return new this.proxyClass(a,this)},c.prototype.getAccessor=function(a,b,c){var d,e,f=this;if(!a.getRelatedModel())return;return(e=a.getFromAttributes(this))?e:(d=a.setForRecord(this),a.setIntoAttributes(this,d),Batman.Property.withoutTracking(function(){if(a.options.autoload&&!f.isNew()&&!d.loaded)return d.load(function(a,b){if(a)throw a})}),d)},c.prototype.parentSetIndex=function(){return this.parentIndex||(this.parentIndex=this.model.get("loaded").indexedByUnique(this.primaryKey)),this.parentIndex},c.prototype.setIndex=function(){return this.index||(this.index=new Batman.AssociationSetIndex(this,this[this.indexRelatedModelOn])),this.index},c.prototype.indexValueForRecord=function(a){return a.get(this.primaryKey)},c.prototype.reset=function(){return c.__super__.reset.apply(this,arguments),this._resetSetHashes()},c.prototype._resetSetHashes=function(){return this._setsByRecord=new Batman.SimpleHash,this._setsByValue=new Batman.SimpleHash},c}(Batman.Association)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Batman.HasManyAssociation=function(a){function c(a,b,d){if(d!=null?d.as:void 0)return function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b),f=typeof e;return f=="object"||f=="function"?e||d:d}(Batman.PolymorphicHasManyAssociation,arguments,function(){});c.__super__.constructor.apply(this,arguments),this.primaryKey=this.options.primaryKey||"id",this.foreignKey=this.options.foreignKey||""+Batman.helpers.underscore(a.get("resourceName"))+"_id"}return b(c,a),c.prototype.associationType="hasMany",c.prototype.indexRelatedModelOn="foreignKey",c.prototype.apply=function(a,b){var c,d,e=this;if(!a){(c=this.getFromAttributes(b))&&c.forEach(function(a){return a.set(e.foreignKey,b.get(e.primaryKey))}),b.set(this.label,d=this.setForRecord(b));if(b.lifecycle.get("state")==="creating")return d.markAsLoaded()}},c.prototype.encoder=function(){var a;return a=this,function(b,c,d,e){var f;return b!=null&&(f=[],b.forEach(function(b){var c;c=b.toJSON();if(!a.inverse()||a.inverse().options.encodeForeignKey)c[a.foreignKey]=e.get(a.primaryKey);return f.push(c)})),f}},c.prototype.decoder=function(){var a;return a=this,function(b,c,d,e,f){var g,h,i,j,k,l,m,n,o;if(l=a.getRelatedModel()){h=a.getFromAttributes(f)||a.setForRecord(f),j=h.filter(function(a){return a.isNew()}).toArray();for(n=0,o=b.length;n<o;n++)i=b[n],k=new l,k._withoutDirtyTracking(function(){return this.fromJSON(i)}),g=l.get("loaded").indexedByUnique("id").get(k.get("id")),g!=null?(g._withoutDirtyTracking(function(){return this.fromJSON(i)}),k=g):j.length>0&&(m=j.shift(),m._withoutDirtyTracking(function(){return this.fromJSON(i)}),k=m),k=l._mapIdentity(k),h.add(k),a.options.inverseOf&&k.set(a.options.inverseOf,f);h.markAsLoaded()}return h}},c}(Batman.PluralAssociation)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Batman.PolymorphicHasManyAssociation=function(a){function c(a,b,d){d.inverseOf=this.foreignLabel=d.as,delete d.as,d.foreignKey||(d.foreignKey=""+this.foreignLabel+"_id"),c.__super__.constructor.call(this,a,b,d),this.foreignTypeKey=d.foreignTypeKey||""+this.foreignLabel+"_type",this.model.encode(this.foreignTypeKey)}return b(c,a),c.prototype.proxyClass=Batman.PolymorphicAssociationSet,c.prototype.isPolymorphic=!0,c.prototype.apply=function(a,b){var d,e=this;return!a&&(d=this.getFromAttributes(b))&&(c.__super__.apply.apply(this,arguments),d.forEach(function(a){return a.set(e.foreignTypeKey,e.modelType())})),!0},c.prototype.proxyClassInstanceForKey=function(a){return new this.proxyClass(a,this.modelType(),this)},c.prototype.getRelatedModelForType=function(a){var b,c;return c=this.options.namespace||Batman.currentApp,a?(b=c!=null?c[a]:void 0,b||(b=c!=null?c[Batman.helpers.camelize(a)]:void 0)):b=this.getRelatedModel(),b},c.prototype.modelType=function(){return this.model.get("resourceName")},c.prototype.setIndex=function(){return this.typeIndex||(this.typeIndex=new Batman.PolymorphicAssociationSetIndex(this,this.modelType(),this[this.indexRelatedModelOn])),this.typeIndex},c.prototype.encoder=function(){var a;return a=this,function(b,c,d,e){var f;return b!=null&&(f=[],b.forEach(function(b){var c;return c=b.toJSON(),c[a.foreignKey]=e.get(a.primaryKey),c[a.foreignTypeKey]=a.modelType(),f.push(c)})),f}},c.prototype.decoder=function(){var a;return a=this,function(b,c,d,e,f){var g,h,i,j,k,l,m,n,o,p,q;if(l=a.getRelatedModel()){h=a.getFromAttributes(f)||a.setForRecord(f),j=h.filter(function(a){return a.isNew()}).toArray();for(p=0,q=b.length;p<q;p++)i=b[p],o=i[a.options.foreignTypeKey],n=a.getRelatedModelForType(o),k=new n,k._withoutDirtyTracking(function(){return this.fromJSON(i)}),g=l.get("loaded").indexedByUnique("id").get(k.get("id")),g!=null?(g._withoutDirtyTracking(function(){return this.fromJSON(i)}),k=g):j.length>0&&(m=j.shift(),m._withoutDirtyTracking(function(){return this.fromJSON(i)}),k=m),k=l._mapIdentity(k),h.add(k),a.options.inverseOf&&k.set(a.options.inverseOf,f);h.markAsLoaded()}return h}},c}(Batman.HasManyAssociation)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Batman.SingularAssociation=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.isSingular=!0,c.prototype.getAccessor=function(a,b,c){var d,e,f,g,h;if(g=a.getFromAttributes(this))return g;if(a.getRelatedModel())return e=this.associationProxy(a),f=!1,d=this,(h=e._loadSetter)==null&&(e._loadSetter=e.once("loaded",function(b){return d._withoutDirtyTracking(function(){return this.set(a.label,b)})})),Batman.Property.withoutTracking(function(){return e.get("loaded")})||(a.options.autoload?Batman.Property.withoutTracking(function(){return e.load()}):f=e.loadFromLocal()),f||e},c.prototype.setIndex=function(){return this.index||(this.index=new Batman.UniqueAssociationSetIndex(this,this[this.indexRelatedModelOn])),this.index},c}(Batman.Association)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Batman.HasOneAssociation=function(a){function c(){c.__super__.constructor.apply(this,arguments),this.primaryKey=this.options.primaryKey||"id",this.foreignKey=this.options.foreignKey||""+Batman.helpers.underscore(this.model.get("resourceName"))+"_id"}return b(c,a),c.prototype.associationType="hasOne",c.prototype.proxyClass=Batman.HasOneProxy,c.prototype.indexRelatedModelOn="foreignKey",c.prototype.apply=function(a,b){var c;if(c=this.getFromAttributes(b))return c.set(this.foreignKey,b.get(this.primaryKey))},c.prototype.encoder=function(){var a;return a=this,function(b,c,d,e){var f;if(!a.options.saveInline)return;if(f=b.toJSON())f[a.foreignKey]=e.get(a.primaryKey);return f}},c.prototype.decoder=function(){var a;return a=this,function(b,c,d,e,f){var g,h;if(!b)return;return h=a.getRelatedModel(),g=h.createFromJSON(b),a.options.inverseOf&&g.set(a.options.inverseOf,f),g}},c}(Batman.SingularAssociation)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Batman.BelongsToAssociation=function(a){function c(a,b,d){if(d!=null?d.polymorphic:void 0)return delete d.polymorphic,function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b),f=typeof e;return f=="object"||f=="function"?e||d:d}(Batman.PolymorphicBelongsToAssociation,arguments,function(){});c.__super__.constructor.apply(this,arguments),this.foreignKey=this.options.foreignKey||""+this.label+"_id",this.primaryKey=this.options.primaryKey||"id",this.options.encodeForeignKey&&this.model.encode(this.foreignKey)}return b(c,a),c.prototype.associationType="belongsTo",c.prototype.proxyClass=Batman.BelongsToProxy,c.prototype.indexRelatedModelOn="primaryKey",c.prototype.defaultOptions={saveInline:!1,autoload:!0,encodeForeignKey:!0},c.prototype.encoder=function(){return function(a){return a.toJSON()}},c.prototype.decoder=function(){var a;return a=this,function(b,c,d,e,f){var g,h,i;return i=a.getRelatedModel(),h=i.createFromJSON(b),a.options.inverseOf&&(g=a.inverse())&&(g instanceof Batman.HasManyAssociation?f.set(a.foreignKey,h.get(a.primaryKey)):h.set(g.label,f)),f.set(a.label,h),h}},c.prototype.apply=function(a){var b,c;if(c=a.get(this.label)){b=c.get(this.primaryKey);if(b!==void 0)return a.set(this.foreignKey,b)}},c}(Batman.SingularAssociation)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Batman.PolymorphicBelongsToAssociation=function(a){function c(){c.__super__.constructor.apply(this,arguments),this.foreignTypeKey=this.options.foreignTypeKey||""+this.label+"_type",this.options.encodeForeignTypeKey&&this.model.encode(this.foreignTypeKey),this.typeIndicies={}}return b(c,a),c.prototype.isPolymorphic=!0,c.prototype.proxyClass=Batman.PolymorphicBelongsToProxy,c.prototype.defaultOptions=Batman.mixin({},Batman.BelongsToAssociation.prototype.defaultOptions,{encodeForeignTypeKey:!0}),c.prototype.getRelatedModel=!1,c.prototype.setIndex=!1,c.prototype.inverse=!1,c.prototype.apply=function(a){var b,d;c.__super__.apply.apply(this,arguments);if(d=a.get(this.label))return b=d instanceof Batman.PolymorphicBelongsToProxy?d.get("foreignTypeValue"):d.constructor.get("resourceName"),a.set(this.foreignTypeKey,b)},c.prototype.getAccessor=function(a,b,c){var d,e;if(e=a.getFromAttributes(this))return e;if(a.getRelatedModelForType(this.get(a.foreignTypeKey)))return d=this.associationProxy(a),Batman.Property.withoutTracking(function(){if(!d.get("loaded")&&a.options.autoload)return d.load()}),d},c.prototype.url=function(a){var b,c,d,e,f,g,h,i;g=(h=a.data)!=null?h[this.foreignTypeKey]:void 0;if(g&&(e=this.inverseForType(g)))return f=Batman.helpers.pluralize(g).toLowerCase(),d=(i=a.data)!=null?i[this.foreignKey]:void 0,c=e.isSingular?"singularize":"pluralize",b=Batman.helpers[c](e.label),"/"+f+"/"+d+"/"+b},c.prototype.getRelatedModelForType=function(a){var b,c;return c=this.options.namespace||Batman.currentApp,a&&(b=c!=null?c[a]:void 0,b||(b=c!=null?c[Batman.helpers.camelize(a)]:void 0)),b},c.prototype.setIndexForType=function(a){var b;return(b=this.typeIndicies)[a]||(b[a]=new Batman.PolymorphicUniqueAssociationSetIndex(this,a,this.primaryKey)),this.typeIndicies[a]},c.prototype.inverseForType=function(a){var b,c,d,e=this;if(c=(d=this.getRelatedModelForType(a))!=null?d._batman.get("associations"):void 0)return this.options.inverseOf?c.getByLabel(this.options.inverseOf):(b=null,c.forEach(function(a,c){if(c.getRelatedModel()===e.model)return b=c}),b)},c.prototype.decoder=function(){var a;return a=this,function(b,c,d,e,f){var g,h,i,j;return g=d[a.foreignTypeKey]||f.get(a.foreignTypeKey),j=a.getRelatedModelForType(g),i=j.createFromJSON(b),a.options.inverseOf&&(h=a.inverseForType(g))&&(h instanceof Batman.PolymorphicHasManyAssociation?(f.set(a.foreignKey,i.get(a.primaryKey)),f.set(a.foreignTypeKey,g)):i.set(h.label,f)),f.set(a.label,i),i}},c}(Batman.BelongsToAssociation)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b},c=[].slice;Batman.Validator=function(a){function d(){var a,b;b=arguments[0],a=2<=arguments.length?c.call(arguments,1):[],this.options=b,d.__super__.constructor.apply(this,a)}return b(d,a),d.triggers=function(){var a;return a=1<=arguments.length?c.call(arguments,0):[],this._triggers!=null?this._triggers.concat(a):this._triggers=a},d.options=function(){var a;return a=1<=arguments.length?c.call(arguments,0):[],this._options!=null?this._options.concat(a):this._options=a},d.matches=function(a){var b,c,d,e,f,g;c={},d=!1;for(b in a)e=a[b],~((f=this._options)!=null?f.indexOf(b):void 0)&&(c[b]=e),~((g=this._triggers)!=null?g.indexOf(b):void 0)&&(c[b]=e,d=!0);if(d)return c},d.prototype.validate=function(a){},d.prototype.format=function(a,b,c){return Batman.t("errors.messages."+b,c)},d.prototype.handleBlank=function(a){if(this.options.allowBlank&&!Batman.PresenceValidator.prototype.isPresent(a))return!0},d}(Batman.Object)}.call(this),function(){Batman.Validators=[],Batman.extend(Batman.translate.messages,{errors:{format:"%{attribute} %{message}",messages:{too_short:"must be at least %{count} characters",too_long:"must be less than %{count} characters",wrong_length:"must be %{count} characters",blank:"can't be blank",not_numeric:"must be a number",greater_than:"must be greater than %{count}",greater_than_or_equal_to:"must be greater than or equal to %{count}",equal_to:"must be equal to %{count}",less_than:"must be less than %{count}",less_than_or_equal_to:"must be less than or equal to %{count}",not_matching:"is not valid",invalid_association:"is not valid"}}})}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Batman.RegExpValidator=function(a){function c(a){var b;this.regexp=(b=a.regexp)!=null?b:a.pattern,c.__super__.constructor.apply(this,arguments)}return b(c,a),c.triggers("regexp","pattern"),c.options("allowBlank"),c.prototype.validateEach=function(a,b,c,d){var e;return e=b.get(c),this.handleBlank(e)?d():((e==null||e===""||!this.regexp.test(e))&&a.add(c,this.format(c,"not_matching")),d())},c}(Batman.Validator),Batman.Validators.push(Batman.RegExpValidator)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Batman.PresenceValidator=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.triggers("presence"),c.prototype.validateEach=function(a,b,c,d){var e;return e=b.get(c),this.isPresent(e)||a.add(c,this.format(c,"blank")),d()},c.prototype.isPresent=function(a){return a!=null&&a!==""},c}(Batman.Validator),Batman.Validators.push(Batman.PresenceValidator)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Batman.NumericValidator=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.triggers("numeric","greaterThan","greaterThanOrEqualTo","equalTo","lessThan","lessThanOrEqualTo"),c.options("allowBlank"),c.prototype.validateEach=function(a,b,c,d){var e,f;return e=this.options,f=b.get(c),this.handleBlank(f)?d():(f==null||!this.isNumeric(f)&&!this.canCoerceToNumeric(f)?a.add(c,this.format(c,"not_numeric")):(e.greaterThan&&f<=e.greaterThan&&a.add(c,this.format(c,"greater_than",{count:e.greaterThan})),e.greaterThanOrEqualTo&&f<e.greaterThanOrEqualTo&&a.add(c,this.format(c,"greater_than_or_equal_to",{count:e.greaterThanOrEqualTo})),e.equalTo&&f!==e.equalTo&&a.add(c,this.format(c,"equal_to",{count:e.equalTo})),e.lessThan&&f>=e.lessThan&&a.add(c,this.format(c,"less_than",{count:e.lessThan})),e.lessThanOrEqualTo&&f>e.lessThanOrEqualTo&&a.add(c,this.format(c,"less_than_or_equal_to",{count:e.lessThanOrEqualTo}))),d())},c.prototype.isNumeric=function(a){return!isNaN(parseFloat(a))&&isFinite(a)},c.prototype.canCoerceToNumeric=function(a){return a-0==a&&a.length>0},c}(Batman.Validator),Batman.Validators.push(Batman.NumericValidator)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Batman.LengthValidator=function(a){function c(a){var b;if(b=a.lengthIn||a.lengthWithin)a.minLength=b[0],a.maxLength=b[1]||-1,delete a.lengthWithin,delete a.lengthIn;c.__super__.constructor.apply(this,arguments)}return b(c,a),c.triggers("minLength","maxLength","length","lengthWithin","lengthIn"),c.options("allowBlank"),c.prototype.validateEach=function(a,b,c,d){var e,f;return e=this.options,f=b.get(c),f!==""&&this.handleBlank(f)?d():(f==null&&(f=[]),e.minLength&&f.length<e.minLength&&a.add(c,this.format(c,"too_short",{count:e.minLength})),e.maxLength&&f.length>e.maxLength&&a.add(c,this.format(c,"too_long",{count:e.maxLength})),e.length&&f.length!==e.length&&a.add(c,this.format(c,"wrong_length",{count:e.length})),d())},c}(Batman.Validator),Batman.Validators.push(Batman.LengthValidator)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Batman.AssociatedValidator=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.triggers("associated"),c.prototype.validateEach=function(a,b,c,d){var e,f,g,h=this;return g=b.get(c),g!=null?(g instanceof Batman.AssociationProxy&&(g=typeof g.get=="function"?g.get("target"):void 0),f=1,e=function(b,e){e.length>0&&a.add(c,h.format(c,"invalid_association"));if(--f===0)return d()},(g!=null?g.forEach:void 0)!=null?g.forEach(function(a){return f+=1,a.validate(e)}):(g!=null?g.validate:void 0)!=null&&(f+=1,g.validate(e)),e(null,[])):d()},c}(Batman.Validator),Batman.Validators.push(Batman.AssociatedValidator)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Batman.ControllerActionFrame=function(a){function c(a,b){c.__super__.constructor.call(this,a),this.once("complete",b)}return b(c,a),c.prototype.operationOccurred=!1,c.prototype.remainingOperations=0,c.prototype.event("complete").oneShot=!0,c.prototype.startOperation=function(a){return a==null&&(a={}),a.internal||(this.operationOccurred=!0),this._changeOperationsCounter(1),!0},c.prototype.finishOperation=function(){return this._changeOperationsCounter(-1),!0},c.prototype.startAndFinishOperation=function(a){return this.startOperation(a),this.finishOperation(a),!0},c.prototype._changeOperationsCounter=function(a){var b;this.remainingOperations+=a,this.remainingOperations===0&&this.fire("complete"),(b=this.parentFrame)!=null&&b._changeOperationsCounter(a)},c}(Batman.Object)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Batman.DOM.InsertionBinding=function(a){function c(a){var b=this;this.invert=a.invert,this.placeholderNode=document.createComment("detached node "+this.get("_batmanID")),c.__super__.constructor.apply(this,arguments),Batman.DOM.onParseExit(this.node,function(){b.bind();if(b.placeholderNode!=null)return Batman.DOM.trackBinding(b,b.placeholderNode)})}return b(c,a),c.prototype.isTwoWay=!1,c.prototype.bindImmediately=!1,c.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,c.prototype.dataChange=function(a){var b;b=this.placeholderNode.parentNode||this.node.parentNode;if(!!a==!this.invert){if(this.node.parentNode==null)return Batman.DOM.insertBefore(b,this.node,this.placeholderNode),b.removeChild(this.placeholderNode)}else if(this.node.parentNode!=null)return b.insertBefore(this.placeholderNode,this.node),Batman.DOM.removeNode(this.node)},c.prototype.die=function(){var a,b,d;if(this.dead)return;return b=this.node,d=this.placeholderNode,a=this.get("filteredValue"),c.__super__.die.apply(this,arguments),!!a==!this.invert?Batman.DOM.destroyNode(d):Batman.DOM.destroyNode(b)},c}(Batman.DOM.AbstractBinding)}.call(this),function(){var a;a=function(a){var b;for(b in a)return!1;return!0},Batman.extend(Batman,{cache:{},uuid:0,expando:"batman"+Math.random().toString().replace(/\D/g,""),canDeleteExpando:function(){var a;try{return a=document.createElement("div"),delete a.test}catch(b){return Batman.canDeleteExpando=!1}}(),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(b){return b=b.nodeType?Batman.cache[b[Batman.expando]]:b[Batman.expando],!!b&&!a(b)},data:function(a,b,c,d){var e,f,g,h,i,j;if(!Batman.acceptData(a))return;h=Batman.expando,f=typeof b=="string",e=Batman.cache,g=a[Batman.expando];if((!g||d&&g&&e[g]&&!e[g][h])&&f&&c===void 0)return;g||(a.nodeType!==3?a[Batman.expando]=g=++Batman.uuid:g=Batman.expando),e[g]||(e[g]={});if(typeof b=="object"||typeof b=="function")d?e[g][h]=Batman.extend(e[g][h],b):e[g]=Batman.extend(e[g],b);return j=e[g],d&&(j[h]||(j[h]={}),j=j[h]),c!==void 0&&(j[b]=c),f?i=j[b]:i=j,i},removeData:function(b,c,d){var e,f,g,h,i,j;if(!Batman.acceptData(b))return;h=Batman.expando,i=b.nodeType,e=Batman.cache,f=b[Batman.expando];if(!e[f])return;if(c){j=d?e[f][h]:e[f];if(j){delete j[c];if(!a(j))return}}if(d){delete e[f][h];if(!a(e[f]))return}return g=e[f][h],Batman.canDeleteExpando||!e.setInterval?delete e[f]:e[f]=null,g?(e[f]={},e[f][h]=g):Batman.canDeleteExpando?delete b[Batman.expando]:b.removeAttribute?b.removeAttribute(Batman.expando):b[Batman.expando]=null},_data:function(a,b,c){return Batman.data(a,b,c,!0)},acceptData:function(a){var b;if(a.nodeName){b=Batman.noData[a.nodeName.toLowerCase()];if(b)return b!==!0&&a.getAttribute("classid")===b}return!0}})}.call(this),function(){var a,b,c=[].slice;a=function(a){return function(b){return b==null?void 0:a.apply(this,arguments)}},b=function(a,b){return a||b},Batman.Filters={raw:a(function(a,b){return b.escapeValue=!1,a}),get:a(function(a,b){return a.get!=null?a.get(b):a[b]}),equals:a(function(a,b,c){return a===b}),and:function(a,b){return a&&b},or:function(a,b,c){return a||b},not:function(a,b){return!a},trim:a(function(a,b){return a.trim()}),matches:a(function(a,b){return a.indexOf(b)!==-1}),truncate:a(function(a,b,c,d){return c==null&&(c="..."),d||(d=c,c="..."),a.length>b&&(a=a.substr(0,b-c.length)+c),a}),"default":function(a,b,c){return a!=null&&a!==""?a:b},prepend:function(a,b,c){return(b!=null?b:"")+(a!=null?a:"")},append:function(a,b,c){return(a!=null?a:"")+(b!=null?b:"")},replace:a(function(a,b,c,d,e){return e||(e=d,d=void 0),d===void 0?a.replace(b,c):a.replace(b,c,d)}),downcase:a(function(a){return a.toLowerCase()}),upcase:a(function(a){return a.toUpperCase()}),pluralize:a(function(a,b,c,d){return d||(d=c,c=!0,d||(d=b,b=void 0)),b!=null?Batman.helpers.pluralize(b,a,void 0,c):Batman.helpers.pluralize(a)}),humanize:a(function(a,b){return Batman.helpers.humanize(a)}),join:a(function(a,b,c){return b==null&&(b=""),c||(c=b,b=""),a.join(b)}),sort:a(function(a){return a.sort()}),map:a(function(a,b){return a.map(function(a){return Batman.get(a,b)})}),has:function(a,b){return a==null?!1:Batman.contains(a,b)},first:a(function(a){return a[0]}),meta:a(function(a,b){return a.meta.get(b)}),interpolate:function(a,b,c){var d,e,f;c||(c=b,b=void 0);if(!a)return;f={};for(d in b)e=b[d],f[d]=this.get(e),f[d]==null&&(f[d]="");return Batman.helpers.interpolate(a,f)},withArguments:function(){var a,b,d,e;b=arguments[0],d=3<=arguments.length?c.call(arguments,1,e=arguments.length-1):(e=1,[]),a=arguments[e++];if(!b)return;return function(){var a;return a=1<=arguments.length?c.call(arguments,0):[],b.call.apply(b,[this].concat(c.call(d),c.call(a)))}},routeToAction:a(function(a,b){var c;return c=Batman.Dispatcher.paramsFromArgument(a),c.action=b,c}),escape:a(Batman.escapeHTML)},function(){var b,c,d,e,f;e=["capitalize","singularize","underscore","camelize"],f=[];for(c=0,d=e.length;c<d;c++)b=e[c],f.push(Batman.Filters[b]=a(Batman.helpers[b]));return f}()}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Batman.RenderContext=function(){function c(a,b){this.object=a,this.parent=b}var a;return c.deProxy=function(a){return a!=null&&a.isContextProxy?a.get("proxiedObject"):a},c.root=function(){var a;return Batman.currentApp!=null&&(a=Batman.currentApp.get("_renderContext")),a!=null?a:a=this.base},c.prototype.windowWrapper={window:Batman.container},c.prototype.findKey=function(a){var b,c,d;b=a.split(".")[0].split("|")[0].trim(),c=this;while(c){d=Batman.get(c.object,b);if(typeof d!="undefined")return d=Batman.get(c.object,a),[d,c.object].map(this.constructor.deProxy);c=c.parent}return[Batman.get(this.windowWrapper,a),this.windowWrapper]},c.prototype.get=function(a){return this.findKey(a)[0]},c.prototype.contextForKey=function(a){return this.findKey(a)[1]},c.prototype.descend=function(a,b){var c;return b&&(c=a,a=new Batman.Object,a[b]=c),new this.constructor(a,this)},c.prototype.descendWithDefinition=function(b){var c;return c=new a(b),this.descend(c,b.attr)},c.prototype.chain=function(){var a,b;b=[],a=this;while(a)b.push(a.object),a=a.parent;return b},c.ContextProxy=a=function(a){function c(a){this.binding=new Batman.DOM.AbstractBinding(a)}return b(c,a),c.prototype.isContextProxy=!0,c.accessor("proxiedObject",function(){return this.binding.get("filteredValue")}),c.accessor({get:function(a){return this.get("proxiedObject."+a)},set:function(a,b){return this.set("proxiedObject."+a,b)},unset:function(a){return this.unset("proxiedObject."+a)}}),c}(Batman.Object),c}.call(this),Batman.RenderContext.base=new Batman.RenderContext(Batman.RenderContext.prototype.windowWrapper)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Batman.ViewStore=function(a){function c(){c.__super__.constructor.apply(this,arguments),this._viewContents={},this._requestedPaths=new Batman.SimpleSet}return b(c,a),c.prototype.propertyClass=Batman.Property,c.prototype.fetchView=function(a){var b=this;return new Batman.Request({url:Batman.Navigator.normalizePath(Batman.config.viewPrefix,""+a+".html"),type:"html",success:function(c){return b.set(a,c)},error:function(b){throw new Error("Could not load view from "+a)}})},c.accessor({"final":!0,get:function(a){var b;if(a.charAt(0)!=="/")return this.get("/"+a);if(this._viewContents[a])return this._viewContents[a];if(this._requestedPaths.has(a))return;if(b=this._sourceFromDOM(a))return b;if(!Batman.config.fetchRemoteViews)throw new Error("Couldn't find view source for '"+a+"'!");this.fetchView(a)},set:function(a,b){return a.charAt(0)!=="/"?this.set("/"+a,b):(this._requestedPaths.add(a),this._viewContents[a]=b)}}),c.prototype.prefetch=function(a){return this.get(a),!0},c.prototype._sourceFromDOM=function(a){var b,c;c=a.slice(1);if(b=Batman.DOM.querySelector(document,"[data-defineview*='"+c+"']"))return Batman.setImmediate(function(){var a;return(a=b.parentNode)!=null?a.removeChild(b):void 0}),Batman.DOM.defineView(a,b)},c}(Batman.Object)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b},c=[].slice;Batman.View=function(a){function d(a){var b,c=this;a==null&&(a={}),b=a.context,b?b instanceof Batman.RenderContext||(b=Batman.RenderContext.root().descend(b)):b=Batman.RenderContext.root(),a.context=b.descend(this),d.__super__.constructor.call(this,a),Batman.Property.withoutTracking(function(){return c.observeAndFire("readyToRender",function(a){if(a)return c.render()})})}return b(d,a),d.YieldStorage=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.wrapAccessor(function(a){return{get:function(b){var c;return c=a.get.call(this,b),c==null&&(c=this.set(b,[])),c}}}),c}(Batman.Hash),d.store=new Batman.ViewStore,d.option=function(){var a;return a=1<=arguments.length?c.call(arguments,0):[],this.accessor.apply(this,c.call(a).concat([{get:function(a){var b;return(b=this.get("argumentBindings."+a))!=null?b.get("filteredValue"):void 0},set:function(a,b){var c;return(c=this.get("argumentBindings."+a))!=null?c.set("filteredValue",b):void 0},unset:function(a){var b;return(b=this.get("argumentBindings."+a))!=null?b.unset("filteredValue"):void 0}}]))},d.prototype.isView=!0,d.prototype.cache=!0,d.prototype._rendered=!1,d.prototype.node=null,d.prototype.event("ready").oneShot=!0,d.accessor("argumentBindings",function(){var a=this;return new Batman.TerminalAccessible(function(b){var c,d,e,f,g,h;if(!(g=a.get("node"))||!(d=a.get("context")))return;f=g.getAttribute(("data-view-"+b).toLowerCase());if(f==null)return;return c="_argumentBinding"+b,(h=a[c])!=null&&h.die(),e=new Batman.DOM.ReaderBindingDefinition(g,f,d),a[c]=new Batman.DOM.ViewArgumentBinding(e)})}),d.accessor("html",{get:function(){var a;if(this.html&&this.html.length>0)return this.html;if(!(a=this.get("source")))return;return a=Batman.Navigator.normalizePath(a),this.html=this.constructor.store.get(a)},set:function(a,b){return this.html=b}}),d.accessor("node",{get:function(){var a;if(this.node==null){a=this.get("html");if(!(a&&a.length>0))return;this.node=document.createElement("div"),this._setNodeOwner(this.node),Batman.DOM.setInnerHTML(this.node,a)}return this.node},set:function(a,b){var c,d=this;return this.node=b,this._setNodeOwner(b),c=function(a){if(a!=null)return Batman.DOM.setInnerHTML(d.node,a),d.forget("html",c)},this.observeAndFire("html",c),b}}),d.accessor("yields",function(){return new this.constructor.YieldStorage}),d.accessor("fetched?",function(){return this.get("source")!=null}),d.accessor("readyToRender",function(){var a;return this.get("node")&&(this.get("fetched?")?((a=this.get("html"))!=null?a.length:void 0)>0:!0)}),d.prototype.render=function(){var a,b=this;if(this._rendered)return;return this._rendered=!0,this._renderer=new Batman.Renderer(a=this.get("node"),this.get("context"),this),this._renderer.once("rendered",function(){return b.fire("ready",a)})},d.prototype.isInDOM=function(){var a;return(a=this.get("node"))?a.parentNode!=null||this.get("yields").some(function(b,c){var d,e;for(d=0,e=c.length;d<e;d++){a=c[d].node;if(a.parentNode!=null)return!0}return!1}):!1},d.prototype.die=function(){var a;return this.fire("destroy",this.node),this.forget(),(a=this._batman.properties)!=null&&a.forEach(function(a,b){return b.die()}),this.get("yields").forEach(function(a,b){var c,d,e,f;f=[];for(d=0,e=b.length;d<e;d++)c=b[d].node,f.push(Batman.DOM.didDestroyNode(c));return f})},d.prototype.applyYields=function(){return this.get("yields").forEach(function(a,b){var c,d,e,f,g,h,i;e=Batman.DOM.Yield.withName(a),i=[];for(f=0,g=b.length;f<g;f++)h=b[f],d=h.node,c=h.action,i.push(e[c](d));return i})},d.prototype.retractYields=function(){return this.get("yields").forEach(function(a,b){var c,d,e,f,g;g=[];for(d=0,e=b.length;d<e;d++)c=b[d].node,g.push((f=c.parentNode)!=null?f.removeChild(c):void 0);return g})},d.prototype.pushYieldAction=function(a,b,c){return this._setNodeYielder(c),this.get("yields").get(a).push({node:c,action:b})},d.prototype._setNodeOwner=function(a){return Batman._data(a,"view",this)},d.prototype._setNodeYielder=function(a){return Batman._data(a,"yielder",this)},d.prototype.on("ready",function(){return typeof this.ready=="function"?this.ready.apply(this,arguments):void 0}),d.prototype.on("appear",function(){return typeof this.viewDidAppear=="function"?this.viewDidAppear.apply(this,arguments):void 0}),d.prototype.on("disappear",function(){return typeof this.viewDidDisappear=="function"?this.viewDidDisappear.apply(this,arguments):void 0}),d.prototype.on("beforeAppear",function(){return typeof this.viewWillAppear=="function"?this.viewWillAppear.apply(this,arguments):void 0}),d.prototype.on("beforeDisappear",function(){return typeof this.viewWillDisappear=="function"?this.viewWillDisappear.apply(this,arguments):void 0}),d}.call(this,Batman.Object)}.call(this),function(){var a,b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a},d=[].slice;Batman.DOM.Yield=a=function(a){function b(){this.cycle()}return c(b,a),b.yields={},b.queued=function(a){return function(){var b,c,e=this;return b=1<=arguments.length?d.call(arguments,0):[],this.containerNode!=null?a.apply(this,b):c=this.observe("containerNode",function(){var d;return d=a.apply(e,b),e.forget("containerNode",c),d})}},b.reset=function(){return this.yields={}},b.withName=function(a){var b;return(b=this.yields)[a]||(b[a]=new this({name:a})),this.yields[a]},b.forEach=function(a){var b,c,d;d=this.yields;for(b in d)c=d[b],a(c)},b.clearAll=function(){return this.forEach(function(a){return a.clear()})},b.cycleAll=function(){return this.forEach(function(a){return a.cycle()})},b.clearAllStale=function(){return this.forEach(function(a){return a.clearStale()})},b.prototype.cycle=function(){return this.currentVersionNodes=[]},b.prototype.clear=b.queued(function(){var a,b,c,d,e;this.cycle(),d=function(){var b,c,d,e;d=this.containerNode.childNodes,e=[];for(b=0,c=d.length;b<c;b++)a=d[b],e.push(a);return e}.call(this),e=[];for(b=0,c=d.length;b<c;b++)a=d[b],e.push(Batman.DOM.removeOrDestroyNode(a));return e}),b.prototype.clearStale=b.queued(function(){var a,b,c,d,e;d=function(){var b,c,d,e;d=this.containerNode.childNodes,e=[];for(b=0,c=d.length;b<c;b++)a=d[b],e.push(a);return e}.call(this),e=[];for(b=0,c=d.length;b<c;b++)a=d[b],~this.currentVersionNodes.indexOf(a)||e.push(Batman.DOM.removeOrDestroyNode(a));return e}),b.prototype.append=b.queued(function(a){return this.currentVersionNodes.push(a),Batman.DOM.appendChild(this.containerNode,a,!0)}),b.prototype.replace=b.queued(function(a){return this.clear(),this.append(a)}),b}(Batman.Object)}.call(this),function(){}.call(this),!function(a,b){typeof module!="undefined"?module.exports=b():typeof define=="function"&&define.amd?define(a,b):this[a]=b()}("reqwest",function(){function handleReadyState(a,b,c){return function(){a&&a[readyState]==4&&(twoHundo.test(a.status)?b(a):c(a))}}function setHeaders(a,b){var c=b.headers||{},d;c.Accept=c.Accept||defaultHeaders.accept[b.type]||defaultHeaders.accept["*"],!b.crossOrigin&&!c[requestedWith]&&(c[requestedWith]=defaultHeaders.requestedWith),c[contentType]||(c[contentType]=b.contentType||defaultHeaders.contentType);for(d in c)c.hasOwnProperty(d)&&a.setRequestHeader(d,c[d])}function generalCallback(a){lastValue=a}function urlappend(a,b){return a+(/\?/.test(a)?"&":"?")+b}function handleJsonp(a,b,c,d){var e=uniqid++,f=a.jsonpCallback||"callback",g=a.jsonpCallbackName||"reqwest_"+e,h=new RegExp("((^|\\?|&)"+f+")=([^&]+)"),i=d.match(h),j=doc.createElement("script"),k=0;i?i[3]==="?"?d=d.replace(h,"$1="+g):g=i[3]:d=urlappend(d,f+"="+g),win[g]=generalCallback,j.type="text/javascript",j.src=d,j.async=!0,typeof j.onreadystatechange!="undefined"&&(j.event="onclick",j.htmlFor=j.id="_reqwest_"+e),j.onload=j.onreadystatechange=function(){if(j[readyState]&&j[readyState]!=="complete"&&j[readyState]!=="loaded"||k)return!1;j.onload=j.onreadystatechange=null,j.onclick&&j.onclick(),a.success&&a.success(lastValue),lastValue=undefined,head.removeChild(j),k=1},head.appendChild(j)}function getRequest(a,b,c){var d=(a.method||"GET").toUpperCase(),e=typeof a=="string"?a:a.url,f=a.processData!==!1&&a.data&&typeof a.data!="string"?reqwest.toQueryString(a.data):a.data||null,g;return(a.type=="jsonp"||d=="GET")&&f&&(e=urlappend(e,f),f=null),a.type=="jsonp"?handleJsonp(a,b,c,e):(g=xhr(),g.open(d,e,!0),setHeaders(g,a),g.onreadystatechange=handleReadyState(g,b,c),a.before&&a.before(g),g.send(f),g)}function Reqwest(a,b){this.o=a,this.fn=b,init.apply(this,arguments)}function setType(a){var b=a.match(/\.(json|jsonp|html|xml)(\?|$)/);return b?b[1]:"js"}function init(o,fn){function complete(a){o.timeout&&clearTimeout(self.timeout),self.timeout=null,o.complete&&o.complete(a)}function success(resp){var r=resp.responseText;if(r)switch(type){case"json":try{resp=win.JSON?win.JSON.parse(r):eval("("+r+")")}catch(err){return error(resp,"Could not parse JSON in response",err)}break;case"js":resp=eval(r);break;case"html":resp=r}fn(resp),o.success&&o.success(resp),complete(resp)}function error(a,b,c){o.error&&o.error(a,b,c),complete(a)}this.url=typeof o=="string"?o:o.url,this.timeout=null;var type=o.type||setType(this.url),self=this;fn=fn||function(){},o.timeout&&(this.timeout=setTimeout(function(){self.abort()},o.timeout)),this.request=getRequest(o,success,error)}function reqwest(a,b){return new Reqwest(a,b)}function normalize(a){return a?a.replace(/\r?\n/g,"\r\n"):""}function serial(a,b){var c=a.name,d=a.tagName.toLowerCase(),e=function(a){a&&!a.disabled&&b(c,normalize(a.attributes.value&&a.attributes.value.specified?a.value:a.text))};if(a.disabled||!c)return;switch(d){case"input":if(!/reset|button|image|file/i.test(a.type)){var f=/checkbox/i.test(a.type),g=/radio/i.test(a.type),h=a.value;(!f&&!g||a.checked)&&b(c,normalize(f&&h===""?"on":h))}break;case"textarea":b(c,normalize(a.value));break;case"select":if(a.type.toLowerCase()==="select-one")e(a.selectedIndex>=0?a.options[a.selectedIndex]:null);else for(var i=0;a.length&&i<a.length;i++)a.options[i].selected&&e(a.options[i])}}function eachFormElement(){var a=this,b,c,d,e=function(b,c){for(var e=0;e<c.length;e++){var f=b[byTag](c[e]);for(d=0;d<f.length;d++)serial(f[d],a)}};for(c=0;c<arguments.length;c++)b=arguments[c],/input|select|textarea/i.test(b.tagName)&&serial(b,a),e(b,["input","select","textarea"])}function serializeQueryString(){return reqwest.toQueryString(reqwest.serializeArray.apply(null,arguments))}function serializeHash(){var a={};return eachFormElement.apply(function(b,c){b in a?(a[b]&&!isArray(a[b])&&(a[b]=[a[b]]),a[b].push(c)):a[b]=c},arguments),a}var context=this,win=window,doc=document,old=context.reqwest,twoHundo=/^20\d$/,byTag="getElementsByTagName",readyState="readyState",contentType="Content-Type",requestedWith="X-Requested-With",head=doc[byTag]("head")[0],uniqid=0,lastValue,xmlHttpRequest="XMLHttpRequest",isArray=typeof Array.isArray=="function"?Array.isArray:function(a){return a instanceof Array},defaultHeaders={contentType:"application/x-www-form-urlencoded",accept:{"*":"text/javascript, text/html, application/xml, text/xml, */*",xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript",js:"application/javascript, text/javascript"},requestedWith:xmlHttpRequest},xhr=win[xmlHttpRequest]?function(){return new XMLHttpRequest}:function(){return new ActiveXObject("Microsoft.XMLHTTP")};return Reqwest.prototype={abort:function(){this.request.abort()},retry:function(){init.call(this,this.o,this.fn)}},reqwest.serializeArray=function(){var a=[];return eachFormElement.apply(function(b,c){a.push({name:b,value:c})},arguments),a},reqwest.serialize=function(){if(arguments.length===0)return"";var a,b,c=Array.prototype.slice.call(arguments,0);return a=c.pop(),a&&a.nodeType&&c.push(a)&&(a=null),a&&(a=a.type),a=="map"?b=serializeHash:a=="array"?b=reqwest.serializeArray:b=serializeQueryString,b.apply(null,c)},reqwest.toQueryString=function(a){var b="",c,d=encodeURIComponent,e=function(a,c){b+=d(a)+"="+d(c)+"&"};if(isArray(a))for(c=0;a&&c<a.length;c++)e(a[c].name,a[c].value);else for(var f in a){if(!Object.hasOwnProperty.call(a,f))continue;var g=a[f];if(isArray(g))for(c=0;c<g.length;c++)e(f,g[c]);else e(f,a[f])}return b.replace(/&$/,"").replace(/%20/g,"+")},reqwest.compat=function(a,b){return a&&(a.type&&(a.method=a.type)&&delete a.type,a.dataType&&(a.type=a.dataType),a.jsonpCallback&&(a.jsonpCallbackName=a.jsonpCallback)&&delete a.jsonpCallback,a.jsonp&&(a.jsonpCallback=a.jsonp)),new Reqwest(a,b)},reqwest}),function(){var a,b;Batman.extend(Batman.DOM,{querySelectorAll:(typeof window!=="undefined"&&window!==null?(a=window.document)!=null?a.querySelectorAll:void 0:void 0)!=null?function(a,b){return a.querySelectorAll(b)}:function(){},querySelector:(typeof window!=="undefined"&&window!==null?(b=window.document)!=null?b.querySelector:void 0:void 0)!=null?function(a,b){return a.querySelector(b)}:function(){},setInnerHTML:function(a,b){var c,d,e,f,g,h,i;d=function(){var b,d,e,f;e=a.childNodes,f=[];for(b=0,d=e.length;b<d;b++)c=e[b],f.push(c);return f}();for(f=0,h=d.length;f<h;f++)c=d[f],Batman.DOM.willRemoveNode(c);e=a.innerHTML=b;for(g=0,i=d.length;g<i;g++)c=d[g],Batman.DOM.didRemoveNode(c);return e},removeNode:function(a){var b;return Batman.DOM.willRemoveNode(a),(b=a.parentNode)!=null&&b.removeChild(a),Batman.DOM.didRemoveNode(a)},destroyNode:function(a){return Batman.DOM.willDestroyNode(a),Batman.DOM.removeNode(a),Batman.DOM.didDestroyNode(a)},appendChild:function(a,b){return Batman.DOM.willInsertNode(b),a.appendChild(b),Batman.DOM.didInsertNode(b)}})}.call(this),function(){var a;Batman.Request.prototype._parseResponseHeaders=function(a){var b;return b=a.getAllResponseHeaders().split("\n").reduce(function(a,b){var c,d,e;if(d=b.match(/([^:]*):\s*(.*)/))c=d[1],e=d[2],a[c]=e;return a},{})},Batman.Request.prototype.send=function(a){var b,c,d,e=this;return a==null&&(a=this.get("data")),this.fire("loading"),b={url:this.get("url"),method:this.get("method"),type:this.get("type"),headers:this.get("headers"),success:function(a){return e.mixin({xhr:c,response:a,status:typeof c!="undefined"&&c!==null?c.status:void 0,responseHeaders:e._parseResponseHeaders(c)}),e.fire("success",a)},error:function(a){return e.mixin({xhr:a,response:a.responseText||a.content,status:a.status,responseHeaders:e._parseResponseHeaders(a)}),a.request=e,e.fire("error",a)},complete:function(){return e.fire("loaded")}},(d=b.method)==="PUT"||d==="POST"?this.hasFileUploads()?b.data=this.constructor.objectToFormData(a):(b.contentType=this.get("contentType"),b.data=Batman.URI.queryFromParams(a)):b.data=a,c=reqwest(b).request},a=["Webkit","Moz","O","ms",""],Batman.mixins.animation={initialize:function(){var b,c,d;for(c=0,d=a.length;c<d;c++)b=a[c],this.style[""+b+"Transform"]="scale(1, 1)",this.style.opacity=1,this.style[""+b+"TransitionProperty"]=""+(b?"-"+b.toLowerCase()+"-":"")+"transform, opacity",this.style[""+b+"TransitionDuration"]="0.8s, 0.55s",this.style[""+b+"TransformOrigin"]="left top";return this},show:function(b){var c,d,e,f=this;return c=function(){var b,c,d;f.style.opacity=1;for(c=0,d=a.length;c<d;c++)b=a[c],f.style[""+b+"Transform"]="scale(1, 1)";return f},b?((d=b.append)!=null&&d.appendChild(this),(e=b.before)!=null&&e.parentNode.insertBefore(this,b.before),setTimeout(c,0)):c(),this},hide:function(b){var c,d,e,f=this;this.style.opacity=0;for(d=0,e=a.length;d<e;d++)c=a[d],this.style[""+c+"Transform"]="scale(0, 0)";return b&&setTimeout(function(){var a;return(a=f.parentNode)!=null?a.removeChild(f):void 0},600),this}}}.call(this),function(){}.call(this)
